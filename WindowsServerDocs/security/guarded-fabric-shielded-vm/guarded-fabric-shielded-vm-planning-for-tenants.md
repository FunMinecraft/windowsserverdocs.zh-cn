---
title: 受保护的构造和受防护的 VM 规划托管商的指南
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.technology: security-guarded-fabric
ms.openlocfilehash: 0a43cedf8ce0138e89624ff3df5bc7088f583252
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59875298"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>受保护的构造和受防护的 VM 规划租户指南

>适用于：Windows Server 2019，Windows Server （半年频道），Windows Server 2016

本主题重点介绍 VM 所有者希望保护其符合性和安全目的的虚拟机 (Vm)。 无论是否在托管提供商的受保护的构造或私有受保护的构造上运行 Vm，VM 所有者需要控制其受防护的 Vm，其中包括维护的功能，如果需要对其进行解密的安全级别。

有三个方面需要考虑当使用受防护的 Vm:

- Vm 的安全级别
- 用于对其进行保护的加密密钥
- 屏蔽数据 — 敏感信息用来创建受防护的 Vm 

## <a name="security-level-for-the-vms"></a>虚拟机的的安全级别

当部署受防护的 Vm 时，必须选择两种安全级别之一：

- 受防护的 
- 支持加密

受防护的同时，并且支持加密的 Vm 具有虚拟 TPM 附加到它们和那些运行的 Windows 受 BitLocker。 主要区别在于，受防护的 Vm 阻止访问由构造管理员而支持加密的 Vm 允许的构造管理员相同的访问级别因为客户端到常规 VM。 有关这些差异的详细信息，请参阅[受保护的构造和受防护的 Vm 概述](guarded-fabric-and-shielded-vms.md)。 

选择**受防护的 Vm**如果想要保护 VM 免受被入侵构造的 （包括已泄露的管理员）。 它们应在环境中构造管理员和结构本身不受信任的位置。 选择**加密支持的 Vm**如果您打算满足一个符合性图条，可能需要静态加密和加密在网络上的 vm （例如，在实时迁移）。

支持加密的 Vm 非常适合在环境中在构造管理员完全受信任但加密保持一项要求。

在受保护的构造，即使在同一台 HYPER-V 主机上，可以运行混合使用常规 Vm，受防护的 Vm 和支持加密的 Vm。 

是否受防护的 VM 或支持加密的取决于创建 VM 时选择屏蔽数据。 创建屏蔽数据时，VM 所有者配置的安全级别 (请参阅[屏蔽数据](#shielding-data)部分)。
请注意，一旦建立了此选项，它时，无法更改 VM 保留在虚拟化结构上。

## <a name="cryptographic-keys-used-for-shielded-vms"></a>用于受防护的 Vm 的加密密钥

受防护的 Vm 是从虚拟化结构的攻击媒介使用加密的磁盘和各种其他加密的元素只能由进行解密的受保护的：

- 所有者密钥 – 这是由通常用于最后的手段恢复或故障排除 VM 所有者维护的加密密钥。 VM 所有者是负责维护安全的位置中的所有者键。
- 一个或多个 Guardians （主机保护者密钥） – 每个保护者表示的所有者可授权受防护的 Vm 运行的虚拟化结构。 企业通常具有一个主和灾难恢复 (DR) 虚拟化结构，并通常将授权其受防护的 Vm 上同时运行。 在某些情况下，可能通过公有云提供程序托管在辅助 (DR) 构造。 而其公共密钥可以下载并包含在其保护者仅在虚拟化结构上保留任何受保护的构造的私钥。 

**如何创建非所有者密钥？** 所有者键由两个证书表示。 用于加密和签名的证书的证书。 可以创建使用你自己的 PKI 基础结构这两个证书，也可以从公共证书颁发机构 (CA) 获取 SSL 证书。 出于测试目的，您还可以在任何 Windows 10 或 Windows Server 2016 以开头的计算机上创建自签名的证书。

**你应该有几个所有者密钥？** 可以使用单个所有者密钥或多个所有者密钥。 最佳做法建议的单个所有者密钥用于的一组共享相同的安全、 信任或风险级别的 Vm 和管理控制。 可以为所有已加入域的受防护 Vm 共享单个所有者密钥和托管该所有者密钥以域管理员进行管理。

**可以使用我自己的密钥主机保护者？** 是的您可以到宿主提供程序，使用该密钥受防护的 vm 的"自带"键。 这使您要使用特定密钥 （而不使用托管提供程序密钥），你有特定的安全或需要遵守的法规时，可以使用。 出于密钥清洁，主机保护者密钥应该不同于所有者密钥。

## <a name="shielding-data"></a>屏蔽数据

屏蔽数据包含部署受防护的或支持加密的 Vm 所需的机密。 它也使用转换到常规 Vm 受防护的 Vm。

防护数据使用屏蔽数据文件向导创建并存储在该 VM 所有者将上传到受保护的构造 PDK 文件中。

受防护的 Vm 帮助防止受攻击的虚拟化结构，从发起攻击，因此，我们需要一种而不会泄露给传递敏感初始化数据，例如管理员的密码、 域加入凭据或 RDP 证书的安全机制虚拟化结构本身或向其管理员。 此外，屏蔽数据包含以下元素：

1. 安全级别-受保护或加密支持
2. 所有者和 VM 可以在其中运行的受信任主机监护人的列表
3. 虚拟机初始化数据 （unattend.xml，RDP 证书）
4. 虚拟化环境中创建 VM 的受信任的已签名的模板磁盘的列表 

当创建受防护的或支持加密的 VM 或转换现有 VM，你将需要选择屏蔽数据，而不会提示输入的敏感信息。

**是否需要屏蔽数据文件数？** 单一的防护数据文件可以用于创建每个受防护的 VM。 如果，但是，给定受防护的 VM 要求任何的四个项目都不同，其他的防护数据文件是必需的。 例如，因为其初始管理员密码和 RDP 证书不同可能你的 IT 部门和人力资源部的不同的防护数据文件较一个防护数据文件。

虽然可以做的每个受防护的 VM 使用单独的防护数据文件，但它不一定是最佳选择，并应出于适当的理由。 例如，如果每个受防护的 VM 需要具有不同的管理员密码，请考虑改为使用密码管理服务或工具如[Microsoft 的本地管理员密码解决方案 (LAPS)](https://www.microsoft.com/en-us/download/details.aspx?id=46899)。

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>在虚拟化结构上创建受防护的 VM

有几个选项用于在虚拟化结构 （以下是适用于受防护和支持加密的 Vm） 上创建受防护的 VM:

1. 在您的环境中创建受防护的 VM 并将其上载到虚拟化结构
2. 从虚拟化结构上的已签名模板创建新的受防护的 VM
3. 防护现有 VM （现有的 VM 必须是第 2 代和必须运行 Windows Server 2012 或更高版本）

从模板创建新的 Vm 是通常的做法。 但是，由于用于创建新的受防护的 VM 的模板磁盘驻留在虚拟化结构上，更多措施确保很有必要，它具有未被篡改恶意构造管理员或恶意软件的构造上运行。 使用已签名的模板磁盘解决此问题，由受信任的管理员或 VM 所有者创建已签名的模板磁盘和它们的磁盘签名。 创建受防护的 VM 时，与包含在指定的防护数据文件的签名进行比较的模板磁盘签名。 如果任何屏蔽数据文件的签名匹配的模板磁盘签名，将继续部署过程。 如果没有匹配项可以找到，中止部署过程，确保 VM 机密不会泄露由于不受信任的模板磁盘。

时使用已签名的模板磁盘创建受防护的 Vm，将提供两个选项：

1. 使用提供的虚拟化提供程序的现有已签名的模板磁盘。 在这种情况下，虚拟化提供程序维护已签名的模板磁盘。
2. 将已签名的模板磁盘上传到虚拟化结构。 VM 所有者是负责维护已签名的模板磁盘。 


