---
title: Windows 身份验证中的凭据进程
description: Windows Server 安全
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52d50a1bb6bfbe9d35146f362a2a5184df0a6504
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839858"
---
# <a name="credentials-processes-in-windows-authentication"></a>Windows 身份验证中的凭据进程

>适用于：Windows 服务器 （半年频道），Windows Server 2016

本参考主题面向 IT 专业人员介绍了 Windows 身份验证如何处理凭据。

Windows 凭据管理是操作系统接收来自服务或用户的凭据并保护该信息以便将来为身份验证目标的过程。 在已加入域的计算机的情况下进行身份验证的目标是域控制器。 身份验证中使用的凭据是真实性的证据的将关联到某种形式，如证书、 密码或 PIN 的用户的标识的数字文档。

默认情况下，Windows 凭据进行验证，对本地计算机上的安全帐户管理器 (SAM) 数据库或针对已加入域的计算机，通过 Winlogon 服务上的 Active Directory。 登录用户界面上或以编程方式通过应用程序编程接口 (API) 来提供给身份验证的目标，凭据将收集通过用户输入。

本地安全信息存储在注册表中**HKEY_LOCAL_MACHINE\SECURITY**。 存储的信息包括策略设置、 默认安全值和帐户信息，如缓存的登录凭据。 SAM 数据库的副本是也存储在此处，尽管它被写保护。

下图显示了所需的组件和路径，凭据需要通过系统进行身份验证的用户或进程的成功的登录尝试。

![关系图显示了所需的组件和路径的凭据通过系统需要进行身份验证的用户或进程的成功的登录尝试。](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

下表描述了每个组件，用于管理在登录时的身份验证过程中的凭据。

**所有系统的身份验证组件**

|组件|描述|
|-------|--------|
|用户登录|Winlogon.exe 是负责管理安全的用户交互的可执行文件。 Winlogon 服务收集的凭据由用户操作在安全桌面上 (登录 UI) 到本地安全机构 (LSA) 通过 Secur32.dll 表示通过启动 Windows 操作系统的登录过程。|
|应用程序登录|应用程序或服务不需要交互式登录的登录。 大多数由用户启动的进程在用户模式下运行，而在启动时，例如服务、 启动的进程运行在内核模式下使用 Ksecdd.sys 使用 Secur32.dll。<br /><br />有关用户模式和内核模式的详细信息，请参阅本主题中的应用程序或服务和用户模式和内核模式。|
|Secur32.dll|多个身份验证提供程序的窗体的身份验证过程的基础。|
|Lsasrv.dll|LSA 服务器服务，它同时强制实施安全策略并充当 LSA 的安全包管理器。 LSA 包含确定哪个协议若要成功之后选择 NTLM 或 Kerberos 协议的协商函数。|
|安全支持提供程序|一组单独调用一个或多个身份验证协议的提供程序。 每个版本的 Windows 操作系统，可以更改默认的提供程序集，可编写自定义提供程序。|
|Netlogon.dll|Net Logon 服务执行的服务如下所示：<br /><br />-维护计算机的安全通道 （不以与 Schannel 相混淆） 到域控制器。<br />-将通过安全通道的用户的凭据传递给域控制器，并返回的域安全标识符 (Sid) 和用户的用户权限。<br />-在域名系统 (DNS) 发布服务资源记录，并使用 DNS 名称解析为域控制器的 Internet 协议 (IP) 地址。<br />的实现基于适用于同步主域控制器 (Pdc) 和备份域控制器 (Bdc) 远程过程调用 (RPC) 的复制协议。|
|Samsrv.dll|存储本地安全帐户，安全帐户管理器 (SAM) 强制执行本地存储的策略，并支持的 Api。|
|注册表|注册表包含 SAM 数据库、 本地安全策略设置、 安全的默认值和是仅系统可访问的帐户信息的副本。|

本主题包含以下各节：

-   [用户登录的凭据输入](#BKMK_CrentialInputForUserLogon)

-   [应用程序和服务登录的凭据输入](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [本地安全机构](#BKMK_LSA)

-   [缓存的凭据和验证](#BKMK_CachedCredentialsAndValidation)

-   [凭据存储和验证](#BKMK_CredentialStorageAndValidation)

-   [安全帐户管理器数据库](#BKMK_SAM)

-   [本地域和受信任的域](#BKMK_LocalDomainsAndTrustedDomains)

-   [在 Windows 身份验证的证书](#BKMK_CertificatesInWindowsAuthentication)

## <a name="BKMK_CrentialInputForUserLogon"></a>用户登录的凭据输入
在 Windows Server 2008 和 Windows Vista 中，图形识别与认证 (GINA) 体系结构已替换为凭据提供程序模型，这使其成为可枚举通过登录磁贴使用不同的登录类型。 这两种模型如下所述。

**图形标识和身份验证体系结构**

图形识别与认证 (GINA) 体系结构适用于 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Windows 2000 Professional 操作系统。 在这些系统中，每个交互式登录会话创建 Winlogon 服务的单独实例。 GINA 体系结构加载到使用 Winlogon 的进程空间、 接收和处理凭据，并使对通过 LSALogonUser 的身份验证接口的调用。

在会话 0 中运行交互式登录 Winlogon 的实例。 会话 0 主机系统服务和其他关键进程，包括本地安全机构 (LSA) 进程。

下图显示了 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Microsoft Windows 2000 Professional 的凭据过程。

![显示凭据进程的 Windows Server 2003、 Microsoft Windows 2000 Server、 Windows XP 和 Microsoft Windows 2000 Professional 图](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**凭据提供程序体系结构**

凭据提供程序体系结构适用于这些版本中指定**适用于**本主题开头的列表。 在这些系统中，凭据输入体系结构更改为可扩展的设计使用凭据提供程序。 这些提供程序都是不同的登录磁贴在安全桌面上允许任意数量的登录方案的同一个用户和不同的身份验证方法，例如密码、 智能卡和生物识别不同的帐户。

使用凭据提供程序体系结构，Winlogon 始终启动登录 UI 之后接收到它安全注意序列事件。 登录 UI 查询不同的凭据类型提供程序配置为枚举数每个凭据提供程序。 凭据提供程序具有这些磁贴之一指定为默认值的选项。 所有提供程序具有枚举其磁贴后，登录用户界面为用户显示它们。 用户与磁贴以提供其凭据。 登录 UI 将提交这些凭据进行身份验证。

凭据提供程序不是强制机制。 它们用于收集和序列化的凭据。 本地安全机构和身份验证包强制执行安全规范。

凭据提供程序在计算机上注册，并负责以下：

-   描述所需的身份验证的凭据信息。

-   处理通信和与外部身份验证颁发机构的逻辑。

-   打包的凭据交互和网络登录。

打包的凭据交互和网络登录包含序列化的过程。 通过序列化凭据可以登录 UI 上显示多个登录磁贴。 因此，你的组织可以控制登录显示器，例如用户、 登录的目标系统、 网络和工作站锁定/解除锁定策略-通过自定义的凭据提供程序使用的预登录访问。 多个凭据提供程序可以在同一计算机上共存。

作为标准的凭据提供程序或作为预登录访问提供程序，可以开发单一登录 (SSO) 提供程序。

每个版本的 Windows 包含一个默认凭据提供程序和一个默认前的登录访问提供程序 (PLAP)，也称为 SSO 提供程序。 SSO 提供程序允许用户连接到网络之前登录到本地计算机。 实现此提供程序时，该提供程序不会枚举登录 UI 上的磁贴。

SSO 提供程序旨在用于以下方案：

-   **网络身份验证和计算机登录都由不同的凭据提供程序处理。** 与此方案的变体包括：

    -   用户在登录到计算机之前已连接到网络，例如连接到虚拟专用网络 (VPN) 的选项，但不是要求进行此连接。

    -   检索在本地计算机上的交互式身份验证过程中使用的信息需要网络身份验证。

    -   多个网络身份验证后跟其他方案之一。 例如，用户向 Internet 服务提供商 (ISP) 进行身份验证、 进行身份验证的 vpn，然后使用其用户帐户凭据登录本地。

    -   缓存的凭据将被禁用，并通过 VPN 建立的远程访问服务连接在本地登录之前需要用户进行身份验证。

    -   域用户不具有已加入域的计算机上设置的本地帐户，并且必须建立远程访问服务连接通过 VPN 连接，然后完成交互式登录。

-   **网络身份验证和计算机登录都由相同的凭据提供程序处理。** 在此方案中，用户都需要连接到的网络，然后在登录到计算机。

**登录磁贴枚举**

凭据提供程序枚举在以下情况下登录磁贴：

-   针对这些操作系统中指定**适用于**本主题开头的列表。

-   凭据提供程序枚举工作站登录磁贴。 凭据提供程序通常将序列化到本地安全机构的身份验证的凭据。 此过程显示特定于每个用户和特定的磁贴到每个用户的目标系统。

-   登录和身份验证体系结构使用户能够使用枚举的凭据提供程序的磁贴以解锁工作站。 通常情况下，当前登录的用户是默认磁贴，但如果多个用户登录，则会显示大量磁贴。

-   凭据提供程序枚举为用户请求以更改其密码或 PIN 之类的其他私人信息的响应中的磁贴。 通常情况下，当前登录的用户是默认磁贴;但是，如果多个用户登录时，会显示大量磁贴。

-   凭据提供程序枚举基于序列化的凭据以用于远程计算机上进行身份验证的磁贴。 凭据 UI 不为登录 UI、 解锁工作站或更改密码使用提供程序的相同实例。 因此，不能在提供程序的凭据 UI 实例之间维护状态信息。 此结构会导致对每个远程计算机登录，假设凭据已正确序列化的一个磁贴。 此方案还可用于在用户帐户控制 (UAC)，可以通过帮助防止未经授权的更改到的计算机在允许操作可能会影响计算机的操作前提示用户输入权限或管理员密码或者，可以更改影响的计算机的其他用户的设置。

下图显示了在指定的操作系统的凭据过程**适用于**本主题开头的列表。

![关系图显示了在指定的操作系统的凭据过程 * * 适用于 * * 本主题开头的列表](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>应用程序和服务登录的凭据输入
Windows 身份验证用于管理应用程序或不需要用户交互的服务的凭据。 在用户模式下的应用程序有哪些系统资源它们均可访问，而服务可以具有无限制地访问系统内存和外部设备限制。

系统服务和传输级应用程序访问安全支持提供程序 (SSP) 通过安全支持提供程序接口 (SSPI) 中 Windows，提供用于枚举系统上可用的安全包的函数，选择包，并使用该程序包以获取经过身份验证的连接。

身份验证的客户端/服务器连接时：

-   连接的客户端应用程序通过 SSPI 函数向服务器发送凭据`InitializeSecurityContext (General)`。

-   在服务器端应用程序的连接会使用 SSPI 函数进行响应`AcceptSecurityContext (General)`。

-   SSPI 函数`InitializeSecurityContext (General)`和`AcceptSecurityContext (General)`会重复，直到所有必要的身份验证消息被交换为成功或失败身份验证。

-   连接已经过身份验证后，在服务器上的 LSA 将使用从客户端的信息来生成的安全上下文，其中包含访问令牌。

-   服务器然后可以调用 SSPI 函数`ImpersonateSecurityContext`将附加到该服务模拟线程的访问令牌。

**应用程序和用户模式**

在 Windows 中的用户模式组成的两个系统能够将 I/O 请求传递给适当的内核模式驱动程序： 运行应用程序为许多不同类型的操作系统编写，环境系统和整型系统进行操作代表环境系统的特定于系统的功能。

整型的系统管理环境系统代表运行 system'specific 职能，并包含安全系统进程 (LSA)、 工作站服务和服务器服务。 安全系统进程处理安全令牌、 授予或拒绝访问资源权限的用户帐户的权限、 处理登录请求和启动的登录身份验证，以及确定哪些系统资源的操作系统若要审核的需求。

应用程序可以运行在用户模式下应用程序可以运行任何主体的安全上下文的本地系统 （系统） 中包括的位置。 应用程序还可以运行在内核模式下的应用程序可以运行中的安全上下文的本地系统 （系统）。

SSPI 是可通过 Secur32.dll 模块，它是用于获取身份验证、 消息完整性和消息隐私的集成的安全服务的 API。 它提供应用程序级协议和安全协议之间的抽象层。 SSPI 由于不同的应用程序需要不同的方法来识别或验证用户和通过网络传输时加密数据的不同方式，使您能够访问包含不同的身份验证的动态链接库 (Dll)和加密功能。 这些 Dll 称为安全支持提供程序 (Ssp)。

在 Windows Server 2008 R2 和 Windows 7 的其自己的域帐户，隔离为关键应用程序，如 Microsoft SQL Server 和 Internet 信息服务 (IIS) 中引入了托管的服务帐户和虚拟帐户时无需管理员手动管理服务主体名称 (SPN) 和这些帐户的凭据。 有关这些功能，并在身份验证中的角色的详细信息，请参阅[托管服务帐户文档适用于 Windows 7 和 Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx)和[组托管服务帐户概述](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**服务和内核模式**

尽管大多数 Windows 应用程序启动它们的安全上下文中运行，这不是用户的服务的则返回 true。 用户启动计算机时，许多 Windows 服务，如网络和打印服务是由服务控制器启动。 这些服务可能会以 Local Service 或 Local System 运行，并可能会继续运行最后一个用户注销之后。

> [!NOTE]
> 服务通常在名为本地系统 （系统）、 Network Service 或 Local Service 的安全上下文中运行。  Windows Server 2008 R2 引入了运行的托管的服务帐户，这是域主体的服务。

在开始之前一项服务，服务控制器记录通过使用指定的服务，然后向呈现的 LSA 进行身份验证服务的凭据的帐户。 Windows 服务实现服务控制管理器可用于控制服务的编程接口。 在系统启动时或手动使用服务管理程序可以自动启动 Windows 服务。 例如，当 Windows 客户端计算机加入域，计算机上的 messenger 服务连接到域控制器，并打开安全通道向其。 若要获取已经过身份验证的连接，该服务必须具有远程计算机的本地安全机构 (LSA) 信任的凭据。 时与网络中的其他计算机通信时，LSA 使用本地计算机的域帐户的凭据，在本地系统和网络服务的安全上下文中运行的所有其他服务一样。 本地计算机上的服务作为系统运行，因此无需提供给 LSA 凭据。

文件 Ksecdd.sys 管理和对这些凭据进行加密并使用到 LSA 本地过程调用。 文件类型是 DRV （驱动程序），作为内核模式安全支持提供程序 (SSP) 以及在中指定这些版本称为**适用于**本主题开头位置列表中，是 FIPS 140-2 级别 1 兼容。

内核模式下具有完全访问权限的计算机的硬件和系统资源。 内核模式下停止用户模式服务和应用程序访问关键的区域，不应有权访问的操作系统。

## <a name="BKMK_LSA"></a>本地安全机构
本地安全机构 (LSA) 是进行身份验证并使用户登录到本地计算机的受保护的系统进程。 此外，LSA 还维护所有方面的信息本地安全的计算机上 （这些方面统称为本地安全策略），并提供各种服务的名称和安全标识符 (Sid) 之间的转换。 跟踪的安全系统期间，本地安全机构服务器服务 (LSASS)，安全策略和有效的计算机系统上的帐户。

LSA 验证用户的标识基于所颁发用户的帐户的以下两个实体：

-   **本地安全机构。** LSA 可以通过检查位于同一台计算机上的安全帐户管理器 (SAM) 数据库来验证用户的信息。 任何工作站或成员服务器可以存储本地用户帐户和有关本地组的信息。 但是，这些帐户可以用于访问该工作站或计算机。

-   **在本地域或受信任的域的安全机构。** LSA 联系颁发帐户实体和请求验证该帐户是有效并且从帐户持有者发出的请求。

本地安全机构子系统服务 (LSASS) 通过活动 Windows 会话以用户的名义将凭据存储在内存中。 存储的凭据，用户可以无缝地访问网络资源，如文件共享、 Exchange Server 邮箱和 SharePoint 站点，而无需重新输入其凭据的每个远程服务。

LSASS 可以采用多种形式来存储凭据，包括：

-   反向加密的纯文本

-   Kerberos 票证 （票证授予票证 (Tgt)，服务票证）

-   NT 哈希

-   LAN Manager (LM) 哈希

如果用户登录到 Windows 使用智能卡，LSASS 不会存储纯文本密码，但它将存储帐户和智能卡的纯文本 PIN 对应的 NT 哈希值。 如果为交互式登录所需智能卡启用了帐户属性，将自动为该帐户生成一个随机的 NT 哈希值（而非原始密码哈希）。 在设置属性时自动生成的密码哈希不会发生更改。

如果用户登录到基于 Windows 的计算机使用 LAN Manager (LM) 哈希与兼容的密码，此身份验证者是存在于内存中。

无法禁用内存中纯文本凭据的存储，即使禁用需要它们的凭据提供程序也是如此。

存储的凭据直接与相关联的本地安全机构子系统服务 (LSASS) 登录会话上次启动的重新启动和未关闭。 例如，当用户执行以下任何操作时，都会创建带有已存储 LSA 凭据的 LSA 会话：

-   登录到本地会话或计算机上的远程桌面协议 (RDP) 会话

-   使用“RunAs”选项运行任务

-   在计算机上运行活动的 Windows 服务

-   运行计划任务或者批处理作业

-   使用远程管理工具在本地计算机上运行任务

在某些情况下，是机密的只有 SYSTEM 帐户进程才能访问的数据片段，了解这些 LSA 机密存储在硬盘驱动器上。 其中一些机密是重新启动后必须保留的凭据，并且它们以加密的形式存储在硬盘驱动器上。 存储为 LSA 机密的凭据可能包括：

-   计算机的 Active Directory 域服务 (AD DS) 帐户的帐户密码

-   在计算机上配置的 Windows 服务的帐户密码

-   用于已配置的计划任务的帐户密码

-   用于 IIS 应用程序池和网站的帐户密码

-   Microsoft 帐户的密码

在 Windows 8.1 中引入，客户端操作系统提供为 LSA 来防止读取内存及注入代码非受保护的进程的额外保护。 这种保护可提高安全性 LSA 存储和管理的凭据。

有关这些额外的保护的详细信息，请参阅[Configuring Additional LSA Protection](../credentials-protection-and-management/configuring-additional-lsa-protection.md)。

## <a name="BKMK_CachedCredentialsAndValidation"></a>缓存的凭据和验证
验证机制依赖于在登录的时间表示法的凭据。 但是，当计算机与域控制器、 断开和用户提供域凭据，Windows 使用缓存的凭据的过程中的验证机制。

用户登录到域中，每次 Windows 缓存提供的凭据，并将它们存储在注册表中的安全配置单元的操作系统。

使用缓存凭据，用户可以登录到域成员无需连接到该域中域控制器。


## <a name="BKMK_CredentialStorageAndValidation"></a>凭据存储和验证
它并不总是可取一组凭据用于不同的资源的访问权限。 例如，管理员可能想要使用管理而不是用户凭据访问远程服务器时。 同样，如果用户访问外部资源，例如银行帐户，他或她可以只使用不同于其域凭据的凭据。 以下部分介绍在凭据管理当前版本的 Windows 操作系统和在 Windows Vista 和 Windows XP 操作系统之间的差异。

### <a name="remote-logon-credential-processes"></a>远程登录凭据进程
远程桌面协议 (RDP) 管理连接到远程计算机使用远程桌面客户端，在 Windows 8 中引入的用户的凭据。 以纯文本形式的凭据发送到目标主机，主机尝试执行身份验证过程中，并且，如果成功，将用户连接到允许的资源。 RDP 不存储在客户端上的凭据，但用户的域凭据存储在 LSASS。

在 Windows Server 2012 R2 和 Windows 8.1 中引入，受限管理模式提供了到远程登录方案的其他安全。 此模式的远程桌面将导致客户端应用程序来执行网络登录质询-响应使用 NT 单向函数 (NTOWF) 或进行身份验证到远程主机时使用 Kerberos 服务票证。 管理员进行身份验证后，管理员没有相应的帐户凭据在 LSASS 因为它们并没有提供到远程主机。 相反，管理员必须为该会话的计算机帐户凭据。 不到远程主机上，提供管理员凭据，以便为计算机帐户执行操作。 资源也限制为计算机帐户，并且管理员不能访问具有其自己帐户的资源。

### <a name="automatic-restart-sign-on-credential-process"></a>自动重新启动登录凭据处理
当用户登录 Windows 8.1 设备上时，LSA 将保存在只能由 LSASS.exe 访问的加密内存中的用户凭据。 当 Windows 更新启动时自动重新启动而无需用户状态显示时，这些凭据用于为用户配置自动登录。

在重新启动，自动登录机制，通过自动登录用户和计算机此外，则锁定以保护用户的会话。 凭据管理通过在 LSA 而，锁定是通过 Winlogon 启动。 通过自动登录并在控制台上锁定用户的会话，用户的锁定屏幕应用程序是重新启动并可用。

有关 ARSO 详细信息，请参阅[Winlogon 自动重新启动登录&#40;ARSO&#41;](winlogon-automatic-restart-sign-on-arso.md)。

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>存储的用户名和 Windows Vista 和 Windows XP 中的密码
在 Windows Server 2008、 Windows Server 2003、 Windows Vista 和 Windows XP**存储的用户名和密码**控制面板中简化了管理和使用的登录凭据，包括使用的 X.509 证书的多个集与智能卡和 Windows Live 凭据 （现在称为 Microsoft 帐户）。 需要时才存储凭据的用户的配置文件的一部分的。 此操作可以通过确保，如果一个密码已泄露，它不会降低所有安全性提高按每个资源的安全性。

用户登录并尝试访问其他受密码保护的资源，如服务器上的共享后，如果用户的默认登录凭据没有足够权限来获取访问权限**存储的用户名和密码**查询. 如果已具有正确的登录信息的备用凭据保存在**存储的用户名和密码**，这些凭据用来访问。 否则，提示用户提供新凭据，然后保存以重新使用，更高版本在登录会话中或在后续会话。

以下限制适用：

-   如果**存储的用户名和密码**包含无效或不正确的凭据用于特定的资源，对资源的访问被拒绝，并且**存储的用户名和密码**对话框不显示。

-   **存储用户名和密码**将凭据存储仅对 NTLM、 Kerberos 协议的 Microsoft 帐户 (以前称为 Windows Live ID) 和安全套接字层 (SSL) 身份验证。 某些版本的 Internet Explorer 维护其自己的缓存进行基本身份验证。

这些凭据会变得 \Documents 和 Settings\Username\Application Data\Microsoft\Credentials 目录中用户的本地配置文件的加密的部分。 因此，这些凭据可以随一起漫游用户如果用户的网络策略支持漫游用户配置文件。 但是，如果用户具有的副本**存储的用户名和密码**在两个不同的计算机和更改与上一台计算机，资源相关联的凭据更改不会传播到**存储用户名和密码**第二台计算机上。

### <a name="windows-vault-and-credential-manager"></a>Windows 保管库和凭据管理器
为要存储和管理用户名和密码的控制面板功能在 Windows Server 2008 R2 和 Windows 7 引入了凭据管理器。 凭据管理器允许用户在安全的 Windows 保管库中存储凭据与其他系统和网站。 某些版本的 Internet 资源管理器对网站进行身份验证使用此功能。

使用凭据管理器管理凭据，由本地计算机用户控制。 用户可以从支持的浏览器和 Windows 应用程序保存和存储凭据，需要登录到这些资源时非常方便。 在用户的配置文件下的计算机上，在特殊加密文件夹中保存凭据。 支持 （通过使用凭据管理器 Api)，如 web 浏览器和应用程序，此功能的应用程序可以在登录过程中提供的其他计算机和网站到正确的凭据。

当网站、 应用程序或另一台计算机请求的身份验证通过 NTLM 或 Kerberos 协议，会出现一个对话框中，您选择的这**更新默认凭据**或**保存密码**复选框。 此对话框，用于保存本地凭据的用户生成的支持凭据管理器 Api 的应用程序。 如果用户选择**保存密码**复选框，凭据管理器跟踪的用户的用户名、 密码和正在使用的身份验证服务的相关的信息。

下一次使用该服务时，凭据管理器自动提供 Windows 保管库中存储的凭据。 如果未接受凭据，将提示用户提供正确的访问信息。 如果使用新凭据授予访问权限，凭据管理器使用新覆盖以前的凭据，然后将新的凭据存储 Windows 保管库中。

## <a name="BKMK_SAM"></a>安全帐户管理器数据库
安全帐户管理器 (SAM) 是用于存储本地用户帐户和组的数据库。 每个 Windows 操作系统; 中存在但是，当计算机加入到域后，Active Directory 管理 Active Directory 域中的域帐户。

例如，运行 Windows 操作系统的客户端计算机加入网络域通过与域控制器通信，即使没有用户登录。 若要启动的通信，计算机必须在域中具有一个有效的帐户。 在接受来自计算机的通信，域控制器上的 LSA 对计算机的身份进行身份验证，然后就像人的安全主体的操作一样，构造计算机的安全上下文。 此安全上下文在特定计算机或用户、 服务或网络上的计算机上定义的标识和用户或服务的功能。 例如，访问令牌包含在安全上下文中定义的可访问的资源 （例如文件共享或打印机） 和该主体的用户、 计算机或服务上的可执行的操作 （如读取、 写入或修改）资源。

用户或计算机的安全上下文而异从一台计算机到另一个，例如当用户登录到服务器或用户的主工作站之外的工作站。 它还可以到另一个，如当管理员修改用户的权限和权限从一个会话改变。 此外，安全上下文是通常不同，当在独立模式中，在网络中，或作为 Active Directory 域的一部分运行时的用户或计算机。

## <a name="BKMK_LocalDomainsAndTrustedDomains"></a>本地域和受信任的域
当两个域之间存在信任关系时，每个域的身份验证机制依赖于来自其他域身份验证的有效性。 信任帮助用于提供对资源域 （信任域） 中的共享资源的受控的访问通过验证传入的身份验证请求是来自受信任颁发机构 （受信任域）。 这样一来，仅允许的桥接器验证身份验证请求的域之间的差旅充当信任关系。

特定信任将身份验证请求传递的方式取决于其配置方式。 信任关系可以是单向的通过提供访问从受信任的域信任域中的资源或双向的通过从每个域对其他域中的资源的访问。 信任关系也是不可传递信任仅域之间存在两个信任合作伙伴，这种情况下或可传递的在这种情况下信任自动扩展到两个伙伴信任的任何其他域。

有关身份验证的域和林信任关系有关的信息，请参阅[委派的身份验证和信任关系](https://technet.microsoft.com/library/dn169022.aspx)。

## <a name="BKMK_CertificatesInWindowsAuthentication"></a>在 Windows 身份验证的证书
公钥基础结构 (PKI) 是软件、 加密技术、 流程和服务，可让组织来保护其通信与业务事务的组合。 PKI 的能力来保护通信和业务交易基于数字之间交换证书身份验证的用户和受信任的资源。

数字证书是电子文档，其中包含有关其所属的实体、 颁发者的实体、 唯一的序列号或其他唯一的标识、 颁发和到期日期和数字指纹的信息。

身份验证是确定是否可信任远程主机的过程。 若要建立其可信度，远程主机必须提供一个可接受的身份验证证书。

远程主机建立它们可以向您通过从证书颁发机构 (CA) 获取证书。 CA 又可以从更高版本的颁发机构，这将创建的信任链的证书。 若要确定是否可信任证书，应用程序必须确定根 CA，标识，然后确定它是否可信任。

同样，远程主机或本地计算机必须确定用户或应用程序提供的证书是否可信。 由用户通过 LSA 和 SSPI 提供的证书的真实性本地计算机上的本地登录、 网络或域上评估通过 Active Directory 中的证书存储。

若要生成证书，身份验证数据通过传递哈希算法，如安全哈希算法 1 (SHA1)，以生成消息摘要。 消息摘要进行数字签名使用发件人的私钥来证明消息摘要由发件人生成。

> [!NOTE]
> SHA1 是 Windows 7 和 Windows Vista 中的默认值，但已更改为 Windows 8 中 SHA2。

**智能卡身份验证**

智能卡技术是基于证书的身份验证的示例。 登录到使用智能卡的网络提供了强形式的身份验证，因为它使用基于加密的标识和所有权证明的域用户进行身份验证时。 Active Directory 证书服务 (AD CS) 提供了基于加密的通过颁发的标识每个智能卡登录证书。

有关智能卡身份验证的信息，请参阅[Windows 智能卡技术参考](https://technet.microsoft.com/library/ff404297.aspx)。

Windows 8 中引入了虚拟智能卡技术。 它在 PC 中存储智能卡证书，然后通过使用设备的防篡改的受信任的平台模块 (TPM) 安全芯片来保护。 这样一来，PC 实际上成为了智能卡必须接收以便进行身份验证的用户的 PIN。

**远程和无线身份验证**

远程和无线网络身份验证是使用证书进行身份验证的另一种技术。 Internet 身份验证服务 (IAS) 和虚拟专用网络服务器用于可扩展身份验证协议-传输级别安全 (EAP-TLS)、 受保护的可扩展身份验证协议 (PEAP) 或 Internet 协议安全 (IPsec)对于许多类型的网络访问权限，包括虚拟专用网络 (VPN) 和无线连接执行基于证书的身份验证。

有关在网络中基于证书的身份验证的信息，请参阅[网络访问身份验证和证书](https://technet.microsoft.com/library/cc759575(WS.10).aspx)。

## <a name="BKMK_SeeAlso"></a>另请参阅
[Windows 身份验证概念](https://technet.microsoft.com/library/d169018.aspx)


