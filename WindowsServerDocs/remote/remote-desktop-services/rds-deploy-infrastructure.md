---
title: 部署远程桌面环境
ms.custom: na
ms.prod: windows-server-threshold
description: 部署远程桌面环境的基本步骤。
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.author: elizapo
ms.date: 04/10/2017
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
manager: dongill
ms.localizationpriority: medium
ms.openlocfilehash: a5a56d56038d94869c5246f8d4d3eae2796616a3
ms.sourcegitcommit: d3f73936160505a40633ad8dd5931ac5fe3eccdb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/12/2019
ms.locfileid: "9297436"
---
# 部署远程桌面环境

>适用于： Windows Server （半年频道）、 Windows Server 2019、 Windows Server 2016

使用以下步骤部署你的环境中的远程桌面服务器。 你可以在物理计算机或虚拟机，具体取决于是否要创建的本地基于云的混合环境中安装的服务器角色。 

如果你为任何远程桌面服务服务器使用虚拟机，请确保你已[准备好这些虚拟机](rds-prepare-vms.md)。
  
  
1.  添加要用于远程桌面服务到服务器管理器的所有服务器：  
    1.  在服务器管理器中单击**管理 > 添加服务器**。  
    2.  单击**开始查找**。  
    3.  单击每个服务器部署 （例如，Contoso Cb1、 Contoso WebGw1 和 Contoso Sh1） 中的，单击**确定**。  
2.  创建基于会话的部署来部署远程桌面服务组件：  
    1.  在服务器管理器中，单击**管理 > 添加角色和功能**。  
    2.  单击**远程桌面服务安装**、**标准部署**和**基于会话的桌面部署**。  
    3.  选择适当的服务器 RD 连接代理服务器、 RD Web 访问服务器和 RD 会话主机服务器 (例如，Contoso Cb1、 Contoso WebGw1，和 Contoso SH1，分别)。  
    4.  选择**重新启动目标服务器，自动如果需要**，，然后单击**部署**。  
    5.  等待部署成功完成  
3.  添加 RD 许可证服务器：  
    1.  在服务器管理器中，单击**远程桌面服务 > 概述 > + RD 授权**。  
    2.  选择虚拟机 RD 许可证服务器 （例如，Contoso Cb1） 的安装位置。  
    3.  单击**下一步**，，然后单击**添加**。  
4.  启用远程桌面许可证服务器并将其添加到许可证服务器组：  
    1.  在服务器管理器中，单击**工具 > 终端服务 > 远程桌面授权管理器**。  
    2.  在 RD 许可管理器中，选择服务器，然后单击**操作 > 激活服务器**。  
    3.  接受服务器激活向导接受默认设置，直到到达**公司信息**页中的默认值。 然后，输入你公司的信息。  
    4.  直到最后一页接受的其余页面的默认值。 清除**立即启动许可证安装向导**中，，然后单击**完成**。  
    5.  单击**操作 > 查看配置 > 将添加到组 > 确定**。 在 AAD DC 管理员组中，为用户输入凭据和注册为 SCP。 如果你使用 Azure AD 域服务，但你可以忽略任何警告或错误，此步骤可能不起作用。  
5.  添加 RD 网关服务器和证书名称：  
    1.  在服务器管理器中，单击**远程桌面服务 > 概述 > + RD 网关**。  
    2.  添加 RD 网关服务器向导中，选择你想要安装 RD 网关服务器 (例如，Contoso WebGw1) 在虚拟机。  
    3.  输入使用 RD 网关服务器的外部完全限定 DNS 名称 (FQDN) RD 网关服务器的 SSL 证书名称。 在 Azure，这是**DNS 名称**标签并使用格式 servicename.location.cloudapp.azure.com。 例如，contoso.westus.cloudapp.azure.com。  
    4.  单击**下一步**，，然后单击**添加**。
6.  创建并安装自签名的证书的 RD 网关和 RD 连接代理服务器。

       > [!NOTE]
       > 如果你是提供并安装从受信任的证书颁发机构的证书，请从步骤 h 以步骤为每个角色的 k 执行的过程。 你将需要这些证书的每个有可用的.pfx 文件。
       
    1.  在服务器管理器中，单击**远程桌面服务 > 概述 > 任务 > 编辑部署属性**。  
    2.  展开**证书**，然后向下滚动到表。 单击**RD 网关 > 创建新证书**。  
    3.  输入证书的名称，使用 RD 网关服务器 (例如，contoso.westus.cloudapp.azure.com) 的外部 FQDN，然后输入密码。  
    4.  选择**存储此证书**，然后浏览到上一步中的证书创建的共享文件夹。 （例如，\Contoso Cb1\Certificates。）  
    5.  输入证书 (例如，ContosoRdGwCert) 的文件名称，然后单击**保存**。  
    6.  选择**允许的证书将添加到目标计算机上受信任的根证书颁发机构证书存储**，然后单击**确定**。  
    7.  单击**应用**，然后等待要成功应用到 RD 网关服务器的证书。  
    8.  单击**RD Web 访问 > 选择现有的证书**。  
    9.  浏览到为 RD 网关服务器 (例如，ContosoRdGwCert) 创建的证书，然后单击**打开**。  
    10. 对于证书，请选择输入密码**允许证书要添加到目标计算机的受信任的根证书存储**，然后单击**确定**。  
    11. 单击**应用**，然后等待要成功应用到 RD Web 访问服务器的证书。  
    12. 重复子步骤 1-11 的**RD 连接代理-启用单一登录**和**RD 连接代理-发布服务**，使用 RD 连接代理服务器的内部 FQDN （例如，新证书的名称Contoso-Cb1.Contoso.com)。  
7.  导出自签名的公共证书并将它们复制到客户端计算机。 如果你使用的从受信任的证书颁发机构的证书，你可以跳过此步骤。  
    1.  启动 certlm.msc。  
    2.  展开**个人**，然后单击**证书**。  
    3.  在右侧窗格中右键单击用于客户端身份验证，例如**Contoso Cb1.Contoso.com**RD 连接代理证书。  
    4.  单击**所有任务 > 导出**。  
    5.  接受证书导出向导中的默认选项接受默认值，直到到达**导出到文件**页。  
    6.  浏览到你创建证书，例如 \Contoso-Cb1\Certificates 的共享文件夹。  
    7.  输入文件的名称，例如 ContosoCbClientCert，，然后单击**保存**。  
    8.  单击**下一步**，，然后单击**完成**。  
    9.  重复子步骤 1-8 个 RD 网关和 Web 证书，(例如 contoso.westus.cloudapp.azure.com)，提供了相应的文件名称，例如**ContosoWebGwClientCert**的导出的证书。  
    10. 在文件资源管理器，导航到文件夹证书的存储位置，例如 \Contoso-Cb1\Certificates。  
    11. 选择两个导出客户端证书，然后右键单击它们，然后单击**复制**。  
    12. 粘贴在本地客户端计算机上的证书。  
8.  配置 RD 网关和 RD 授权部署属性：  
    1.  在服务器管理器中，单击**远程桌面服务 > 概述 > 任务 > 编辑部署属性**。  
    2.  展开**RD 网关**，清除**对于本地地址绕过 RD 网关服务器**选项。  
    3.  展开**RD 授权**，然后选择**每个用户**  
    4.  单击**确定**。  
10. 创建会话集合。 以下步骤创建一个基本的集合。 有关集合的详细信息，请查看[创建适用于桌面版和应用运行远程桌面服务集合](rds-create-collection.md)。
 
    1.  在服务器管理器中，单击**远程桌面服务 > 集合 > 任务 > 创建会话集合**。  
    2.  输入一个名称 (例如，ContosoDesktop)。  
    3.  选择 RD 会话主机服务器 (Contoso Sh1)，接受默认用户组 （Contoso\Domain 用户），并输入 (\Contoso-Cb1\UserDisks) 上面创建的用户配置文件磁盘的通用命名约定 (UNC) 路径。  
    4.  设置最大大小，然后单击**创建**。  
  

你现在已创建基本的远程桌面服务基础结构。 如果你需要创建高度可用部署，你可以添加[连接代理群集](rds-connection-broker-cluster.md)或[第二个 RD 会话主机服务器](rds-scale-rdsh-farm.md)。

