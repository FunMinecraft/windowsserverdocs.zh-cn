---
title: 将可用性组添加到 RD Web 和网关的 web 前端
description: 提供在 RDS 部署中安装 RD Web 和网关服务器的步骤。
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
ms.author: elizapo
ms.date: 11/08/2016
manager: dongill
ms.openlocfilehash: fa09532e0b327b24ebb1c0e155c26c25d1043b63
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59854598"
---
# <a name="add-high-availability-to-the-rd-web-and-gateway-web-front"></a>将可用性组添加到 RD Web 和网关的 web 前端

>适用于：Windows 服务器 （半年频道），Windows Server 2016


可以部署远程桌面 Web 访问 （RD Web 访问） 和远程桌面网关 （RD 网关） 场以提高可用性和 Windows Server 远程桌面服务 (RDS) 部署的规模 

使用以下步骤添加到现有的远程桌面服务基本部署 RD Web 和网关服务器。  

## <a name="pre-requisites"></a>先决条件

设置服务器可以充当其他 RD Web 和 RD 网关-这可以是物理服务器或 VM。 这包括将服务器加入到域和启用远程管理。

## <a name="step-1-configure-the-new-server-to-be-part-of-the-rds-environment"></a>第 1 步：新服务器配置为 RDS 环境的一部分

1. 连接到在 Azure 门户中，使用远程桌面连接客户端 RDMS 服务器。
2. 添加新的 RD Web 和网关服务器到服务器管理器：
    1. 启动服务器管理器中，单击**管理 > 添加服务器**。   
    2. 在添加服务器对话框中，单击**立即查找**。   
    3. 选择新创建的 RD Web 和网关服务器 (例如，Contoso WebGw2)，然后单击**确定**。
3. 将 RD Web 和网关服务器添加到部署  
    1. 启动服务器管理器。  
    2. 单击**远程桌面服务 > 概述 > 部署服务器 > 任务 > 将 RD Web 访问服务器添加**。   
    3. 选择新创建的服务器 (例如，Contoso-WebGw2)，然后依次**下一步**。  
    4. 在确认页上选择**根据需要重新启动远程计算机**，然后单击**添加**。  
    5. 重复上述步骤，添加 RD 网关服务器，但选择**RD 网关服务器**在步骤 b 中。
4. 重新安装 RD 网关服务器的证书：
    1.  在服务器管理器 RDMS 服务器上，单击**远程桌面服务 > 概述 > 任务 > 编辑部署属性**。  
    2.  展开**证书**。  
    3.  向下滚动到表。 单击 RD**网关角色服务 > 选择现有证书。**  
    4.  单击**选择其他证书**，然后浏览到证书位置。 例如，\Contoso-CB1\Certificates)。 选择在系统必备组件 (例如 ContosoRdGwCert) 期间创建的 RD Web 和网关服务器的证书文件，然后单击**打开**。  
    5.  输入选择的证书的密码**允许证书添加到目标计算机上的受信任的根证书颁发机构证书存储**，然后单击**确定**。  
    6.  单击 **“应用”**。
    > [!Note] 
    > 您可能需要手动重新启动每个 RD 网关服务器，通过服务器管理器或任务管理器上运行的 TSGateway 服务。
    7.  重复步骤 a 到 f 的 RD Web 访问角色服务。

## <a name="step-2-configure-rd-web-and-rd-gateway-properties-on-the-new-server"></a>步骤 2：在新服务器上配置 RD Web 和 RD 网关属性
1. 服务器配置为 RD 网关场的一部分：
    1.  在服务器管理器 RDMS 服务器上，单击**的所有服务器**。 右键单击一个 RD 网关服务器，然后依次**远程桌面连接**。
    2.  登录到 RD 网关服务器使用域管理员帐户。  
    3.  在服务器管理器在 RD 网关服务器上，单击**工具 > 远程桌面服务 > RD 网关管理器**。  
    4.  在导航窗格中，单击本地计算机 (例如 Contoso WebGw1)。  
    5.  单击**添加 RD 网关服务器场成员**。  
    6.  上**服务器场**选项卡上，输入每个 RD 网关服务器名称，然后单击**添加**并**应用**。  
    7.  重复步骤 a 到 f 每个 RD 网关服务器上，以便它们将彼此将对方识别为 RD 网关服务器场中。 请勿惊慌如果会出现警告，因为它可能需要时间来传播的 DNS 设置。
2. 服务器配置为 RD Web 访问场的一部分。 执行以下步骤配置两个 RDWeb 站点上相同的验证和解密计算机密钥。
    1.  在服务器管理器 RDMS 服务器上，单击**的所有服务器**。 右键单击第一个 RD Web 访问服务器 (例如 Contoso WebGw1)，然后单击**远程桌面连接**。  
    2.  登录到 RD Web 访问服务器使用域管理员帐户。  
    3.  在服务器管理器在 RD Web 访问服务器上，单击**工具 > Internet 信息服务 (IIS) 管理器**。  
    4.  在 IIS 管理器的左窗格中，展开**服务器 (例如 Contoso WebGw1) > 站点 > Default Web Site**，然后单击**RDWeb**。  
    5.  右键单击**机器码**，然后单击**打开功能**。
    6.  在计算机密钥页上，在**操作**窗格中，选择**生成密钥**，然后单击**应用**。
    7.  复制验证密钥 (您可以右键单击该项，然后单击**复制**。)
    8.  在 IIS 管理器中下, **Default Web Site**，选择**馈送**， **FeedLogon**并**页**反过来。
    9. 为每个：
        1.  右键单击**机器码**，然后单击**打开功能**。
        2.  对于验证密钥，清除**运行时自动生成**，然后将粘贴在步骤 g 中复制的密钥。
    10.  最小化此 RD Web 服务器的远程桌面连接窗口。  
    11.  对于第二个 RD Web 访问服务器，结束时间的功能视图重复步骤 b 到 e**计算机密钥**。
    12. 对于验证密钥，清除**运行时自动生成**，然后将粘贴在步骤 g 中复制的密钥。
    13. 单击 **“应用”**。
    14. 完成此过程**RDWeb**，**馈送**， **FeedLogon**并**页**页。
    15. 最小化到第二个 RD Web 访问服务器，远程桌面连接窗口，然后使第一台 RD Web 访问服务器的远程桌面连接窗口最大化。  
    16. 重复步骤 g，通过 n 以通过解密密钥。
    17. 当验证密钥和解密密钥位于相同的两个 RD Web 访问服务器上**RDWeb**，**馈送**， **FeedLogon**和**页**页，注销所有远程桌面连接窗口。

## <a name="step-3-configure-load-balancing-for-the-rd-web-and-rd-gateway-servers"></a>步骤 3:为 RD Web 和 RD 网关服务器配置负载平衡

如果使用 Azure 基础结构，可以创建外部 Azure 负载均衡器;如果没有，可以设置单独的硬件或软件负载均衡器。 负载平衡是键，以便流量将均匀分布的生存期较长的连接从远程桌面客户端，通过 RD 网关，用户将运行其工作负荷的服务器。

> [!Note] 
> 如果以前运行 RD Web 和 RD 网关的服务器已设置了外部负载均衡器后，跳过一些步骤 4 中，选择现有的后端池，并将新服务器添加到池。

1.  创建 Azure 负载均衡器：  
    1.  在 Azure 门户中，单击**浏览 > 负载均衡器 > 添加**。  
    2.  输入一个名称，例如**WebGwLB**。  
    3.  选择**公共**有关**方案**，**公共 IP 地址**，和一个**公共 IP 地址**。 可以选择现有的公共 IP 地址，也可以创建一个新。 
    4.  选择适当**订阅**，**资源组**，并**位置**。
    5.  单击“创建”。  
2. 创建[探测](https://azure.microsoft.com/documentation/articles/load-balancer-custom-probe-overview/)到哪些服务器处于活动状态的监视器：  
    1.  在 Azure 门户中，单击**浏览 > 负载平衡器**。，负载均衡器是刚刚创建，例如 WebGwLB，设置  
    2.  单击**探测 > 添加**。  
    3.  例如，输入一个名称， **HTTPS**，探测。 选择**TCP**作为**协议**，然后输入**443**有关**端口**，然后单击**确定**。   
3.  创建 HTTPS 和 UDP 负载均衡规则：  
    1.  在中**设置**，单击**负载均衡规则**。  
    2.  选择**外**有关**HTTPS 规则**。  
    3.  输入规则名称，例如，HTTPS，并选择**TCP**有关**协议**。 输入**443**同时**端口**并**后端端口**，然后单击**确定**。  
    4.  在中**负载均衡规则**，单击**添加**有关**UDP 规则**。  
    5.  例如，输入规则的名称**UDP**，然后选择**UDP**有关**协议**。 输入**3391**同时**端口**并**后端端口**，然后单击**确定**。  
4. 创建在 RD Web 和 RD 网关服务器的后端池：
      1. 在中**设置**，单击**后端地址池 > 添加**。   
      2. 输入的名称 (例如， **WebGwBackendPool**)，然后单击**添加虚拟机**。  
      3. 选择可用性集 (例如，WebGwAvSet)，然后依次**确定**。   
      4. 单击**选择虚拟机**，选择每个虚拟机，，然后单击**选择 > 确定 > 确定**。
