---
title: 步骤 2 配置 APP1
description: 本主题是一部分的测试实验室指南-使用 OTP 身份验证和 Windows Server 2016 的 RSA SecurID 演示 DirectAccess
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 093f8215691b21d7b7fefc3b1c51f3a41af9bea6
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/20/2019
ms.locfileid: "67283136"
---
# <a name="step-2-configure-app1"></a>步骤 2 配置 APP1

>适用于：Windows 服务器 （半年频道），Windows Server 2016

使用以下步骤准备 APP1 OTP 支持：  
  
1. 若要创建和部署用于 OTP 证书申请进行签名的证书模板。 配置用于 OTP 证书申请进行签名的证书模板。  
  
2. 若要创建和部署 OTP 证书由企业 CA 颁发的证书模板。 配置 OTP 证书由企业 CA 颁发的证书模板。  
  
> [!WARNING]  
> 本测试实验室指南的设计包括基础结构服务器，如域控制器和运行的 Windows Server 2012 R2 或 Windows Server 2012 的证书颁发机构 (CA)。 使用本测试实验室指南来配置正在运行其他操作系统的基础结构服务器尚未经过测试，并配置其他操作系统的说明不属于本指南中。  
  
## <a name="DAOTPRA"></a>若要创建和部署用于 OTP 证书申请进行签名的证书模板  
  
1.  运行**certtmpl.msc**，然后按 ENTER。  
  
2.  在证书模板控制台的详细信息窗格中，右键单击**计算机**模板，然后单击**复制模板**。  
  
3.  上**新模板的属性**对话框中，在**兼容性**选项卡上，在**证书颁发机构**列表中，选择所需的操作系统和在**更改的结果**对话框中，单击**确定**。 在中**证书接收人**列表中选择所需的操作系统和在**产生的更改**对话框中，单击**确定**。  
  
4.  上**新模板的属性**对话框中，单击**常规**选项卡。  
  
5.  上**常规**选项卡上，在**模板显示名称**，类型**DAOTPRA**。 设置**有效期**为 2 天，并将**续订期**为 1 天。 如果**证书模板**就会显示警告，单击**确定**。  
  
6.  单击“安全性”  选项卡，然后单击“添加”  。  
  
7.  上**选择用户、 计算机、 服务帐户或组**对话框中，单击**对象类型**。 上**对象类型**对话框中，选择**计算机**，然后单击**确定**。 在中**输入要选择的对象名称**框中，键入**EDGE1**，单击**确定**，然后在**允许**列中，选择**读取**，**注册**，和**自动注册**复选框。 单击**Authenticated Users**，选择**读取**下的复选框**允许**列，并清除其他所有复选框。 单击**域的计算机**，并取消选中**注册**下**允许**列。 单击**Domain Admins**并**Enterprise Admins**然后单击**完全控制**下**允许**两个列。 单击 **“应用”** 。  
  
8.  单击**使用者名称**选项卡，然后依次**中的 Active Directory 信息生成**。 在中**使用者名称格式：** 列表中选择**DNS 名称**，请确保**DNS 名称**框处于选中状态，然后单击**应用**。  
  
9. 单击**扩展**选项卡上，选择**应用程序策略**，然后单击**编辑**。 删除所有现有应用程序策略。 单击**外**，然后在**添加应用程序策略**对话框中，单击**新建**，输入**DA OTP RA**中**名称：** 字段和**1.3.6.1.4.1.311.81.1.1**中**对象标识符：** 字段，然后单击**确定**。 上**添加应用程序策略**对话框中，单击**确定**。 上**编辑应用程序策略扩展**，单击**确定**。 上**新模板的属性**对话框中，单击**确定**。  
  
## <a name="DAOTPLogon"></a>若要创建和部署 OTP 证书由企业 CA 颁发的证书模板  
  
1.  在证书模板控制台的详细信息窗格中，右键单击**智能卡登录**模板，然后单击**复制模板**。  
  
2.  上**新模板的属性**对话框中，在**兼容性**选项卡中**证书颁发机构**列表中，单击操作系统你想要使用，并在**产生的更改**对话框中，单击**确定**。 在中**证书接收人**列表中，选择你想要使用，操作系统和在**产生的更改**对话框中，单击**确定**。  
  
3.  上**新模板的属性**对话框中，单击**常规**选项卡。  
  
4.  上**常规**选项卡上，在**模板显示名称**，类型**DAOTPLogon**。 在**有效期**，在下拉列表中，单击**小时**，然后在**证书模板**对话框中，单击**确定**，并确保小时数设置为 1。 在中**续订期**，类型**0**。  
  
    > [!IMPORTANT]  
    > **Windows Server 2003 CA**。 在运行 Windows Server 2003 的计算机的证书颁发机构 (CA) 所在的情况下，则证书模板必须配置的其他计算机上。 这是必需的因为设置**有效期**以小时为单位，则无法在运行 Windows Server 2008 和 Windows Vista 之前的 Windows 版本。 如果使用配置的模板的计算机不具有 Active Directory 证书服务服务器角色安装，或者它是客户端计算机，你可能需要安装证书模板管理单元。 有关详细信息，请参阅[安装证书模板管理单元](https://technet.microsoft.com/library/cc732445.aspx)。  
    >   
    > **Windows Server 2008 R2 CA**。 如果你已部署运行 Windows Server 2008 R2 的证书颁发机构 (CA)，则必须配置证书模板**续订期**为 1 或 2 个小时并**有效期**到能长于**续订期**，但不是超过 4 小时。 如果你配置证书模板**有效期**的时间超过 4 小时与正在运行 Windows Server 2008 R2 的 CA，DirectAccess 安装向导无法检测到的证书模板和 DirectAccess安装将失败。  
  
5.  单击**安全**选项卡上，选择**Authenticated Users**，在**允许**列中，然后选择**读取**和**注册**复选框。 单击 **“确定”** 。 单击**Domain Admins**并**Enterprise Admins**，然后单击**完全控制**下**允许**两个列。 单击 **“应用”** 。  
  
6.  单击**使用者名称**选项卡，然后依次**中的 Active Directory 信息生成**。 在中**使用者名称格式：** 列表中选择**完全可分辨的名称**，请确保**用户主体名称 (UPN)** 框处于选中状态，并单击**应用**.  
  
7.  单击**服务器**选项卡上，选择**CA 数据库中不能存储证书和请求**复选框，清除**不包括在颁发的证书吊销信息**复选框，然后在**新模板的属性**对话框中，单击**应用**。  
  
8.  单击**颁发要求**选项卡上，选择**授权签名的数量：** 复选框，将值设置为 1。 在中**签名中要求的策略类型：** 列表中选择**应用程序策略**，然后在**应用程序策略**列表中选择**DA OTP RA**. 上**新模板的属性**对话框中，单击**确定**。  
  
9. 单击**扩展**选项卡上，然后在**应用程序策略**单击**编辑**。 删除**客户端身份验证**，保留**SmartCardLogon**，然后单击**确定**两次。  
  
10. 关闭“证书模板控制台”。  
  
11. 上**启动**屏幕上，键入**certsrv.msc**，然后按 ENTER。  
  
12. 在证书颁发机构控制台树中，展开**corp-APP1-CA-1**，单击**证书模板**，右键单击**证书模板**，指向**新建**，然后单击**颁发的证书模板**。  
  
13. 在证书模板列表中，单击**DAOTPRA**并**DAOTPLogon**，然后单击**确定**。  
  
14. 在控制台的详细信息窗格中应会看到**DAOTPRA**使用的证书模板**预期目的**的**DA OTP RA**和**DAOTPLogon**使用的证书模板**预期目的**的**智能卡登录**。  
  
15. 重新启动服务。  
  
16. 关闭证书颁发机构控制台。  
  
17. 打开提升的命令提示符。 类型**CertUtil.exe-SetReg DBFlags + DBFLAGS_ENABLEVOLATILEREQUESTS**，然后按 ENTER。  
  
18. 保持命令提示符窗口打开状态下一步。  
  


