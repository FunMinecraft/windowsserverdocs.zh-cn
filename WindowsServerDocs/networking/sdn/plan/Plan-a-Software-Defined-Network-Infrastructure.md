---
title: 规划软件定义的网络基础结构
description: 本主题提供有关如何规划软件定义网络 (SDN) 基础结构部署的信息。
manager: dougkim
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: virtual-network
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: ea7e53c8-11ec-410b-b287-897c7aaafb13
ms.author: pashort
author: shortpatti
ms.date: 08/10/2018
ms.openlocfilehash: 16511628e979a95433360b0a3e900a89e9ba56eb
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446273"
---
# <a name="plan-a-software-defined-network-infrastructure"></a>规划软件定义的网络基础结构

>适用于：Windows 服务器 （半年频道），Windows Server 2016

了解有关部署规划软件定义的网络基础结构，包括硬件和软件先决条件。 


## <a name="prerequisites"></a>系统必备
本主题介绍了大量硬件和软件先决条件，包括：

-   **配置安全组、 日志文件位置和动态 DNS 注册**必须部署网络控制器，这需要一个或多个计算机或 Vm 和一台计算机或 VM 准备你的数据中心。 部署网络控制器之前，必须配置安全组、 日志文件位置 （如果需要） 和动态 DNS 注册。  如果尚未将你的数据中心做好部署网络控制器，请参阅[安装和部署网络控制器的准备要求](Installation-and-Preparation-Requirements-for-Deploying-Network-Controller.md)有关详细信息。

-   **物理网络**到物理网络设备以配置 Vlan、 路由、 BGP、 数据中心桥接 (ETS) 如果使用 RDMA 技术，需要访问和数据中心桥接 (PFC) 如果使用 RoCE 基于 RDMA 技术。 本主题说明手动切换配置以及 BGP 对等互连在第 3 层交换机 / 路由器或路由和远程访问服务器 (RRAS) 的虚拟机。   

-   **物理计算主机**这些主机运行的 HYPER-V 和所需的主机 SDN 基础结构和租户虚拟机。  为了获得最佳性能，更高版本中所述这些主机中需要特定的网络硬件**网络硬件**部分。  


## <a name="physical-network-and-compute-host-configuration"></a>物理网络和计算主机配置

每个物理计算主机需要通过一个或多个网络适配器连接到物理交换机端口的网络连接。  2 层[VLAN](https://en.wikipedia.org/wiki/Virtual_LAN)支持网络划分为多个逻辑网络段。 

>[!TIP]
>表示用于访问模式中的逻辑网络的 VLAN 0 或无标记。 

>[!IMPORTANT]
>Windows Server 2016 软件定义的网络支持 IPv4 寻址下衬和覆盖层。 不支持 IPv6。

### <a name="logical-networks"></a>逻辑网络

#### <a name="management-and-hnv-provider"></a>管理和 HNV 提供程序 

所有物理计算主机必须访问管理逻辑网络和 HNV 提供程序逻辑网络。  对于计划的目的 IP 地址，每个物理计算主机必须具有至少一个管理逻辑网络中分配的 IP 地址。 网络控制器需要保留的 IP 地址，以用作 REST IP 地址。 

DHCP 服务器可自动分配 IP 地址管理网络，或也可以手动分配静态 IP 地址。 SDN 堆栈会自动分配 HNV 提供程序逻辑网络的 IP 池中的各个 HYPER-V 主机通过指定和管理由网络控制器的 IP 地址。 

>[!NOTE]
>只有在网络控制器主机代理收到特定租户虚拟机的网络策略后，网络控制器将 HNV 提供程序 IP 地址分配给物理计算主机中。 


|                                                               如果...                                                               |                                                                                                                                                                          则...                                                                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                  逻辑网络使用 Vlan，                                                  |                                                                 物理计算主机必须连接到有权访问这些 Vlan 中继交换机端口。 请务必注意，计算机主机上的物理网络适配器不能激活任何 VLAN 筛选。                                                                 |
|                使用 Switched-Embedded 组合 (SET)，并且存在多个 NIC 团队成员，例如网络适配器                |                                                                                                                        你必须连接的所有 NIC 团队成员相同的第 2 层广播域到该特定主机。                                                                                                                         |
| 物理计算主机正在运行其他基础结构虚拟机，如网络控制器、 SLB/MUX 或网关， | 该主机必须具有从管理逻辑网络分配的托管的虚拟机的每个附加的 IP 地址。<p>此外，基础结构的每个 SLB/MUX 虚拟机必须具有为 HNV 提供程序逻辑网络保留的 IP 地址。 不能保留的 IP 地址可能会导致您网络上的重复 IP 地址。 |

---

了解有关 HYPER-V 网络虚拟化 (HNV)，您可以使用虚拟化 Microsoft SDN 部署中的网络，请参阅[HYPER-V 网络虚拟化](../technologies/hyper-v-network-virtualization/Hyper-V-Network-Virtualization.md)。  



#### <a name="gateways-and-the-software-load-balancer"></a>网关和软件负载均衡器

其他逻辑网络需要创建和预配的网关和 SLB 使用情况。 请确保要获取正确的 IP 前缀、 VLAN Id，以及这些网络的网关 IP 地址。


|                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   **传输逻辑网络**   | RAS 网关和 SLB/MUX 使用传输逻辑网络交换 BGP 对等信息和北部/南部 （外部内部） 租户通信。 此子网的大小通常会比其他较小。 只有运行 RAS 网关或 SLB/MUX 虚拟机的物理计算主机需要计算主机的网络适配器连接到的交换机端口上具有连接到这些 vlan 中继和可访问此子网。 每个 SLB/MUX 或 RAS 网关虚拟机以静态方式分配一个 IP 地址从传输逻辑网络。 |
| **公共 VIP 逻辑网络**  |                                                                                                                             公共 VIP 逻辑网络需要具有在云环境 (通常为 Internet 可路由) 外部进行路由的 IP 子网前缀。  这些将是外部客户端用于访问包括用于站点到站点网关的前端 VIP 的虚拟网络中的资源的前端 IP 地址。                                                                                                                             |
| **专用 VIP 逻辑网络** |                                                                                                                                                                                       专用 VIP 逻辑网络不需要可路由在云以外，因为它用于从内部云客户端，如 SLB 管理器或专用服务只能访问的 Vip。                                                                                                                                                                                       |
|   **GRE VIP 逻辑网络**   |                                                                                                                                           GRE VIP 网络是单独存在，用于定义分配给网关 S2S GRE 连接类型在 SDN 构造上运行的虚拟机的 Vip 的子网。 此网络不会不需要在物理交换机或路由器中预配置，并且需要分配 vlan。                                                                                                                                            |

---


#### <a name="sample-network-topology"></a>示例网络拓扑
更改环境的示例 IP 子网前缀和 VLAN Id。 


| **网络名称** |  **Subnet**  | **掩码** | **在卡车的 VLAN ID** | **Gateway**  |                                                           **保留项 （示例）**                                                           |
|------------------|--------------|----------|----------------------|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
|    Management    | 10.184.108.0 |    24    |          7           | 10.184.108.1 | 10.184.108.1 – Router10.184.108.4-网络 Controller10.184.108.10-计算主机 110.184.108.11 的计算托管 210.184.108.X-计算主机 X |
|   HNV 提供程序   |  10.10.56.0  |    23    |          11          |  10.10.56.1  |                                                    10.10.56.1 – Router10.10.56.2 - SLB/MUX1                                                     |
|     传输      |  10.10.10.0  |    24    |          10          |  10.10.10.1  |                                                               10.10.10.1 – 路由器                                                               |
|    公共 VIP    |  41.40.40.0  |    27    |          NA          |  41.40.40.1  |                                    41.40.40.1 – Router41.40.40.2 SLB/MUX VIP41.40.40.3-IPSec S2S VPN VIP                                    |
|   专用 VIP    |  20.20.20.0  |    27    |          NA          |  20.20.20.1  |                                                        20.20.20.1-默认网关 （路由器）                                                         |
|     GRE VIP      |  31.30.30.0  |    24    |          NA          |  31.30.30.1  |                                                             31.30.30.1-默认 GW                                                             |

---

### <a name="logical-networks-required-for-rdma-based-storage"></a>对于基于 RDMA 的存储所需的逻辑网络  

如果使用基于 RDMA 的存储，定义计算和存储主机中的 VLAN 和子网为每个物理适配器 （每个节点的两个适配器）。  

>[!IMPORTANT]
>为服务质量 (QoS) 来适当地应用，物理交换机需要 RDMA 流量标记的 VLAN。

| **网络名称** |  **Subnet**  | **掩码** | **在卡车的 VLAN ID** | **Gateway**  |                                                           **保留项 （示例）**                                                            |
|------------------|--------------|----------|----------------------|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
|     storage1     |  10.60.36.0  |    25    |          8           |  10.60.36.1  |  10.60.36.1 – 路由器<p>10.60.36.X-计算主机 X<p>10.60.36.Y-计算主机 Y<p>10.60.36.V-计算群集<p>10.60.36.W-存储群集  |
|     storage2     | 10.60.36.128 |    25    |          9           | 10.60.36.129 | 10.60.36.129 – 路由器<p>10.60.36.X-计算主机 X<p>10.60.36.Y-计算主机 Y<p>10.60.36.V-计算群集<p>10.60.36.W-存储群集 |

---


## <a name="routing-infrastructure"></a>路由基础结构  

如果要部署使用脚本为 SDN 基础结构，管理、 HNV 提供程序、 传输和 VIP 子网必须可路由到其他物理网络上。     

路由信息\(例如一跃点\)为 VIP 子网由播发的 SLB/MUX 和 RAS 网关到物理网络中使用内部 BGP 对等互连。 VIP 逻辑网络不是第 2 层交换机 （例如机架顶部交换机） 中预配置，并不一定分配 VLAN。  

需要创建在 SDN 基础结构用来接收播发的 SLB/Mux 和 RAS 网关的 VIP 逻辑网络的路由在路由器上的 BGP 对等节点。 BGP 对等互连只需进行的一种方法 （从 SLB/MUX 或外部的 BGP 对等方的 RAS 网关）。  上面的第一层的路由，则可以使用静态路由或另一个的动态路由协议，如 OSPF，但是，如前文所述，VIP 逻辑网络的 IP 子网前缀需要可从物理网络路由到外部的 BGP 对等节点。   

在托管的交换机或路由器的网络基础结构的一部分，通常配置 BGP 对等互连。 BGP 对等节点也是 Windows Server 上配置在仅路由模式下安装了远程访问服务器 (RAS) 角色。 必须配置网络基础结构中的此 BGP 路由器对等方拥有其自己的 ASN，并允许从一个 ASN。 分配给 SDN 组件对等互连\(SLB/MUX 和 RAS 网关\)。 从物理路由器，或从该路由器的控件中的网络管理员，必须获取以下信息：

- 路由器 ASN  
- 路由器 IP 地址  
- 用于 SDN 组件 （可以是专用 ASN 范围从任何 AS 编号） 的 ASN

>[!NOTE]
>通过在 SLB/MUX 不支持四个字节的 Asn。 你必须将两个字节的 Asn 分配给 SLB/MUX 和路由器 wo 的连接。 可以在环境中的其他位置使用 4 个字节的 Asn。  

你或你的网络管理员必须配置 BGP 路由器对等节点，以接受来自 ASN 和 IP 地址或子网地址的 RAS 网关和 SLB/Mux 使用传输逻辑网络的连接。

有关详细信息，请参阅[边界网关协议 (BGP)](../../../remote/remote-access/bgp/Border-Gateway-Protocol-BGP.md)。

## <a name="default-gateways"></a>默认网关
配置为连接到多个网络，例如物理主机和网关虚拟机的机仅必须具有一个默认网关配置。 若要连接到互联网所用的适配器上配置默认网关。

对于虚拟机，请遵循这些规则，以确定要用作默认网关的网络：

1. 如果虚拟机连接到传输网络，或如果它是多宿主到传输网络或任何其他网络，请使用传输逻辑网络作为默认网关。
2. 如果虚拟机只能连接到管理网络，请使用管理网络作为默认网关。 
3. SLB/Mux 和 RAS 网关使用 HNV 提供程序网络。 不要为默认网关使用 HNV 提供程序网络。 
4. 不要直接向 Storage1、 Storage2、 公共 VIP 或专用 VIP 网络连接虚拟机。

对于 HYPER-V 主机和存储节点，作为默认网关使用管理网络。  存储网络一定不能有默认网关分配。


## <a name="network-hardware"></a>网络硬件

以下各节可用于规划网络硬件部署。

### <a name="network-interface-cards-nics"></a>网络接口卡 (NIC)

在 HYPER-V 主机和存储主机中使用的网络接口卡 (Nic) 需要特定功能，以获得最佳性能。 

远程直接内存访问 (RDMA) 是一个内核旁路技术，从而能够以传输大量数据而不使用主机 CPU，从而使 CPU 可以执行其他工作。 

交换机嵌入式组合 (SET) 是一种替代方法可以在 Windows Server 2016 中包括的 HYPER-V 和软件定义网络 (SDN) 堆栈的环境中使用的 NIC 组合解决方案。 组将某些 NIC 组合功能集成到 HYPER-V 虚拟交换机。 

有关详细信息，请参阅[远程直接内存访问 (RDMA) 和交换机嵌入式组合 (SET)](../../../virtualization//hyper-v-virtual-switch/RDMA-and-Switch-Embedded-Teaming.md)。   

若要实现了租户虚拟网络通信造成 VXLAN 或 NVGRE 封装标头的系统开销，（交换机和主机） 的第 2 层光纤网络的 MTU 必须设置为大于或等于 1674 字节\(包括第 2 层以太网标头\)。 

支持新的 Nic *EncapOverhead*高级的适配器关键字设置自动通过网络控制器主机代理 MTU。 不支持新的 Nic *EncapOverhead*关键字需要使用每个物理主机上手动设置 MTU 大小*JumboPacket* \(或等效\)关键字。 


### <a name="switches"></a>开关

在选择的物理交换机和路由器为您的环境，请确保它支持以下功能集：  

- 交换机端口 MTU 设置\(必需\)  
- MTU 设置为 > = 1674 字节\(包括 L2 以太网标头\)  
- L3 协议\(必需\)  
- ECMP  
- BGP \(IETF RFC 4271\)\-基于 ECMP

实现应在以下的 IETF 标准支持必须语句。

- RFC 2545:"用于 IPv6 域间路由的 BGP 4 多协议扩展"  
- RFC 4760:"多协议扩展适用于 BGP 4"  
- RFC 4893:"BGP 支持的四个八位字节 AS 编号空间"  
- RFC 4456:"BGP 路由反射：一种替代方法完整网格内部 BGP (IBGP) 上"  
- RFC 4724:"适用于 BGP 的正常重新启动机制"  

以下标记协议是必需的。

- VLAN 的隔离的各种类型的流量
- 802.1q trunk

以下各项提供链接控件。

- 服务质量\(PFC 如果使用 RoCE 仅必需的\)
- 增强的流量选择\(802.1Qaz\)
- 基于优先级的流控制\(802.1 p/Q 和 802.1Qbb\)

以下各项提供可用性和冗余。

- 切换可用性 （必需）
- 高可用性路由器需要执行网关功能。 可以使用多底盘 switch\ 路由器或 VRRP 等技术来执行此操作。

以下各项提供管理功能。

**监视**

- SNMP v1 或 SNMP v2 （如果使用网络控制器进行物理交换机监视必需）  
- SNMP Mib\(所需如果使用网络控制器的物理交换机监视\)  
- MIB-II (RFC 1213)，LLDP，接口 MIB \(RFC 2863\)，IF MIB、 IP MIB、 IP 转发 MIB、 Q 桥 MIB，桥 MIB、 LLDB MIB、 实体 MIB、 IEEE8023 延隔 MIB  

下图显示示例四个节点安装程序。 为了清楚起见，第一个关系图显示了只需在网络控制器、 网络控制器和软件负载平衡器，显示了第二个和第三个关系图显示了网络控制器、 软件负载平衡器和网关。  

这些关系图不显示存储网络和 Vnic。 如果你打算使用基于 SMB 的存储，这些是所需。

基础结构和租户虚拟机可以跨 （假设为正确的逻辑网络存在正确的网络连接） 的任何物理计算主机重新分发。  



## <a name="switch-configuration-examples"></a>切换配置示例  

为了帮助配置你的物理交换机或路由器，示例配置文件进行的各种开关模型和供应商提供了一组在[Microsoft SDN Github 存储库](https://github.com/microsoft/SDN/tree/master/SwitchConfigExamples)。 提供了详细的自述文件和特定交换机的经过测试的命令行接口 (CLI) 命令。         


## <a name="compute"></a>计算  
所有的 HYPER-V 主机必须具有 Windows Server 2016 安装、 启用 HYPER-V，并使用至少一个物理适配器创建外部 HYPER-V 虚拟交换机连接到管理逻辑网络。 主机必须可通过管理 IP 地址分配给管理主机 vNIC。  

可以使用适用于 HYPER-V，共享或本地任何存储类型。   

> [!TIP]  
> 如果你使用相同名称的所有虚拟交换机，但并不总是这样，它很方便。 如果你打算使用脚本进行部署，请参阅与关联的注释`vSwitchName`变量 config.psd1 文件中。  

**主机计算要求**  
下表显示了在示例部署中使用的四个物理主机的最低硬件和软件要求。  

主机|硬件要求|软件要求|  
--------|-------------------------|-------------------------  
|物理 hyper-v 主机|4 核 2.66 GHz CPU<br /><br />32 GB RAM<br /><br />300 GB 的磁盘空间<br /><br />1 Gb/秒 （或更快） 物理网络适配器|操作系统：Windows Server 2016<br /><br />安装 HYPER-V 角色|  


**SDN 基础结构虚拟机角色要求**  

角色|vCPU 要求|内存要求|磁盘要求|  
--------|---------------------|-----------------------|---------------------  
|网络控制器 （三个节点）|4 个 Vcpu|4 GB 最小值 (建议使用 8 GB)|75 GB 的 OS 驱动器  
|SLB/MUX （三个节点）|8 个 Vcpu|建议使用 8 GB|75 GB 的 OS 驱动器  
|RAS 网关<br /><br />（三个节点网关、 两个活动、 一个被动的单个池）|8 个 Vcpu|建议使用 8 GB|75 GB 的 OS 驱动器  
|RAS 网关 BGP 路由器的 SLB/MUX 的对等互连<br /><br />（或者为 BGP 路由器，使用 ToR 交换机）|2 个 Vcpu|2 GB|75 GB 的 OS 驱动器|  


如果您使用 VMM 进行部署，附加的基础结构虚拟机资源是 VMM 和其他非 SDN 基础结构所必需的。 有关其他信息，请参阅[System Center Technical Preview 的最低硬件建议。](https://technet.microsoft.com/library/dn997303.aspx)  

## <a name="extending-your-infrastructure"></a>扩展您的基础结构  
你的基础结构的大小调整和资源要求都依赖于要承载租户工作负荷虚拟机。 CPU、 内存和磁盘要求基础结构虚拟机 (例如： 网络控制器、 SLB，网关，等等) 上表中列出。 您可以添加更多以根据需要横向扩展这些基础结构虚拟机。 但是，在 HYPER-V 主机上运行任何租户虚拟机具有其自己的 CPU、 内存和磁盘要求必须考虑的。   

当租户工作负荷的虚拟机开始时使用物理 HYPER-V 主机上的过多资源时，可以通过添加其他物理主机来扩展你的基础结构。 这可以与 Virtual Machine Manager 或通过使用 PowerShell 脚本 （具体取决于如何最初部署基础结构） 来创建新的服务器资源通过网络控制器。 如果需要添加其他 IP 地址为 HNV 提供程序网络，可以创建新逻辑子网 （具有相应的 IP 池） 的主机可以使用。  


## <a name="see-also"></a>请参阅  
[安装和部署网络控制器的准备要求](Installation-and-Preparation-Requirements-for-Deploying-Network-Controller.md)  
[软件定义的网络&#40;SDN&#41;](../Software-Defined-Networking--SDN-.md)  



