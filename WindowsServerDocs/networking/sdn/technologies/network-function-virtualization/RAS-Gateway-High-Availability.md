---
title: RAS 网关高可用性
description: 你可以使用本主题以了解有关高可用性配置 RAS Multitenant 网关的软件定义网络 (SDN) 在 Windows Server 2016。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 34d826c9-65bc-401f-889d-cf84e12f0144
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 48794ff8312ca00eda25f6d8bdca9929fc47084f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="ras-gateway-high-availability"></a>RAS 网关高可用性

>适用于：Windows Server（半年通道），Windows Server 2016

你可以使用此主题以了解有关高可用性配置 RAS Multitenant 网关的软件定义网络 (SDN)。  
  
本主题包含以下部分。  
  
-   [RAS 网关概述](#bkmk_overview)  
  
-   [网关池概述](#bkmk_pools)  
  
-   [RAS 网关部署概述](#bkmk_deployment)  
  
-   [与网络控制器的 RAS 网关集成](#bkmk_integration)  
  
## <a name="bkmk_overview"></a>RAS 网关概述  
如果你的组织云服务提供商 (CSP) 或具有多个租户企业，你可以将 RAS 网关部署型租户提供网络路况路由到以及从虚拟和物理网络，包括 Internet。  
  
你可以将 RAS 网关租户型部署作为 edge 网关流量租户客户网络要为其租户虚拟网络和资源。  
  
多个提供高可用性和故障转移的 RAS 网关 Vm 实例部署时，你正在部署网关池。 在 Windows Server 2012 R2 的网关 Vm 形成一个池，这一点很难地网关部署逻辑分离。  Windows Server 2012R2 网关提供 1:1 冗余部署网关虚拟机的功能，这将导致充分利用到站点 (S2S) 的容量可用的 VPN 连接。  
  
Windows Server 2016，它提供了多个网关池-的不同类型的逻辑分离可解决此问题。 对于更有效的故障转移配置允许 M + N 冗余的新的模式。  
  
有关 RAS 网关的更多概述信息，请参阅[RAS 网关](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md)。  
  
## <a name="bkmk_pools"></a>网关池概述  
在 Windows Server 2016 中，你可以将一个或多个池中网关进行部署。  
  
下图中显示不同类型的提供路况路由虚拟网络之间的网关池。  
  
![RAS 网关池](../../../media/RAS-Gateway-High-Availability/ras_pools.png)  
  
每个池具有以下属性。  
  
-   每个池是 M + N 冗余。 这意味着是数目活动网关虚拟机的功能由待机网关虚拟机的功能 n 数备份。 N（待机网关）的值都小于或等于 M（活动网关）。  
  
-   池可以执行以下任一个别网关函数-Internet 键 Exchange 2 (IKEv2) S2S、3 层 (L3)，并通用路由封装 (GRE)-或池可以执行的所有这些功能的版本。  
  
-   你可以将一个公共 IP 地址分配给所有池或的池子集中。 太大减少公用必须使用的 IP 地址的数量，因为它可能有所有租户到上一个 IP 地址云连接。 在高可用性和负载平衡以下的部分介绍了此工作原理。  
  
-   你可以轻松调整网关池向上或向下通过添加或删除池中网关虚拟机的功能。 删除或网关加不会中断池提供服务。 你还可以添加和删除网关整个池。  
  
-   连接的单个租户可以在多个池和多个网关池中终止。 但是，如果租户具有连接中的终止**所有**键入网关池，它无法订阅其他**所有**类型或个别类型网关池。  
  
网关池还提供了灵活地启用其他的方案：  
  
-   单租户池-你可以创建一个租户使用一个池。  
  
-   如果你出售的云服务（经销商）合作伙伴渠道通过，你可以为每个经销商创建单独的池集。  
  
-   多个池可以提供相同网关功能，但不同的容量。 例如，你可以创建支持较高的吞吐量和低吞吐量 IKEv2 S2S 连接网关池。  
  
## <a name="bkmk_deployment"></a>RAS 网关部署概述  
下图说明 RAS 网关的典型云服务提供商 (CSP) 部署。  
  
![RAS 网关部署概述](../../../media/RAS-Gateway-High-Availability/ras_csp_deploy.png)  
  
使用此类型的部署，网关池部署后面软件负载平衡 (SLB)，这可以让 CSP 要给其指定整个部署的单个公共 IP 地址。 多个网关池-和多个网关池中，可以终止租户的多个网关连接。 这 IKEv2 S2S 连接，在上图中，通过阐述了，但相同也适用于其他网关功能，如 L3 和 GRE 网关。  
  
图中，MT BGP 设备是与 BGP RAS Multitenant 关。 租户 BGP 用于动态路由。 租户路由集中-单点，称作路线反射 (RR)、处理 BGP 对等针对所有租户站点。 通过池中的所有网关分发 RR 本身。 这将导致在多个网关、终止租户（数据路径）的连接，但对于租户（BGP 等点-控制路径）RR 位于只有一张网关的配置。  
  
在图表来描述此集中路由概念被分隔 BGP 路由器。 网关 BGP 实现还提供了路由公交时，从而可以云充当公交路由两个租户的站点之间的点。 这些 BGP 功能都适用于所有网关函数。  
  
## <a name="bkmk_integration"></a>与网络控制器的 RAS 网关集成  
RAS 网关完全集成了网络控制器在 Windows Server 2016。 当部署 RAS 网关和网络控制器时、网络控制器执行了以下功能。  
  
-   部署的网关池  
  
-   在每个关租户连接的配置  
  
-   切换网络通信排入待机网关网关发生故障时  
  
以下部分提供有关 RAS 网关和网络控制器的详细的信息。  
  
-   [预配和负载平衡网关连接（IKEv2、L3 和 GRE）](#bkmk_provisioning)  
  
-   [对于 IKEv2 S2S 高可用性](#bkmk_ike)  
  
-   [对于 GRE 高可用性](#bkmk_gre)  
  
-   [转发网关 L3 高可用性](#bkmk_l3)  
  
### <a name="bkmk_provisioning"></a>预配和负载平衡网关连接（IKEv2、L3 和 GRE）  
当租户请求网关连接时，请求已发送到网络控制器。 网络控制器配置了有关网关池，包括在每个池的容量每个池和每个网关的所有信息。 网络控制器选择正确的池和网关的连接。 选择此选项取决于连接的带宽要求。 网络控制器使用"最适合"算法池中高效选取连接。 如果这是租户首次连接这一次连接 BGP 等点还命名。  
  
网络控制器选择 RAS 网关的连接后，网络控制器规定必要网关连接的配置。 如果该连接，IKEv2 S2S 连接网络控制器还规定网络地址翻译 (NAT) 规则 SLB 池; 上此 SLB 池上的 NAT 规则将定向到指定网关连接租户从的请求。 按预期是唯一的源 IP 不同租户。  
  
> [!NOTE]  
> L3 和 GRE 连接绕过 SLB 和直接与指定的 RAS 网关连接。  这些的连接要求，远程端点路由器（或其他第三方设备）必须将正确配置为与 RAS 网关连接。  
  
如果启用 BGP 路由进行连接，然后对等 BGP 由 RAS 网关-启动并本地和云间交换路线网关。 通过 BGP 学习的（或如果未使用 BGP 很静态配置的路线）的路线发送到网络控制器。 网络控制器然后检测下在其租户虚拟机的功能都已安装的 Hyper-V 主机路线。 在此情况下，可到正确本地站点传送租户交通。 网络控制器还将创建关联指定网关位置的网络虚拟化策略 Hyper-V，并且检测它们下 Hyper-V 主机。  
  
### <a name="bkmk_ike"></a>对于 IKEv2 S2S 高可用性  
池中 RAS 网关组成连接和 BGP 对租户不同的等。 每个池拥有都 ' 活动网关和 n 待机网关。  
  
网络控制器按以下方式可处理网关失败。  
  
-   网络控制器不断 ping 网关在所有池和可以检测失败网关或失败。 网络控制器可以检测到以下类型的 RAS 网关失败。  
  
    -   RAS 网关 VM 失败  
  
    -   发生故障的运行 RAS 网关 Hyper-V 主机  
  
    -   RAS 网关服务失败  
  
    网络控制器存储所有部署活动网关的配置。 配置包含在服务区内和路由设置。  
  
-   当网关失败时，它会影响租户连接网关，以及位于其他网关，但其 RR 位于失败网关租户连接。 后者连接的关机时间小于前者。 当网络控制器检测失败网关时，它可以执行以下任务。  
  
    -   从计算主机中删除受影响的连接的路线。  
  
    -   删除这些主机上的 Hyper-V 网络虚拟化策略。  
  
    -   选择待机网关、将其活动网关转换为和配置网关。  
  
    -   将更改为点连接到新网关 SLB 池上的 NAT 映射。  
  
-   同时，如配置出现新的活动网关上时，那么 IKEv2 S2S 连接和 BGP 对等是重新建立。 可通过云网关或本地网关启动连接和 BGP 对等。 网关刷新他们路线，并将它们发送到网络控制器。 网络控制器了解新的路线发现网关后，网络控制器发送路线和关联的 Hyper-V 网络虚拟化策略到 Hyper-V 主机失败影响租户 Vm 所在的位置。 此网络控制器活动是类似新的连接设置的情况，只它发生在较大的比例。  
  
### <a name="bkmk_gre"></a>对于 GRE 高可用性  
通过网络控制器-包括故障检测、复制连接并路由到待机网关故障转移受影响的连接（包括撤销和重新管线的路线，在计算主机和 BGP 重新对等），以及重新配置上的 Hyper-V 网络虚拟化策略路由 BGP/静态配置计算主机-RAS 网关故障转移响应过程均将一致用于 GRE 网关和连接。 GRE 连接重新建立连接方式不同，但是，而对于 GRE 高可用性解决方案有一些其他要求。  
  
![对于 GRE 高可用性](../../../media/RAS-Gateway-High-Availability/ras_ha.png)  
  
网关部署次，每个 RAS 网关 VM 分配动态 IP 地址（冲动）。 此外，每个网关 VM 还分配 GRE 高可用性虚拟 IP 地址 (VIP)。 仅于网关池中可接受 GRE 连接，而不适用于非 GRE 池分配 VIPs。 分配 VIPs 公布到使用 BGP，然后插入云物理网络进一步公布 VIPs 机架（或）开关顶部。 这使得网关可以访问来自远程路由器或第三方设备 GRE 连接的另一端所在的位置。 此 BGP 对等是不同于对租户路线更换等租户级别 BGP。  
  
在预配 GRE 连接时，网络控制器选择网关、配置 GRE 端点在所选网关，并返回重新 VIP 分配网关的地址。 此 VIP 然后配置为目标 GRE 隧道的远程路由器上的地址。  
  
当网关失败时，网络控制器将复制到待机网关 vip 失败网关和配置的其他数据。 待机网关活动时，它将其或切换到 VIP 公布并进一步物理网络。 继续连接到同一个 VIP GRE 隧道的远程路由器并路由基础结构确保数据包路由到新的活动网关。  
  
### <a name="bkmk_l3"></a>转发网关 L3 高可用性  
Hyper-V 网络虚拟化 L3 转移网关是大桥之间数据中心中的物理基础结构和 Hyper-V 网络虚拟化云中的虚拟化基础结构。 对租户 L3 转移网关每个租户自己 VLAN 标记逻辑网络用于与租户物理网络连接。  
  
当新租户创建新的 L3 网关时、网络控制器网关服务管理器选择可用网关 VM，并配置新租户接口具有高可用客户地址（加拿大）空间 IP 地址（从租户 VLAN 标记逻辑网络）。 IP 地址用作远程（物理网络）网关、等 IP 地址，并且旁边跳跃联系租户 Hyper-V 网络虚拟化网络。  
  
与 IPsec 或 GRE 网络连接，不同或切换将不了解租户 VLAN 标记的网络动态。 租户 VLAN 标记网络路由需要进行配置或切换和所有中间交换机和物理基础结构和以确保端到端连接网关之间路由器上。  下面是一个示例 CSP 虚拟网络配置，在下图所示。  
  
|网络|子网|VLAN ID|默认网关|  
|-----------|----------|-----------|-------------------|  
|Contoso L3 逻辑网络|10.127.134.0/24|1001|10.127.134.1|  
|Woodgrove L3 逻辑网络|10.127.134.0/24|1002|10.127.134.1|  
  
以下是示例租户网关配置，在下图所示。  
  
|租户名称|L3 网关 IP 地址|VLAN ID|等 IP 地址|  
|---------------|-------------------------|-----------|-------------------|  
|Contoso|10.127.134.50|1001|10.127.134.55|  
|Woodgrove|10.127.134.60|1002|10.127.134.65|  
  
下面是 CSP 数据中心中的这些配置图。  
  
![转发网关 L3 高可用性](../../../media/RAS-Gateway-High-Availability/ras_fwdgw.png)  
  
网关失败，失败检测网关故障转移过程中的上下文 L3 转发网关是类似于 IKEv2 和 GRE RAS 网关的进程。 差异正在处理的 IP 地址的方式。  
  
不正常网关 VM 状态时，网络控制器选择其中一个待机网关从池中和重新规定网络连接并路由待机网关上。 高度移动的连接，L3 转发网关的时可用 CA 空间 IP 地址还移到新网关 VM，以及租户 CA 空间 BGP IP 地址。  
  
在故障转移期间移到新网关 VM L3 对等 IP 地址，因为远程物理基础结构是再次能够连接到此 IP 地址，然后，访问 Hyper-V 网络虚拟化工作负载。 有关 BGP 动态路由，作为 BGP IP 地址移动到新网关 VM，CA 空间远程 BGP 路由器可以重新建立对等并再次了解所有 Hyper-V 网络虚拟化路线。  
  
> [!NOTE]  
> 单独必须以用于租户通信 VLAN 标记逻辑网络配置或开关和所有中间路由器。 此外，L3 故障转移限于机架其按此方式配置。 出于此原因，必须仔细配置 L3 网关池，然后手动配置必须先完成单独。  
  


