---
title: 调优网络适配器时的性能
description: 本主题介绍 Windows Server 2016 的网络子系统性能优化指南的一部分。
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 0b9b0f80-415c-4f5e-8377-c09b51d9c5dd
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 1c6d36966ce6e2d407b6568e16946745256ee69b
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="performance-tuning-network-adapters"></a>调优网络适配器时的性能

>适用于：Windows Server（半年通道），Windows Server 2016

你可以使用性能曲调网络适配器正在运行 Windows Server 2016 的计算机中安装到此主题。

有关你的网络适配器取决于以下变量确定正确的调整设置：

- 该网络适配器和其功能设置  

- 工作负载服务器执行何种  

- 服务器硬件和软件资源  

- 服务器您性能的目标  

如果你的网络适配器提供调优选项，你可以优化网络吞吐量和资源使用状况，以实现最佳吞吐量参数上述而异。  

以下部分介绍了一些性能优化选项。  

##  <a name="bkmk_offload"></a>启用卸载功能

打开网络适配器卸载功能是通常有用。 有时，但是，该网络适配器并不够处理高吞吐量与卸载功能。

>[!IMPORTANT]
>不会使用卸载功能**IPsec 任务卸载**或**TCP 烟囱卸载**。 这些技术不建议使用 Windows Server 2016，并可能产生负面影响服务器和网络的性能。 此外，这些技术可能不受支持的 Microsoft 将来。

例如，启用分段卸载可以减少某些网络适配器上的最大持久吞吐量由于有限的硬件资源。 但是，如果不应最缩减的吞吐量限制，你应启用卸载功能，即使对于这种类型的网络适配器。

>[!NOTE]
> 有些网络适配器需要卸载功能独立启用发送和接收的路径。

##  <a name="bkmk_rss_web"></a>启用收到一侧的 Web 服务器缩放 (RSS)

在服务器上的逻辑处理器比较少的网络适配器时，RSS 可以提高 web 可扩展性和性能。 在 web 上的所有通信都穿透 RSS 支持的网络适配器时, 传入 web 来自不同的连接可以同时处理跨不同的 Cpu。

务必注意，由于 RSS 和超文本传输中的逻辑协议 \(HTTP\) 负载分配，如果非 RSS 功能的网络适配器接受有一个或多个 RSS 支持的网络适配器的服务器上的 web 流量可能会降级严重的性能。 在此情况下，你应使用 RSS 功能的网络适配器，或禁用 RSS 上的网络适配器属性**高级属性**选项卡。若要确定是否支持 RSS 的网络适配器，可以查看 RSS 信息的网络适配器属性**高级属性**选项卡。

### <a name="rss-profiles-and-rss-queues"></a>RSS 配置文件和 RSS 队列

默认 RSS 预定义的个人资料被纽静态，这将从以前版本的操作系统中更改默认行为。 若要开始使用 RSS 配置文件，你可以查看可用的配置文件来了解他们是非常有用，以及如何将它们应用于你的网络环境和硬件。

例如，如果你打开任务管理器，并在服务器上，查看逻辑处理器和它们无法接收交通充分利用看起来，你可以尝试增加 RSS 队列从 2 默认支持的网络适配器的最大到数。 你的网络适配器可能有选项更改为驱动程序的一部分的 RSS 队列数。

##  <a name="bkmk_resources"></a>增加网络适配器的资源

对于允许手动配置资源，如接收和发送缓冲区的网络适配器，你应增加分配的资源。 

某些网络适配器设置其接收缓冲区不足为节省分配内存从主机。 丢的包和性能下降结果低的价值。 因此，对于接收密集型方案中，我们建议你增加最大到接收缓冲区值。

>[!NOTE]
>如果网络适配器不会公开手动资源配置，它也动态配置资源，或资源均已设置为不能更改固定值。

### <a name="enabling-interrupt-moderation"></a>启用中断适中

若要控制中断适中，某些网络适配器公开不同中断适中级别、缓冲区合并参数 (有时针对单独发送和接收缓冲区)，项或两项。

你应该考虑中断适中的 cpu 的工作负载，并更多中断由于更少的延迟考虑权衡主机 CPU 流量节省类型和提高主机 CPU 流量节省类型与延迟。 如果该网络适配器不会执行中断适中，但它确实公开缓冲区合并、增加合并缓冲区大量允许每发送多个缓冲区或收到，这会提高性能。

##  <a name="bkmk_low"></a>性能的低延迟数据包处理调优

许多网络适配器提供选项来优化操作系统触发延迟。 延迟将之间处理传入的数据包的网络驱动程序和发送回包的网络驱动程序经过的时间。 这一次通常以毫秒。 为了进行比较，巨型包传输传输时间通常以毫秒为单位 \ (订单大地 larger\)。 此调优将不减少在乘公交的数据包花费的时间。

下面是一些调优建议微秒敏感型网络的性能。

- 将计算机的 BIOS 设置为**高性能**，与禁用 C 状态。 但是，请注意，这是系统和 BIOS 依赖，是否操作系统控件电源管理，某些系统将提供更高版本的性能。 你可以查看并调整电源管理设置从**设置**或使用**powercfg**命令。 有关详细信息，请参阅[Powercfg 命令行选项](https://technet.microsoft.com/library/cc748940.aspx)

- 操作系统电源管理个人资料设置为**高性能系统**。 请注意，这将无法正常工作是否已系统 BIOS 设置来禁用操作系统的电源管理的控制。

- 例如，UDP 校验和、TCP 校验和发送大卸载 (LSO) 中启用静态减轻。

- 如果交通是多流式传输，如大量多址广播接收，启用 RSS。

-   禁用**中断适中**设置需要最低尽可能的延迟的网络卡驱动程序。 请记住，这可以使用更多的 CPU 时间和它表示权衡。

- 上正在使用的程序（用户线程）处理数据包核心与共享 CPU 缓存的核处理器处理 Dpc 并网络适配器中断。 CPU 关联调优可用于结合 RSS 配置，以完成此任务直接到某些逻辑处理器的进程。 中断 DPC，，用户模式线程使用相同的核心展示加载增加为会降低性能，因为 ISR DPC、，线程争用的核心。

##  <a name="bkmk_smi"></a>系统管理中断

许多硬件系统将会中断系统管理 \(SMI\) 用于各种维护功能，包括错误更正代码 \(ECC\) 内存错误报告、旧版 USB 兼容性、爱好者控件和 BIOS 控制电源管理。 

SMI 系统上的最高的优先级中断并且 CPU 管理模式，它会所有其他活动抢占中断服务的例程，通常包含在 BIOS 运行时的位置。

遗憾的是，这可能导致延迟激增的 100 毫秒或的详细信息。 

如果你需要获得最低延迟，你应硬件供应商提供的最低度可能降低 SMIs 请求 BIOS 版本。 这些经常称为"低延迟 BIOS"或"SMI 免费 BIOS。" 在某些情况下，不能完全消除 SMI 活动的硬件平台因为它用来控制基本功能（例如，冷却粉丝）。

>[!NOTE]
>操作系统能 SMIs 没有控制，因为逻辑处理器特殊维护模式中时，这会阻止干预操作系统中运行。

##  <a name="bkmk_tcp"></a>调优 TCP 性能

 你可以性能曲调 TCP 使用以下各项。

###  <a name="bkmk_tcp_params"></a>TCP 收到窗口自动调优

Windows Server 2008、之前网络堆栈使用有限连接的总体潜在吞吐量固定大小端接收的窗口（65535 字节为单位）。 到 TCP 堆栈最显著的更改是 TCP 收到窗口自动调优。 

可计算单个连接总吞吐量，当你使用的 TCP 接收窗口为固定的大小：

**以字节表示的总可实现吞吐量 = TCP 接收以字节表示的窗口的大小 \ * (1 月连接秒的延迟)**

例如，总可实现的吞吐量只是与 10 毫秒延迟连接 51 Mbps \（合理值的大型企业网络 infrastructure\）。 

使用自动调整，但是，接收一侧的窗口，以及调整也可能变得要求发件人。 它有可能的连接，以实现整行的 1 的 Gbps 连接速度。 可能有已在过去受限制总可实现吞吐量的 TCP 连接的网络使用情况现在可以充分利用该网络。

#### <a name="deprecated-tcp-parameters"></a>不建议使用的 TCP 参数

Windows Server 2003 从以下注册表设置不再受支持，并在更高版本中会忽略。

所有这些设置了注册表以下位置：

    ```  
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters  
    ```  

- TcpWindowSize

- NumTcbTablePartitions  

- MaxHashTableSize  



###  <a name="bkmk_wfp"></a>筛选的 Windows 平台

Windows 筛选平台 (WFP) 引入在 Windows Vista 和 Windows Server 2008 使 Api 非 Microsoft 独立软件供应商 (Isv) 创建数据包处理筛选器。 示例包括防火墙和防病毒软件。

>[!NOTE]
>根本无法运行书面的 WFP 筛选器会显著降低服务器的网络性能。 有关详细信息，请参阅[移植数据包处理驱动程序和应用到 WFP](https://msdn.microsoft.com/windows/hardware/gg463267.aspx) Windows 开发人员中心中。


本指南中的所有主题的链接，请参阅[网络子系统性能优化](net-sub-performance-top.md)。
