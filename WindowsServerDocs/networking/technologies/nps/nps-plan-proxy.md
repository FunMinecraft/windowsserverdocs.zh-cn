---
title: 将 NPS 规划为 RADIUS 代理
description: 本主题提供有关网络策略服务器 RADIUS 代理部署规划 Windows Server 2016 中的信息。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: ca77d64a-065b-4bf2-8252-3e75f71b7734
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 83fbe57ee62480439190dcc53428e02a4f8e6897
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59829558"
---
# <a name="plan-nps-as-a-radius-proxy"></a>将 NPS 规划为 RADIUS 代理

>适用于：Windows 服务器 （半年频道），Windows Server 2016

为远程身份验证拨入用户服务的网络策略服务器 (NPS) 的部署时\(RADIUS\)代理，NPS 接收连接请求从 RADIUS 客户端，如网络访问服务器或其他 RADIUS 代理，然后这些连接将请求转发到运行 NPS 或其他 RADIUS 服务器的服务器。 可以使用这些计划指南来简化您的 RADIUS 部署。

这些计划指南不包括想要将 NPS 用作 RADIUS 服务器部署的情况。 当您部署 NPS 作为 RADIUS 服务器时，NPS 针对用于本地域和信任本地域的域的连接请求执行身份验证、 授权和记帐。

NPS 用作 RADIUS 代理部署在网络上之前，请使用以下指导原则规划你的部署。

- 规划 NPS 配置。

- 规划 RADIUS 客户端。

- 规划远程 RADIUS 服务器组。

- 计划消息转发的属性操作的规则。

- 计划连接请求策略。

- 计划 NPS 记帐。

## <a name="plan-nps-configuration"></a>计划 NPS 配置

当将 NPS 用作 RADIUS 代理时，NPS 将连接请求转发到的 NPS 或其他 RADIUS 服务器进行处理。 因此，在 NPS 代理的域成员身份是不相关。 代理不需要在 Active Directory 域服务中注册\(AD DS\)因为它不需要对用户帐户的拨入属性的访问。 此外，不需要在 NPS 代理服务器上配置网络策略，因为代理不会执行连接请求授权。 在 NPS 代理可以是域成员，也可以是任何域成员身份的独立服务器。

NPS 必须配置为 RADIUS 客户端，也称为网络访问服务器使用 RADIUS 协议进行通信。 此外，你可以配置的事件类型记录的 NPS 事件日志，可以输入服务器的说明中。

### <a name="key-steps"></a>关键步骤

在规划 NPS 代理配置的过程中，可以使用以下步骤。

- 确定 NPS 代理使用来接收来自 RADIUS 客户端的 RADIUS 消息并将 RADIUS 消息发送到远程 RADIUS 服务器组的成员的 RADIUS 端口。 默认用户数据报协议 (UDP) 端口为 1812年和 1645 用于 RADIUS 身份验证消息，UDP 端口 1813年和 1646 用于 RADIUS 记帐消息。

- 如果 NPS 代理配置了多个网络适配器，确定要对其允许 RADIUS 流量的适配器。

- 确定希望 NPS 事件日志中记录的事件的类型。 你可以记录已拒绝的连接请求、 成功的连接请求，或这两者。

- 确定是否要部署多个 NPS 代理。 若要提供容错功能，使用至少两个 NPS 代理。 一个 NPS 代理将用作主要的 RADIUS 代理和其他可作为备份。 每个 RADIUS 客户端然后上两个 NPS 代理配置。 如果主 NPS 代理变得不可用，RADIUS 客户端随后向备用 NPS 代理发送访问-请求消息。

- 规划用于将一个 NPS 代理配置复制到其他 NPS 代理服务器以节省的管理开销并防止服务器的配置不正确的脚本。 NPS 提供允许您将复制所有或部分导入到另一个 NPS 代理上的 NPS 代理配置的 Netsh 命令。 您可以在 Netsh 提示符下手动运行命令。 但是，如果将保存为一个脚本的命令序列，您可以运行该脚本晚些时候如果您决定更改代理配置。

## <a name="plan-radius-clients"></a>规划 RADIUS 客户端

RADIUS 客户端是网络访问服务器，如无线访问点、 虚拟专用网络\(VPN\)服务器、 802.1 X 的开关和拨号服务器。 RADIUS 代理，连接请求将消息转发到 RADIUS 服务器，也是 RADIUS 客户端。 NPS 支持所有网络访问服务器和 RADIUS 代理服务器与 RADIUS 协议，符合 RFC 2865 中所述"远程身份验证拨入用户服务\(RADIUS\)，"和 RFC 2866"RADIUS 记帐"。

此外，必须能够 802.1 X 身份验证的无线访问点和交换机。 如果你想要部署可扩展身份验证协议 (EAP) 或受保护的可扩展身份验证协议 (PEAP)，访问点和交换机必须支持 EAP 的使用。

若要测试基本的互操作性 PPP 连接的无线访问点，配置的访问点和访问客户端使用密码身份验证协议 (PAP)。 使用其他基于 PPP 的身份验证协议，如 PEAP，直到你已测试了那些想要使用的网络访问。

### <a name="key-steps"></a>关键步骤

规划 RADIUS 客户端的过程中，在可以使用以下步骤。

- 必须在 NPS 中配置特定于供应商的文档属性 (Vsa)。 当在 NPS 中配置网络策略时，如果你 Nas 要求 Vsa，记录 VSA 信息以备日后使用。

- 文档 RADIUS 客户端和 NPS 代理来简化的所有设备的配置的 IP 的地址。 在部署 RADIUS 客户端时，必须配置它们以使用 RADIUS 协议中，输入作为身份验证服务器的 NPS 代理 IP 地址。 并在将 NPS 配置为 RADIUS 客户端进行通信，您必须输入 RADIUS 客户端 IP 地址： 到 NPS 管理单元中。

- 在 RADIUS 客户端和 NPS 管理单元中创建了配置的共享的机密。 使用共享的机密或密码时，您还将输入到 NPS 管理单元在 NPS 中配置 RADIUS 客户端时，必须配置 RADIUS 客户端。

## <a name="plan-remote-radius-server-groups"></a>规划远程 RADIUS 服务器组

当在 NPS 代理服务器上配置远程 RADIUS 服务器组时，您在告诉 NPS 代理发送它从网络访问服务器和 NPS 代理或其他 RADIUS 代理服务器接收的请求消息的某些或所有连接的位置。

您可以使用 NPS RADIUS 代理，以转发连接请求到一个或更多的远程 RADIUS 服务器组和每个组可以包含一个或多个 RADIUS 服务器。 当你想要将消息转发到多个组的 NPS 代理时，配置每个组的一个连接请求策略。 连接请求策略包含其他信息，如属性操作规则，以告诉 NPS 代理哪些消息将发送到远程 RADIUS 服务器组的策略中指定。

使用 nps 的 Netsh 命令、 配置组中 NPS 管理单元在远程 RADIUS 服务器组，直接或运行新的连接请求策略向导，可以配置远程 RADIUS 服务器组。

### <a name="key-steps"></a>关键步骤

规划远程 RADIUS 服务器组的过程中，在可以使用以下步骤。

- 确定包含所需 NPS 代理将连接请求转发到 RADIUS 服务器的域。 这些域包含的用户帐户以连接到你部署 RADIUS 客户端通过网络的用户。

- 确定是否需要在其中 RADIUS 不已部署的域中添加新的 RADIUS 服务器。

- 记录你想要添加到远程 RADIUS 服务器组的 RADIUS 服务器的 IP 地址。

- 确定需要创建的多少远程 RADIUS 服务器组。 在某些情况下，最好是创建每个域，一个远程 RADIUS 服务器组，然后将域的 RADIUS 服务器添加到组。 但是，可能有一个域，包括域、 大量域控制器和大量的 RADIUS 服务器中的大量用户使用用户帐户中有大量的资源的情况。 或者，你的域可能包含在较大的地理区域，使得你能够在彼此相距遥远的位置中的网络访问服务器和 RADIUS 服务器。 在这些情况以及可能其他情况下，可以创建每个域多个远程 RADIUS 服务器组。

- 在 NPS 代理和远程 RADIUS 服务器上创建了配置的共享的机密。

## <a name="plan-attribute-manipulation-rules-for-message-forwarding"></a>计划消息转发的属性操作的规则

在连接请求策略中配置的属性操作规则可用于标识你想要转发到特定的远程 RADIUS 服务器组的访问请求消息。

你可以配置 NPS，以将所有连接请求都转发到一个远程 RADIUS 服务器组，而无需使用属性操作规则。

如果有多个你想要将连接请求转发到的位置，但是，您必须创建连接请求策略的每个位置，然后使用你想要将消息转发到远程 RADIUS 服务器组配置策略，以及属性操作规则，以告诉 NPS 转发哪些消息。

可以创建在以下属性的规则。

- 名为工作站 id。 网络访问服务器 (NAS) 电话号码。 此属性的值是一个字符字符串。 可以使用模式匹配语法指定区号。

- 调用工作站 id。 使用由调用方的电话号码。 此属性的值是一个字符字符串。 可以使用模式匹配语法指定区号。

- 用户的名称。 提供的访问客户端和 NAS RADIUS 访问-请求消息中包含用户的名称。 此属性的值是通常包含领域名称和用户帐户名称的字符串。

若要正确地替换或转换中的连接请求的用户名的领域名称，必须按适当的连接请求策略配置为用户名属性的属性操作规则。

### <a name="key-steps"></a>关键步骤

在规划属性操作规则的过程中，可以使用以下步骤。

- 计划消息从 NAS 通过代理路由到远程 RADIUS 服务器，若要验证您用来将消息转发到 RADIUS 服务器的逻辑路径。

- 确定想要使用的每个连接请求策略的一个或多个属性。

- 记录你计划为每个连接请求策略，使用的属性操作规则和匹配的消息转发到远程 RADIUS 服务器组的规则。

## <a name="plan-connection-request-policies"></a>计划连接请求策略

默认连接请求策略配置为 NPS 用作 RADIUS 服务器时。 其他连接请求策略可以用于定义更具体的情况，创建属性操作规则，以告诉 NPS 哪些消息将转发到远程 RADIUS 服务器组，并指定高级的属性。 使用新的连接请求策略向导创建常见或自定义连接请求策略。

### <a name="key-steps"></a>关键步骤

在规划连接请求策略的过程中，可以使用以下步骤。

- 删除运行 NPS 的函数仅为 RADIUS 代理，每个服务器上的默认连接请求策略。

- 规划其他条件和所需的每个策略，将此信息与远程 RADIUS 服务器组和策略的计划内的属性操作规则相结合的设置。

- 设计要分发到所有 NPS 代理服务器的常见连接请求策略的计划。 上一个 NPS 中，创建策略普遍适用于多个 NPS 代理服务器，然后使用 NPS 的 Netsh 命令来导入所有其他代理上的连接请求策略和服务器配置。

## <a name="plan-nps-accounting"></a>计划 NPS 记帐

将 NPS 配置为 RADIUS 代理时，你可以配置为执行 RADIUS 记帐使用 NPS 格式日志文件、 数据库兼容的格式日志文件或 NPS 的 SQL Server 日志记录。

您还可以将记帐消息转发到远程 RADIUS 服务器组执行记帐，方法是使用其中一种日志记录格式。

### <a name="key-steps"></a>关键步骤

在规划 NPS 记帐的过程中，可以使用以下步骤。

- 确定 NPS 代理来执行记帐服务，或将记帐消息转发到记帐的远程 RADIUS 服务器组。

- 禁用记帐如果计划将记帐消息转发到其他服务器的本地 NPS 代理计划。

- 如果您计划将记帐消息转发到其他服务器，请计划连接请求策略配置步骤。 如果禁用为 NPS 代理服务器的本地帐户，该代理服务器配置每个连接请求策略必须具有记帐消息转发启用并正确配置。

- 确定你想要使用的日志记录格式：IAS 格式日志文件、 数据库兼容的格式日志文件或 NPS 的 SQL Server 日志记录。

若要配置的 NPS 用作 RADIUS 代理负载均衡，请参阅[NPS 代理服务器负载平衡](nps-manage-proxy-lb.md)。

