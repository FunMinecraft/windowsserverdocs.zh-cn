---
title: 连接请求策略
description: 本主题提供 Windows Server 2016 中的网络策略服务器连接请求策略的概述。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 4ec45e0c-6b37-4dfb-8158-5f40677b0157
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 496ba87597b0be6cad1109269d2f72f52de017f1
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="connection-request-policies"></a>连接请求策略

>适用于：Windows Server（半年通道），Windows Server 2016

你可以使用本主题以了解如何使用 NPS 连接请求策略 RADIUS 服务器、RADIUS 代理，为配置 NPS 服务器。

>[!NOTE]
>本主题中，除了以下连接请求策略文档才可用。
> - [配置连接请求策略](nps-crp-configure.md)
> - [配置远程 RADIUS 服务器组](nps-crp-rrsg-configure.md)

连接请求策略是组条件和允许网络管理员指定执行哪些远程身份验证拨入用户服务 (RADIUS) 服务器的身份验证和的连接请求运行网络策略 Server (NPS) 服务器接收 RADIUS 客户端从授权的设置。 可以配置连接请求策略指定的 RADIUS 服务器用于 RADIUS 记帐。

你可以创建连接请求策略，以便从 RADIUS 客户端发送某些 RADIUS 请求消息本地处理（NPS RADIUS 服务器为使用）以及其他类型的邮件转发给（NPS RADIUS 代理为使用）的其他 RADIUS 服务器。

连接请求策略，你可以使用 NPS RADIUS 服务器或 RADIUS 代理，基于如下所示的因素： 

- 一天时间和星期几
- 在连接请求领域名称
- 所请求的连接类型
- RADIUS 客户端的 IP 地址

处理或仅当传入的消息设置匹配至少一个配置 NPS 服务器上的连接要求策略转发 nps RADIUS 访问请求消息。 

如果匹配的策略设置，并且该策略要求 NPS 服务器处理该消息、NPS 会充当 RADIUS 服务器、身份验证和授权连接请求。 如果匹配的策略设置，并且该策略要求 NPS 服务器转发消息、NPS RADIUS 代理起，并转发连接到远程处理 RADIUS 服务器请求。

如果收到 RADIUS 访问请求邮件设置不匹配至少一个连接请求策略，访问拒绝消息发送给 RADIUS 客户端和用户或计算机尝试连接到该网络将被拒绝访问。

## <a name="configuration-examples"></a>配置示例

下面的示例配置展示如何使用连接请求策略。

### <a name="nps-as-a-radius-server"></a>NPS RADIUS 服务器用作

默认连接请求策略是唯一配置的策略。 在此示例中，NPS RADIUS 服务器配置，并且所有连接进行处理通过本地 NPS 服务器。 NPS 服务器可验证和授权的用户帐户的是域 NPS 服务器的及受信任的域中。


### <a name="nps-as-a-radius-proxy"></a>NPS RADIUS 代理用作

默认连接请求策略被删除，并两个新的连接要求策略创建向转发请求两种不同的域。 在此示例中，NPS RADIUS 代理配置。 NPS 不处理本地服务器上的任何连接请求。 相反，它将向 NPS 或配置为远程 RADIUS 服务器组成员的其他 RADIUS 服务器转发连接请求。


### <a name="nps-as-both-radius-server-and-radius-proxy"></a>NPS RADIUS 服务器和 RADIUS 代理用作

默认连接请求策略，除了被创建新的连接要求策略转发给 NPS 或不受信任的域中的其他 RADIUS 服务器连接请求。 在此示例中，首先有序策略的列表中出现的代理策略。 连接请求匹配代理策略，如果连接请求转发给 RADIUS 服务器远程 RADIUS 服务器组中。 连接请求不匹配代理策略，但与匹配默认连接请求策略，如果 NPS 处理本地服务器上的连接请求。 连接请求不匹配任一策略，如果它已被丢弃。

### <a name="nps-as-radius-server-with-remote-accounting-servers"></a>NPS RADIUS 服务器远程记帐服务器用作

在此示例中，本地 NPS 服务器未配置为执行记帐，并且默认连接请求策略进行修改以使转发给 NPS 或远程 RADIUS 服务器组中的其他 RADIUS 服务器 RADIUS 记帐消息。 虽然转发记帐消息、未转发身份验证和授权的消息，本地 NPS 服务器为地域执行这些功能和所有受信任的域。


### <a name="nps-with-remote-radius-to-windows-user-mapping"></a>远程 RADIUS Windows 用户映射到与 NPS

在此示例中，NPS 的作用作为 RADIUS 服务器，并为每个单独的连接请求 RADIUS 代理通过转发授权使用 Windows 本地用户帐户时对远程 RADIUS 服务器的身份验证请求。 通过连接请求策略的条件配置 Windows 用户映射属性远程 RADIUS 实现此配置。 （另外，用户帐户必须创建本地具有相同名称对其执行远程 RADIUS 服务器身份验证的远程用户帐户。）

## <a name="connection-request-policy-conditions"></a>连接请求策略情况

连接请求策略条件有一个或多个传入的消息 RADIUS 访问请求的特性与进行比较的 RADIUS 属性。 有多个条件，如果所有连接的条件请求邮件，并在连接要求策略必须匹配的策略 nps 实施的顺序。

以下是你可以在连接请求策略配置可用的条件属性。

### <a name="connection-properties-attribute-group"></a>连接属性属性组

连接属性属性组包含以下属性。

- **帧协议**。 用于指定的帧传入数据包类型。 示例包括 PPP)、串行行 Internet 协议（单）、帧传达和 X.25。
- **服务类型**。 用于指定的服务所请求的类型。 示例包括框架（例如，PPP 连接），然后登录（例如，远程登录连接）。 有关 RADIUS 服务类型的详细信息，请参阅 RFC 2865、"远程身份验证拨入用户服务 (RADIUS)。"
- **隧道类型**。 用于指定隧道请求客户端创建的类型。 隧道类型包括点到点隧道协议 (PPTP) 和第二隧道协议 (L2TP)。

### <a name="day-and-time-restrictions-attribute-group"></a>日期和时间限制属性组 

日期和时间限制属性组包含日期和时间限制属性。 使用此属性，你可以指定一周天并尝试连接的一天的时间。 日期和时间与日期和时间 NPS 服务器。

### <a name="gateway-attribute-group"></a>网关属性组

网关属性组包含以下属性。

- **称为站 ID**。 用于指定的网络访问权限服务器的电话号码。 此特性是一个字符串。 你可以使用模式匹配语法指定地区代码。
- **NAS 标识符**。 用于指定网络的访问权限服务器的名称。 此特性是一个字符串。 你可以使用模式匹配语法指定 NAS 标识符。
- **NAS IPv4 地址**。 用于指定的网络访问权限服务器（RADIUS 客户）的 Internet 协议第四版 (IPv4) 地址。 此特性是一个字符串。 你可以使用模式匹配语法若要指定 IP 网络。
- **NAS IPv6 地址**。 用于将 Internet 协议版本 6 (IPv6) 指定的网络访问权限服务器（RADIUS 客户）的地址。 此特性是一个字符串。 你可以使用模式匹配语法若要指定 IP 网络。
- **NAS 端口类型**。 用于指定访问客户所使用的媒体类型。 示例包括模拟电话线（称为异步）、集成数字服务网络 (ISDN)、隧道或虚拟专用网络 (Vpn)，无线，IEEE 802.11 和以太网交换机。

### <a name="machine-identity-attribute-group"></a>计算机身份属性组

计算机身份属性组包含计算机身份属性。 通过使用此特性，你可以在策略指定识别客户端的方法。

### <a name="radius-client-properties-attribute-group"></a>RADIUS 客户端属性特性组

RADIUS 客户端属性属性组包含以下属性。

- **呼叫坞 ID**。 用于指定调用方（访问客户端）所使用的电话号码。 此特性是一个字符串。 你可以使用模式匹配语法指定地区代码。
- **客户端的友好名称**。 用于指定的请求身份验证 RADIUS 客户端计算机名称。 此特性是一个字符串。 你可以使用模式匹配语法指定客户端名称。
- **客户端 IPv4 地址**。 若要指定 IPv4 地址的网络访问权限服务器（RADIUS 客户）的使用。 此特性是一个字符串。 你可以使用模式匹配语法若要指定 IP 网络。
- **客户端 IPv6 地址**。 用于指定的网络访问权限服务器（RADIUS 客户端）IPv6 地址。 此特性是一个字符串。 你可以使用模式匹配语法若要指定 IP 网络。
- **客户端供应商**。 用于指定请求身份验证的网络访问权限服务器供应商。 一台运行路由和远程访问服务计算机是 Microsoft NAS 制造商。 可以使用此特性配置针对不同的 NAS 制造商单独的策略。 此特性是一个字符串。 你可以使用语法模式匹配。

### <a name="user-name-attribute-group"></a>用户名特性组

User Name 属性组包含 User Name 属性。 通过使用此特性，你可以指定的用户名或用户名，必须匹配提供访问客户端 RADIUS 消息中的用户名的一部分。 此属性是通常包含领域名称和用户帐户名的字符串。 你可以使用模式匹配语法指定的用户名。

## <a name="connection-request-policy-settings"></a>连接请求策略设置

连接请求策略设置是一套属性于传入 RADIUS 消息应用。 设置包括以下属性的组。

- 身份验证
- 记帐
- 属性操作
- 转移请求
- 高级

下面提供了有关这些设置的更多详细信息。

### <a name="authentication"></a>身份验证

通过使用此设置，你可以覆盖配置中所有网络策略的身份验证设置，并且你可以指定的身份验证方法和连接到你的网络所需的类型。

>[!IMPORTANT]
>如果你在不太安全于配置网络策略中的您的身份验证方法的连接要求策略配置身份验证方法，你在网络策略配置更安全的身份验证方法是重写。 例如，如果你有一个网络策略要求使用保护可扩展身份验证协议 Microsoft 质询握手身份验证协议版本 2 \ (PEAP 的 MS-CHAP v2\)，这是一密码基于身份验证方法为安全的无线，并且还配置连接请求策略允许未经授权的访问权限，但结果很没有客户端将需要使用 PEAP-MS-CHAP v2 进行身份验证。 在此示例中，连接到你的网络的所有客户端被授予是非授权的访问权限。

### <a name="accounting"></a>记帐

通过使用此设置，你可以配置连接请求策略将记帐信息转发给 NPS 或远程 RADIUS 服务器组中的其他 RADIUS 服务器，以便远程 RADIUS 服务器组执行记帐。

>[!NOTE]
>如果你拥有多个 RADIUS 服务器，并且你希望记帐一个中央 RADIUS 会计数据库中存储的所有服务器信息，你可以使用连接请求策略记帐设置每个 RADIUS 服务器上的策略中记帐数据转发从所有 nps 服务器或命名为记帐服务器其他 RADIUS 服务器。

连接请求记帐策略设置函数独立于的本地 NPS 服务器记帐配置。 换言之，如果配置本地 NPS 服务器到本地文件或 Microsoft SQL Server 数据库记录 RADIUS 财务信息时，它将执行此操作无论你是否配置连接请求策略会计邮件转发到远程 RADIUS 服务器组。

如果你希望记录远程而不是本地帐户信息，你必须配置本地 NPS 服务器无法执行记帐，同时还在连接到远程 RADIUS 服务器组记帐数据转发请求策略配置记帐。

### <a name="attribute-manipulation"></a>属性操作

您可以配置一套操作之一以下属性的文本字符串的查找替换规则。

- User Name
- 称为的站 ID
- 呼叫坞 ID

查找替换规则处理问题之一上述属性之前 RADIUS 消息均遵守身份验证和帐户设置。 仅为一个属性应用属性操作规则。 无法配置为每个特性属性操作规则。 此外，可操作的特性列表是静态列表;你无法将添加到列表中属性适用于操作。

>[!NOTE]
>如果你使用的 MS-CHAP v2 身份验证协议，不能操作 User Name 特性，如果连接请求策略用于转发 RADIUS 消息。 仅例外发生使用斜杠 (\) 并且操作仅影响左侧它的信息时。 斜杠用于通常表示域名（的斜杠向左信息）并域（信息斜杠右侧）中的用户帐户名。 在此情况下，允许仅特性操作规则修改或替换域名。

有关示例如何操作领域名，在用户名属性，请参阅主题中的"操作的领域名称中 User Name 特性示例"一节[NPS 中使用常规表情](nps-crp-reg-expressions.md)。

### <a name="forwarding-request"></a>转移请求

你可以将设置以下发送用于 RADIUS 访问请求邮件中的请求选项：

- **验证该服务器上的请求**。 通过使用此设置，NPS 使用 Windows NT 4.0 域、Active Directory 或本地安全帐户管理器（三千）用户帐户数据库验证连接请求。 此设置还指定 nps 使用匹配的网络策略配置中 NPS，以及用户帐户时，拨号中属性是授权连接请求。 在此情况下，NPS 服务器配置作为 RADIUS 服务器。

- **请求转发到以下远程 RADIUS 服务器组**。 通过使用此设置，NPS 向你指定远程 RADIUS 服务器组转发连接请求。 如果 NPS 服务器接收有效访问接受消息对应于访问请求消息，身份验证和授权视为连接尝试。 在此情况下，NPS server 充当 RADIUS 代理。

- **验证凭据不接受用户**。 通过使用此设置，NPS 不验证尝试连接到该网络的用户的身份，并 NPS 不会尝试验证用户或计算机已连接到该网络的权利。 当 NPS 配置允许未经授权的访问，并且收到连接请求时，NPS 立即将发送到 RADIUS 客户端的用户或计算机的访问接受邮件授予网络访问权限。 此设置用于某些类型的强制隧道在访问客户端隧道之前的凭据用户进行验证。

>[!NOTE]
>访问客户端的验证协议时 MS-CHAP v2 或可扩展身份验证协议传输层安全性 (EAP-TLS)，这两种提供相互身份验证，则无法使用此身份验证的选项。 相互身份验证，在访问客户端证明它有效访问客户端到身份验证的服务器 (NPS server)，并且身份验证的服务器证明是在访问客户端到有效身份验证的服务器。 使用此身份验证选项时，将返回访问接受的消息。 但是，身份验证的服务器不提供给访问的客户，验证和相互身份验证失败。

有关如何使用常规表情创建路由到远程 RADIUS 服务器组向前指定的领域名称 RADIUS 消息的规则的示例，请参阅主题中的"示例代理服务器 RADIUS 邮件转发"一节[NPS 中使用常规表情](nps-crp-reg-expressions.md)。

### <a name="advanced"></a>高级

你可以设置高级的属性，若要指定的一系列 RADIUS 属性：

- 当 NPS 服务器用作 RADIUS 身份验证或记帐服务器添加到 RADIUS 响应消息。 当网络策略和连接请求策略上指定的属性，请在 RADIUS 响应消息发送的特性是属性的两种组合。
- 当 NPS 服务器用作 RADIUS 身份验证或会计代理添加到 RADIUS 消息。 如果转发的消息中已存在属性，它将替换连接请求策略中指定的属性的价值。 

此外，可供配置的连接某些属性请求策略**设置**选项卡**高级**类别提供功能专用。 例如，你可以配置**远程 RADIUS Windows 用户映射到**特性时要分割身份验证和授权的连接请求之间两个用户帐户数据库。

**远程 RADIUS Windows 用户映射到**特性指定 Windows 授权的用户通过远程 RADIUS 服务器的身份验证才会发生。 换言之，远程 RADIUS 服务器在远程用户帐户数据库中，执行身份验证的用户帐户，但本地 NPS 服务器授权防御本地用户帐户数据库中的用户帐户连接请求。 当你想要允许访问你的网络的访问权限时，这非常有用。

例如，来自合作伙伴组织的访客可以进行自己的合作伙伴公司 RADIUS 服务器身份验证，然后使用在你的组织的 Windows 的用户帐户访问来宾本地网络 (LAN) 网络。

提供功能专用其他属性是：

- **MS-隔离 IPFilter 和 MS 隔离会话超时**。 与路由和远程访问 VPN 部署部署网络隔离访问控制 (NAQC) 时，会使用这些属性。
- **Passport 的用户的地图-UPN-职务**。 此特性，可验证使用 Windows Live 连接请求™ ID 用户帐户凭据。
- **隧道标记**。 此属性指定的部署虚拟本地网络 (Vlan) 时应 nas 分配连接 VLAN ID 号。

## <a name="default-connection-request-policy"></a>默认连接请求策略

当你安装 NPS 创建默认连接请求策略。 此策略具有以下配置。

- 身份验证配置不。
- 记帐配置为不到远程 RADIUS 服务器组转发财务信息。
- 向前请求连接到远程 RADIUS 服务器组的特性操作规则不配置属性。
- 请求转发配置，以便连接请求进行身份验证和授权的本地 NPS 服务器上。
- 高级的属性未配置。

默认连接请求策略使用作为 RADIUS 服务器 NPS。 若要配置运行 NPS RADIUS 代理用作的服务器，还必须配置远程 RADIUS 服务器组。 你可以创建新远程 RADIUS 服务器组时你正在使用新的连接要求策略向导创建新的连接要求策略。 你可以删除默认连接请求策略或验证默认连接请求策略将其放有序策略的列表中的最后一次由 NPS 处理的最后一个策略。

>[!NOTE]
>如果安装 NPS 远程访问服务为 Windows 身份验证服务配置在同一台计算机和远程访问，并且记帐，它有可能远程访问身份验证和即可转发给 RADIUS 服务器会计请求。 当远程访问身份验证和记帐请求匹配配置来将它们转发给远程 RADIUS 服务器组连接请求策略发生这种。