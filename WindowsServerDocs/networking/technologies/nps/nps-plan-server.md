---
title: 将 NPS 规划为 RADIUS 服务器
description: 本主题提供有关规划 Windows Server 2016 中的网络策略服务器 RADIUS 服务器部署的信息。
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5fd89ef8d95735b8cbe1334ba51ed0059595dbc3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839168"
---
# <a name="plan-nps-as-a-radius-server"></a>将 NPS 规划为 RADIUS 服务器

>适用于：Windows 服务器 （半年频道），Windows Server 2016

当你部署网络策略服务器\(NPS\)为远程身份验证拨入用户服务 (RADIUS) 服务器，NPS 执行身份验证、 授权和记帐的本地域和域的连接请求信任本地域的。 可以使用这些计划指南来简化您的 RADIUS 部署。

这些计划指南不包括想要将 NPS 用作 RADIUS 代理部署的情况。 当您部署 NPS 用作 RADIUS 代理时，NPS 将转发到远程域、 不受信任的域，或两者都在运行 NPS 或其他 RADIUS 服务器的服务器的连接请求。 

NPS 用作 RADIUS 服务器部署在网络上之前，使用以下准则来规划部署。

- 规划 NPS 配置。

- 规划 RADIUS 客户端。

- 计划使用身份验证方法。

- 规划网络策略。

- 计划 NPS 记帐。

## <a name="plan-nps-configuration"></a>计划 NPS 配置

您必须决定哪些域 NPS 是成员。 对于多域环境中，NPS 可以进行身份验证中它是成员的域用户帐户和所有信任 NPS 的本地域的域凭据。 若要允许 NPS 在授权过程中读取用户帐户的拨入属性，必须将 NPS 的计算机帐户添加到每个域的 RAS 和 NPSs 组中。

确定域成员身份的 NPS 之后，服务器必须配置为 RADIUS 客户端，也称为网络访问服务器使用 RADIUS 协议进行通信。 此外，你可以配置的事件类型记录的 NPS 事件日志，可以输入服务器的说明中。

### <a name="key-steps"></a>关键步骤

在规划 NPS 配置的过程中，可以使用以下步骤。

- 确定 NPS 使用 RADIUS 消息接收来自 RADIUS 客户端的 RADIUS 端口。 默认端口为 UDP 端口 1812年和 1645 用于 RADIUS 身份验证消息和端口 1813年和 1646 用于 RADIUS 记帐消息。

- 如果 NPS 配置为使用多个网络适配器，确定要对其允许 RADIUS 流量的适配器。

- 确定希望 NPS 事件日志中记录的事件的类型。 你可以记录已拒绝身份验证请求、 成功的身份验证请求或这两种类型的请求。

- 确定是否要部署多个 NPS。 若要基于 RADIUS 的身份验证和记帐提供容错功能，使用至少两个 NPSs。 一个将 NPS 用作为主 RADIUS 服务器和其他可作为备份。 在这两个 NPSs 然后配置每个 RADIUS 客户端。 如果主 NPS 变得不可用，则 RADIUS 客户端然后将访问-请求消息发送到备用的 NPS。

- 规划用于将一个 NPS 配置复制到其他 NPSs 以节省的管理开销并防止服务器正确配置的脚本。 NPS 提供允许您将复制所有或部分导入到另一个 NPS 上的 NPS 配置的 Netsh 命令。 您可以在 Netsh 提示符下手动运行命令。 但是，如果将保存为一个脚本的命令序列，您可以运行该脚本晚些时候如果您决定更改服务器配置。

## <a name="plan-radius-clients"></a>规划 RADIUS 客户端

RADIUS 客户端是网络访问服务器，如无线访问点、 虚拟专用网络 (VPN) 服务器、 802.1 X 的开关和拨号服务器。 RADIUS 代理，连接请求将消息转发到 RADIUS 服务器，也是 RADIUS 客户端。 NPS 支持所有网络访问服务器和 RADIUS 代理符合 RADIUS 协议 RFC 2865"远程身份验证拨入用户服务 (RADIUS)"中所述和 RFC 2866"RADIUS 记帐"。

>[!IMPORTANT]
>访问客户端，例如客户端计算机不是 RADIUS 客户端。 仅网络访问服务器和代理服务器支持 RADIUS 协议的 RADIUS 客户端。

此外，必须能够 802.1 X 身份验证的无线访问点和交换机。 如果你想要部署可扩展身份验证协议\(EAP\)或受保护的可扩展身份验证协议\(PEAP\)，访问点和交换机必须支持 EAP 的使用。

若要测试基本的互操作性 PPP 连接的无线访问点，配置的访问点和访问客户端使用密码身份验证协议 (PAP)。 使用其他基于 PPP 的身份验证协议，如 PEAP，直到你已测试了那些想要使用的网络访问。

### <a name="key-steps"></a>关键步骤

规划 RADIUS 客户端的过程中，在可以使用以下步骤。

- 必须在 NPS 中配置特定于供应商的文档属性 (Vsa)。 在 NPS 中配置网络策略时，如果您的网络访问服务器需要 Vsa，日志 VSA 信息以备日后使用。 

- 文档 RADIUS 客户端，并在 NPS 简化的所有设备配置的 IP 的地址。 在部署 RADIUS 客户端时，必须配置它们以使用 RADIUS 协议中，输入作为身份验证服务器的 NPS IP 地址。 并在将 NPS 配置为 RADIUS 客户端进行通信，您必须输入 RADIUS 客户端 IP 地址： 到 NPS 管理单元中。

- 在 RADIUS 客户端和 NPS 管理单元中创建了配置的共享的机密。 使用共享的机密或密码时，您还将输入到 NPS 管理单元在 NPS 中配置 RADIUS 客户端时，必须配置 RADIUS 客户端。

## <a name="plan-the-use-of-authentication-methods"></a>计划使用身份验证方法

NPS 支持这两种基于密码的和基于证书的身份验证方法。 但是，并非所有网络访问服务器都支持的相同的身份验证方法。 在某些情况下，你可能想要部署网络访问权限的类型不同的身份验证方法。

例如，你可能想要部署无线和 VPN 访问为你的组织，但使用不同的身份验证方法为每种类型的访问权限：EAP-TLS 的 VPN 连接，由于 EAP 传输层安全 (EAP-TLS) 提供，强大的安全性和用于 802.1x 无线连接的 PEAP MS-CHAP v2。

带 Microsoft 质询握手身份验证协议版本 2 (PEAP MS-CHAP v2) 提供了一个名为快速功能 PEAP 重新连接，专为与便携式计算机和其他无线设备一起使用。 快速重新连接使无线客户端它们将与新的访问点相关联而无需重新进行身份验证每次在同一网络上的无线访问点之间移动。 这为无线用户提供更好的体验，并允许它们而无需重新键入其凭据的访问点之间移动。
由于快速重新连接和安全性，PEAP MS-CHAP v2 提供，而 PEAP MS-CHAP v2 为无线连接的身份验证方法是一个逻辑选择。

对于 VPN 连接，EAP-TLS 的是提供强安全功能来保护网络流量，即使在传输到你的组织的 VPN 服务器从家庭或移动计算机在 Internet 上基于证书的身份验证方法。

### <a name="certificate-based-authentication-methods"></a>基于证书的身份验证方法

基于证书的身份验证方法已提供强大的安全性; 的优点并且它们具有的缺点是比基于密码的身份验证方法部署的难度。

PEAP MS-CHAP v2 和 EAP-TLS 的是基于证书的身份验证方法，但有许多差异以及在部署的方式。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS 使用证书进行客户端和服务器身份验证，并需要在组织中部署公钥基础结构 (PKI)。 部署 PKI 可能很复杂，并且需要独立于规划 NPS 用作 RADIUS 服务器的规划阶段。

带有 EAP-TLS 的 NPS 注册服务器证书从证书颁发机构\(CA\)，并在证书存储在本地计算机上保存证书。 在身份验证过程中，服务器身份验证时发生 NPS 将其服务器证书发送到访问客户端，以向访问客户端证明其身份。 访问客户端将检查各种证书属性以确定证书是否有效以及是否适合用于服务器身份验证期间。 如果服务器证书满足最小服务器证书要求，并由访问客户端信任的 CA 颁发，NPS 进行成功身份验证客户端。

同样，客户端身份验证过程中发生身份验证时客户端到 NPS 来证明其身份向 NPS 发送其客户端证书。 NPS 检查该证书，并访问客户端成功如果客户端证书满足最低客户端证书要求，并且由 NPS 信任的 CA 颁发，nps 通过身份验证。

尽管它是所需的服务器证书存储在 NPS 上的证书存储中，客户端或用户证书可以存储在任一证书存储在客户端上或智能卡上。

若要成功执行此身份验证过程，需要它的所有计算机都具有你组织的 CA 证书在本地计算机和当前用户的受信任的根证书颁发机构证书存储中。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP MS-CHAP v2 进行服务器身份验证和基于密码的用户身份验证的凭据使用的证书。 证书仅用于服务器身份验证，因为您不需要部署 PKI 才能使用 PEAP MS-CHAP v2。 当您部署 PEAP MS-CHAP v2 时，可以在以下两种方式之一 nps 获取服务器证书：

- 您可以到 NPSs 安装 Active Directory 证书服务 (AD CS)，然后选择自动注册证书。 如果使用此方法，还必须注册到客户端计算机连接到网络，以便它们信任证书颁发给 NPS 服务器证书的 CA 证书。

- 您可以从公共 CA （如 verisign） 购买服务器证书。 如果使用此方法，请确保选择客户端计算机已信任的 CA。 若要确定客户端计算机是否信任 CA，客户端计算机上打开证书 Microsoft 管理控制台 (MMC) 管理单元，然后查看受信任的根证书颁发机构存储区为本地计算机和当前用户。 如果没有这些证书存储区中 ca 颁发的证书，客户端计算机信任该 CA，从而将信任 CA 颁发的任何证书。

在使用 PEAP MS-CHAP v2 身份验证过程中，服务器身份验证时发生 NPS 将其服务器证书发送到客户端计算机。 访问客户端将检查各种证书属性以确定证书是否有效以及是否适合用于服务器身份验证期间。 如果服务器证书满足最小服务器证书要求，并由访问客户端信任的 CA 颁发，NPS 进行成功身份验证客户端。

用户身份验证尝试连接到的网络类型基于密码的凭据的用户时，会发生，并尝试登录。 NPS 接收凭据，并执行身份验证和授权。 如果用户进行身份验证和授权成功，并且客户端计算机成功进行身份验证 NPS，被授予连接请求。

### <a name="key-steps"></a>关键步骤

规划使用身份验证方法的过程中，在可以使用以下步骤。

- 确定你打算提供，如无线、 VPN、 802.1 X 的交换机的网络访问和拨号访问的类型。

- 确定的身份验证方法或想要用于每种类型的访问权限的方法。 建议使用提供强大的安全性; 的基于证书的身份验证方法但是，它可能不是你能够部署 PKI，因此，其他身份验证方法可能会提供更好的执行您的网络所需的平衡。

- 如果要部署 EAP-TLS，规划 PKI 部署。 这包括计划要使用的服务器证书和客户端计算机证书的证书模板。 它还包括确定如何注册到域成员和非域成员计算机，并确定是否想要使用智能卡证书。

- 如果要部署 PEAP MS-CHAP v2，确定您是否要将服务器证书颁发给您 NPSs 或是否想要从公共 CA，（如 verisign） 购买服务器证书安装 AD CS。

### <a name="plan-network-policies"></a>计划网络策略

NPS 使用网络策略来确定是否授权连接请求从 RADIUS 客户端接收。 NPS 还使用用户帐户的拨入属性做出授权决定。

由于网络策略中 NPS 管理单元中的显示顺序进行处理，计划将应用限制性最强的策略在策略列表中第一。 对于每个连接请求，NPS 将尝试与连接请求属性的策略的条件匹配。 NPS 检查在订单中的每个网络策略，直到它找到的匹配项。 如果找不到匹配项，将拒绝连接请求。

### <a name="key-steps"></a>关键步骤

规划网络策略的过程中，在可以使用以下步骤。

- 确定网络策略，从低到高的限制性最弱的首选的 NPS 处理顺序。

- 确定策略状态。 启用或禁用策略状态可以具有的值。 如果启用该策略，NPS 将评估策略时执行授权。 如果未启用该策略，则不计算。

- 确定策略类型。 您必须确定是否策略旨在与策略条件匹配的连接请求或是否策略旨在与策略条件匹配的连接请求时拒绝访问时授予访问权限。 例如，如果你想要显式拒绝无线访问的 Windows 组成员，您可以创建指定的组、 无线连接的方法、 和的具有类型设置为拒绝访问的策略的网络策略。

- 确定是否要让 NPS 忽略是基于策略的组的成员的用户帐户的拨入属性。 当未启用此设置时，用户帐户的拨入属性重写在网络策略中配置设置。 例如，如果网络策略配置为用户授予访问权限，但该用户的用户帐户的拨入属性设置为拒绝访问，用户被拒绝访问。 但如果启用策略类型设置忽略用户帐户拨入属性，同一个用户授予网络访问权限。

- 确定策略是否使用策略源设置。 此设置，可以轻松地指定的所有访问请求的源。 可能的来源是终端服务网关 （TS 网关）、 远程访问服务器 （VPN 或拨号）、 DHCP 服务器、 无线访问点和健康注册机构服务器。 或者，可以指定特定于供应商的源。

- 确定必须匹配网络策略要应用的条件。

- 确定如果连接请求匹配网络策略的条件应用的设置。

- 确定是否要使用、 修改或删除默认网络策略。

## <a name="plan-nps-accounting"></a>计划 NPS 记帐

NPS 提供三种格式记录 RADIUS 记帐数据，例如用户身份验证和记帐请求的功能：IAS 格式、 数据库兼容的格式和 Microsoft SQL Server 日志记录。 

IAS 格式和数据库兼容格式创建本地 NPS 上的日志文件以文本文件格式。 

SQL Server 日志记录提供了记录到 SQL Server 2000 或 SQL Server 2005 XML 兼容的数据库，扩展 RADIUS 记帐，以便利用到关系数据库的日志记录优势的功能。

### <a name="key-steps"></a>关键步骤

在规划 NPS 记帐的过程中，可以使用以下步骤。

- 确定您是否要将 NPS 记帐数据存储在日志文件或 SQL Server 数据库中。

### <a name="nps-accounting-using-local-log-files"></a>使用本地日志文件的 NPS 记帐

记录用户身份验证和记帐请求日志文件中的主要用于连接分析和计费目的，并且还可以作为安全调查工具，为您提供用于跟踪后的恶意用户的活动的方法攻击。

### <a name="key-steps"></a>关键步骤

在计划使用本地日志文件的 NPS 记帐的过程中，可以使用以下步骤。

- 确定想要使用 NPS 日志文件的文本文件格式。

- 选择想要记录的信息的类型。 你可以记录记帐请求、 身份验证请求和定期状态。

- 确定想要存储日志文件的硬盘位置。

- 设计您的日志文件备份解决方案。 存储日志文件的硬盘位置应允许您轻松地备份数据的位置。 此外，应通过配置存储日志文件的文件夹的访问控制列表 (ACL) 保护的硬盘位置。

- 确定要创建新日志文件的频率。 如果你想要将基于文件大小创建的日志文件，确定由 NPS 在创建新的日志文件之前允许的最大文件大小。

- 确定是否要让 NPS 删除较旧的日志文件，如果硬盘存储空间不足。

- 确定应用程序或你想要用于查看记帐数据和生成报表的应用程序。

### <a name="nps-sql-server-logging"></a>NPS 的 SQL Server 日志记录

需要会话状态信息，用于创建报表和数据分析目的，并以集中和简化管理记帐数据时，使用 NPS SQL Server 日志记录。

NPS 提供了使用 SQL Server 日志记录写入记录的用户身份验证和记帐请求到运行 Microsoft SQL Server Desktop Engine 的计算机上的数据源从一个或多个网络访问服务器接收\(MSDE 2000\)，或更高版本 SQL Server 2000 个 SQL Server 的任何版本。

记帐数据从传递 NPS 以 XML 格式到数据库，它支持这两种结构化的查询语言中的存储过程\(SQL\)和 XML \(SQLXML\)。 记录用户身份验证和记帐请求符合 XML 的 SQL Server 数据库中启用多个 NPSs 具有一个数据源。

### <a name="key-steps"></a>关键步骤

在规划期间用于 NPS 记帐使用 NPS SQL Server 日志记录，可以使用以下步骤。

- 确定你或你的组织的另一个成员是否具有 SQL Server 2000 或 SQL Server 2005 关系数据库开发体验并了解如何使用这些产品来创建、 修改、 管理和管理 SQL Server 数据库。

- 确定在 NPS 上或远程计算机上是否安装了 SQL Server。

- 设计将使用在 SQL Server 数据库来处理传入的 XML 文件包含 NPS 记帐数据的存储的过程。

- 设计的 SQL Server 数据库复制结构与流程。

- 确定应用程序或你想要用于查看记帐数据和生成报表的应用程序。

- 计划使用网络访问服务器的所有记帐请求中发送的类特性。 类特性发送到 RADIUS 客户端中访问接受消息，并可用于将记帐-请求消息与身份验证会话相关联。 如果 Class 属性发送记帐请求消息中的网络访问服务器，它可以用于匹配的记帐和身份验证记录。 属性唯一序列号，服务重新启动时间和服务器地址的组合必须是服务器接受每个身份验证的唯一标识。

- 计划使用支持临时记帐的网络访问服务器。

- 计划使用网络访问服务器发送记帐开和记帐关消息。

- 计划使用网络访问服务器支持存储和转发的记帐数据。 支持此功能的网络访问服务器可以将记帐数据存储时的网络访问服务器无法与 NPS 通信。 当 NPS 可用时，网络访问服务器将转发存储的记录到 NPS 中，通过网络访问服务器不提供此功能提供更高的可靠性，在记帐。

- 若要始终在网络策略中配置 Acct 过渡期间间隔属性的计划。 Acct 过渡期间间隔属性设置 （以秒为单位） 的间隔之间的网络访问服务器将发送每个临时更新。 根据 RFC 2869 Acct 过渡期间间隔属性的值不能小于 60 秒或一分钟，而不应小于 600 秒或 10 分钟。 有关详细信息，请参阅 RFC 2869，"RADIUS 扩展"。

- 请确保你 NPSs 上启用了日志记录的定期状态。

