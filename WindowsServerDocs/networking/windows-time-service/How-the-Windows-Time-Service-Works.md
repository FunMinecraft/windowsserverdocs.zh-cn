---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Windows 时间服务的工作原理
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: 9e4131c28a18a50f3312e5e0201a0ed9529d4555
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/07/2019
ms.locfileid: "66812394"
---
# <a name="how-the-windows-time-service-works"></a>Windows 时间服务的工作原理

>适用于：Windows Server 2016 中，Windows Server 2012 R2，Windows Server 2012 中，Windows 10 或更高版本

**在本部分中**  
  
-   [Windows 时间服务体系结构](#windows-time-service-architecture)  
  
-   [Windows 时间服务时间协议](#windows-time-service-time-protocols)  
  
-   [Windows 时间服务进程和交互](#windows-time-service-processes-and-interactions)  
  
-   [Windows 时间服务使用的网络端口](#network-ports-used-by-windows-time-service)  
  
> [!NOTE]  
> 本主题说明仅 Windows 时间服务 (W32Time) 的工作方式。 有关如何配置 Windows 时间服务的信息，请参阅[配置系统上的高精度](configuring-systems-for-high-accuracy.md)。
  
> [!NOTE]  
> 在 Windows Server 2003 和 Microsoft Windows 2000 Server 中，目录服务名为 Active Directory 目录服务。 在 Windows Server 2008 和更高版本中，目录服务名为 Active Directory 域服务 (AD DS)。 本主题的其余部分引用了 AD DS，但该信息还适用于 Active Directory。  
  
尽管 Windows 时间服务未完全实现的网络时间协议 (NTP)，它使用以确保在整个网络中的计算机上的时钟尽可能准确的 NTP 规范中定义的复杂算法套件。 理想情况下，AD DS 域中的所有计算机时钟与权威的计算机的时间都同步。 许多因素会影响网络上的时间同步。 以下因素通常会影响同步 AD DS 中的准确性：  
  
-   网络条件  
  
-   计算机的硬件时钟的准确性  
  
-   Windows 时间服务可用的 CPU 和网络资源量  
  
> [!IMPORTANT]  
> 在 Windows Server 2016 之前 W32Time 服务未旨在满足时间敏感的应用程序的需求。  但是，更新到 Windows Server 2016 现在，您可以实现用于 1 毫秒的解决方案在你的域中的准确性。  请参阅[Windows 2016 精确时间](accurate-time.md)并[支持边界来配置 Windows 时间服务对于高准确性环境](support-boundary.md)有关详细信息。  
  
默认情况下，与 time.windows.com 同步配置频繁地同步其时间更少或不加入域的计算机。  因此，就无法保证在没有网络连接或有间歇性的计算机上的时间准确性。  
  
AD DS 林具有预先确定的时间同步层次结构。 Windows 时间服务会同步在层次结构，在顶部的最准确引用时钟与中的计算机之间的时间。 如果一台计算机上配置了多个时间源，Windows 时间使用 NTP 算法从基于计算机的可与该时间源进行同步的配置源选择最佳的时间源。 Windows 时间服务不支持从广播或多播的对等方的网络同步。 有关这些 NTP 功能的详细信息，请参阅 RFC 1305 IETF RFC 数据库中。  
  
正在运行 Windows 时间服务的每台计算机使用该服务来维护最准确的时间。 域成员计算机充当时客户端默认情况下，因此，在大多数情况下它不需要配置 Windows 时间服务。 但是，Windows 时间服务可以配置为从指定的引用时间源请求时间，并且还可向客户端提供时间。
  
计算机的时间的准确程度称为层次。 最低层次级别或第一个所占的最准确的时间源 （如硬件时钟） 网络上。 此准确的时间源称为引用时钟。 获取直接从参考时钟时间的 NTP 服务器占用一个级别高于引用时钟层次。 获取通过 NTP 服务器的时间的资源是两个步骤从引用时钟，因此占用高于最准确的时间源，为两个层次，依此类推。 为计算机的层次数目增加，其系统时钟的时间可能会变得不太准确。 因此，任何计算机的层次级别是该计算机与最准确的时间源的同步程度的指示器。  
  
W32Time 管理器接收时间示例，它使用特殊算法中 NTP 用于确定最适合使用哪个时间示例。 时间服务还使用另一组算法来确定哪一项配置的时间源是最准确。 当时间服务已确定的时间示例是最佳时，它将根据上述条件，调整本地时钟速率，使其可以聚合到正确的时间。 如果本地时钟与所选的准确时间示例 （也称为时间偏差） 之间的时差是太大，无法更正通过调整本地时钟速率，时间服务设置为正确的时间的本地时钟。 此项调整时钟速率或直接时钟时间更改的称为时钟专业。  
  
## <a name="windows-time-service-architecture"></a>Windows 时间服务体系结构  
Windows 时间服务由以下组件构成：  
  
-   服务控制管理器  
  
-   Windows 时间服务管理器  
  
-   时钟专业  
  
-   时间提供程序  
  
下图显示了 Windows 时间服务的体系结构。  
  
**Windows 时间服务体系结构**  
  
![Windows 时间](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)
  
服务控制管理器负责启动和停止 Windows 时间服务。 Windows 时间服务管理器负责启动随操作系统附带的 NTP 时间提供程序的操作。 Windows 时间服务管理器控制的 Windows 时间服务的所有功能和时间的所有示例的合并。 除了提供有关当前的系统状态，信息如当前的时间源或最后一个时间系统时钟已更新，Windows 时间服务管理器负责还创建事件的事件日志中。  
  
时间同步过程包括以下步骤：  
  
-   输入提供程序请求和接收来自已配置的 NTP 时间源的时间示例。  
  
-   这些时间示例然后传递到 Windows 时间服务管理器，收集的所有示例数据并将其传递给时钟专业子组件。  
  
-   时钟专业子组件适用的 NTP 算法，这会导致所选内容的最佳时间示例。  
  
-   时钟专业子组件通过调整时钟速率或直接更改时间调整为最准确的时间的系统时钟的时间。  
  
如果计算机已被指定为时间服务器，它可以发送到请求在此过程中的任何点的时间同步的任何计算机的时间。  
  
## <a name="windows-time-service-time-protocols"></a>Windows 时间服务时间协议  

时间协议确定程度两台计算机的时钟同步。 时间协议负责确定最佳的可用时间信息和聚合来确保一致的时间维护单独的系统上的时钟。  
  
Windows 时间服务使用网络时间协议 (NTP) 来协助跨网络同步时间。 NTP 是一个 Internet 时间协议，包括同步时钟所需的专业算法。 NTP 是更准确的时间协议比简单网络时间协议 (SNTP)，可在某些版本的 Windows;但是 W32Time 继续支持 SNTP 若要启用与运行 SNTP 基于时间的服务，如 Windows 2000 的计算机的向后兼容性。  
  
### <a name="network-time-protocol"></a>网络时间协议  
网络时间协议 (NTP) 是默认值时使用的操作系统中的 Windows 时间服务的同步协议的时间。 NTP 是容错的、 高度可缩放的时间协议，通过使用指定的时间引用同步计算机时钟最常使用的协议。  
  
NTP 时间同步的时间段内发生，并且通过网络涉及 NTP 数据包的传输。 NTP 数据包包含客户端和参与的服务器上的时间示例包括的时间同步的时间戳。  
  
NTP 依赖于引用时钟，以定义要使用的最准确的时间，并同步到该引用时钟在网络上的所有时钟。 NTP 使用协调世界时 (UTC) 当前时间作为通用标准。 UTC 的时区无关，并启用 NTP 而不考虑时区设置在世界任何地方使用。  
  
#### <a name="ntp-algorithms"></a>NTP 算法  
NTP 包括这两种算法、 时钟筛选算法和时钟选择算法，来帮助你确定最佳时间示例 Windows 时间服务。 时钟筛选算法设计为筛查的从查询的时间源接收，并确定每个源中的最佳时间示例时间示例。 然后，时钟选择算法确定网络上最准确的时间服务器。 此信息然后传递给时钟专业算法，它使用收集到的网络延迟和计算机时钟不准确的地方造成的错误补偿时更正的计算机的本地时钟的信息。  
  
NTP 算法是最准确的光中等网络和服务器负载条件下。 使用网络传输时间将考虑在内的任何算法，如 NTP 算法可能会很好地运行在极端网络拥塞的情况下。 有关 NTP 算法的详细信息，请参阅 RFC 1305 IETF RFC 数据库中。  
  
#### <a name="ntp-time-provider"></a>NTP 时间提供程序  
Windows 时间服务是完整的时间同步包，可支持各种硬件设备和时间的协议。 若要启用此支持，该服务使用可插入的时间提供程序。 时间提供程序是负责任一获取准确的时间戳 （从网络或硬件） 或通过网络提供到其他计算机的这些时间戳。  
  
NTP 提供程序是随操作系统附带的标准时间提供程序。 NTP 提供程序遵循标准指定的 NTP 版本 3，客户端和服务器，并且可以与 SNTP 客户端和服务器为了向后兼容 Windows 2000 和其他 SNTP 客户端交互。 Windows 时间服务中的 NTP 提供程序由以下两个部分组成：  
  
-   **NtpServer 输出提供程序。** 这是为在网络上客户端请求的响应的时间服务器。  
  
-   **NtpClient 输入提供程序。** 这是从另一个源，硬件设备或 NTP 服务器，获取时间信息，并可以返回的可用于同步的本地时钟时间示例的时间客户端。  
  
尽管这些两个提供程序的实际操作密切相关，但它们独立到时间服务。 从 Windows 2000 Server 的 Windows 计算机连接到网络时，它被配置为 NTP 客户端。 此外，计算机运行 Windows 时间服务仅尝试与域控制器或手动指定的时间源同步时间，默认情况下。 这些是时间的首选的时间提供程序，因为它们是时间的自动可用且安全的源。  
  
#### <a name="ntp-security"></a>NTP 安全  

在 AD DS 林中，Windows 时间服务依赖于标准域安全功能，可以强制执行时间数据的身份验证。 作为时间服务器的本地域控制器和域成员计算机之间发送的 NTP 数据包的安全性基于共享密钥身份验证。 Windows 时间服务使用计算机的 Kerberos 会话密钥对通过网络发送的 NTP 数据包创建经过身份验证的签名。 在 Net Logon 安全通道不传输 NTP 数据包。 相反，当计算机从域层次结构中的域控制器请求时，Windows 时间服务要求对时间进行身份验证。 域控制器然后已经过身份验证使用 Net Logon 服务中的会话密钥为 64 位值的形式返回所需的信息。 如果返回的 NTP 数据包未在计算机的会话密钥进行签名或未正确签名，则拒绝时间。 事件日志中记录所有此类身份验证失败。 这样一来，Windows 时间服务提供 AD DS 林 NTP 数据的安全性。  
  
通常情况下，Windows 时间客户端会自动获取准确的时间同步从同一个域中的域控制器。 在林中，子域的域控制器与在其父域的域控制器同步时间。 当时间服务器返回到请求的时间的客户端已经过身份验证的 NTP 数据包时，数据包进行签名通过定义的域间信任帐户的 Kerberos 会话密钥。 新的 AD DS 域加入一个林和 Net Logon 服务管理的会话密钥时创建域间信任帐户。 这样一来，林根级域中配置为可靠的域控制器将成为所有父级和子级域中的域控制器和间接的域树中的位置的所有计算机的已经过身份验证的时间源。  
  
Windows 时间服务可以配置为不同的林中，请之间，但务必请注意，此配置不安全。 例如，NTP 服务器可能在不同的林中可用。 但是，因为该计算机是在不同的林中，则用来登录和身份验证 NTP 数据包没有 Kerberos 会话密钥。 若要从在不同林中的计算机获取准确的时间同步，客户端需要网络访问该计算机和时间服务必须配置为使用在其他林中的特定时间源。 如果客户端手动从其自身域层次结构之外的 NTP 服务器配置为访问时，客户端与时间服务器之间发送的 NTP 数据包未经过身份验证，并因此不安全。 即使使用林信任的实现，Windows 时间服务并不安全跨林。 尽管 Net Logon 安全通道是 Windows 时间服务的身份验证机制，但不支持跨林的身份验证。  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>支持的 Windows 时间服务的硬件设备  
基于硬件的时钟如 GPS 或收音机时钟通常用作非常准确引用时钟设备。 默认情况下，Windows 时间服务 NTP 时间提供程序不支持直接连接到计算机的硬件设备，但也可以创建基于软件的独立时间提供程序支持此类型的连接。 这种类型的提供程序，与 Windows 时间服务结合使用可以提供可靠的稳定时间引用。  
  
硬件设备，如 cesium 时钟或全球定位系统 (GPS) 接收器，按照标准，以获取准确定义的时间提供准确的当前时间。 Cesium 时钟极其稳定的状态和不受影响的因素，例如温度、 压力、 或湿度，但也会耗费大量资源。 GPS 接收器运行成本较高少得多，并且仍准确引用时钟。 GPS 接收器从获得从 cesium 时钟时间的附属项获取其时间。 不使用独立的时间提供程序时，Windows 时间服务器可以通过连接到外部的 NTP 服务器，通过电话或 Internet 连接到硬件设备时获取其时间。 例如，美国海军天文台组织提供连接到极其可靠的参考时钟的 NTP 服务器。  
  
许多 GPS 接收器和其他时间设备客户端可作为网络上的 NTP 服务器。 你可以配置 AD DS 林仅当还充当你的网络上的 NTP 服务器同步从这些外部硬件设备的时间。 若要执行此操作，配置充当主域控制器 (PDC) 仿真器与提供的 GPS 设备的 NTP 服务器同步在目录林根中的域控制器。 若要执行此操作，请参阅[中目录林根域的 PDC 仿真器上配置 Windows 时间服务](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29)。  
  
### <a name="simple-network-time-protocol"></a>简单网络时间协议  
简单网络时间协议 (SNTP) 是精确度的适用于服务器和客户端不需要 NTP 提供了一个简化的时间协议。 SNTP，NTP 的更多基本版本是 Windows 2000 中使用的主要的时间协议。 SNTP 和 NTP 的网络数据包格式是相同的因为两个协议进行互操作。 两者之间的主要区别是 SNTP 不具有错误管理和 NTP 提供的复杂筛选系统。 有关简单网络时间协议的详细信息，请参阅 RFC 1769 IETF RFC 数据库中。  
  
### <a name="time-protocol-interoperability"></a>时间协议互操作性  
因为 Windows 2000 中使用的 SNTP 协议是可与 Windows XP 和 Windows Server 2003 中的 NTP 协议互操作，可以在运行 Windows 2000、 Windows XP 和 Windows Server 2003 的计算机的混合环境中运行 Windows 时间服务。  
  
在 Windows NT Server 4.0 中，名为 TimeServ，时间服务的 Windows NT 4.0 网络同步时间。 TimeServ 是可作为一项附加功能的一部分*Microsoft Windows NT 4.0 资源工具包*，它不提供 Windows Server 2003 所需的时间同步的可靠程度。  
  
Windows 时间服务可以与运行 Windows NT 4.0，因为它们可以与运行 Windows 2000 或 Windows Server 2003; 的计算机同步时间的计算机进行互操作但是，运行 Windows 2000 或 Windows Server 2003 的计算机不会自动发现 Windows NT 4.0 时间服务器。 例如，如果你的域配置为使用域层次结构基于方法的同步的同步时间，并且你想要与 Windows NT 4.0 域控制器同步时间的域层次结构中的计算机，你必须配置这些手动进行同步与 Windows NT 4.0 域控制器的计算机。  
  
Windows NT 4.0 使用比 Windows 时间服务使用的时间同步更简单的机制。 因此，若要确保你的网络上的准确的时间同步，建议您升级到 Windows 2000 或 Windows Server 2003 的所有 Windows NT 4.0 域控制器。  
  
## <a name="windows-time-service-processes-and-interactions"></a>Windows 时间服务进程和交互  

Windows 时间服务旨在使网络上的计算机时钟同步。 网络时间同步过程中，也称为时间收敛，作为每个计算机访问时间发生在整个网络从更准确的时间服务器。 时间聚合涉及到的权威服务器提供的 NTP 数据包的窗体中的客户端计算机的当前时间的进程。 数据包中提供的信息指示是否需要调整，使其与计算机的当前时钟时间，以便它与更准确的服务器进行同步。  
  
时间聚合过程的一部分，作为域成员尝试与位于同一域中的任何域控制器同步时间。 如果计算机是域控制器，它将尝试与更具有权威的域控制器进行同步。  
  
运行 Windows XP Home Edition 或未加入域的计算机的计算机不尝试与域层次结构，同步，但默认情况下从 time.windows.com 获取时间配置。  
  
若要建立为授权运行 Windows Server 2003 的计算机，计算机必须配置为可靠时间源。 默认情况下，安装在 Windows Server 2003 域的第一个域控制器自动配置为可靠时间源。 因为它是域的权威计算机，它必须配置要同步与外部时间源，而不是具有域层次结构。 此外默认情况下，所有其他 Windows Server 2003 域成员配置为域层次结构与同步。  
  
已建立的 Windows Server 2003 网络后，可以配置 Windows 时间服务，可使用以下选项之一进行同步：  
  
-   域层次结构基于同步  
  
-   手动指定同步源  
  
-   所有可用的同步机制  
  
-   不进行同步。  
  
以下部分讨论了每种同步类型。  
  
### <a name="domain-hierarchy-based-synchronization"></a>域层次结构基于同步  

基于域层次结构的同步使用 AD DS 域层次结构来查找要与之同步时间可靠的来源。 Windows 时间服务根据域层次结构，确定每个时间服务器的准确性。 在 Windows Server 2003 林中，持有主域控制器 (PDC) 模拟器操作主机角色，位于林根域的计算机包含最佳的时间源的位置，除非已配置另一个可靠时间源。 下图说明域层次结构中计算机之间的时间同步的路径。  
  
**在 AD DS 层次结构中的时间同步**  
![Windows 时间](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)
  
#### <a name="reliable-time-source-configuration"></a>可靠的时间源配置  
配置为可靠时间源的计算机标识为时间服务的根。 时间服务的根是域的权威服务器，通常被配置为从外部 NTP 服务器或硬件设备检索时间。 时间服务器可以配置为可靠时间源，以优化整个域层次结构传输时间的方式。 如果域控制器配置为可靠时间源，Net Logon 服务将在此域控制器时登录到网络宣布为可靠时间源。 当其他域控制器查找要将与同步的时间源时，他们选择可靠源首先如果有可用。  
  
#### <a name="time-source-selection"></a>选择时间源  
时间源选择过程可以在网络上创建两个问题：  
  
-   其他同步周期。  
  
-   中的网络流量的增加的量。  
  
同步网络中的循环时间保持一组的域控制器之间保持一致且持续而无需与另一个可靠时间源的某个重新同步它们之间共享同一时间时发生。 Windows 时间服务的时间源选择算法用于保护免受这些类型的问题。  
  
一台计算机使用以下方法之一来标识要与同步的时间源：  
  
-   如果计算机不是域的成员，它必须配置为与指定的时间源同步。  
  
-   如果计算机是成员服务器或工作站中的域，默认情况下，它遵循 AD DS 层次结构，并将其时间与它当前正在运行 Windows 时间服务的本地域中的域控制器同步。  
  
如果计算机是域控制器，则将最多六个查询来查找另一个域控制器与进行同步。 每个查询专用于具有某些属性，例如域控制器，特定位置的类型标识的时间源，并且是否可靠时间源。 时间源也必须遵循以下限制：  
  
-   只能与父域的域控制器同步的可靠时间源。  
  
-   PDC 模拟器可以通过其自己的域中的可靠时间源或父域中的任何域控制器同步。  
  
如果域控制器不能与它所查询的域控制器的类型进行同步，则不进行查询。 域控制器知道哪种类型的计算机进行查询之前，它可以获取从时间。 例如，本地的 PDC 模拟器不会尝试为查询数字三或六个因为域控制器不会尝试与其自身同步。  
  
下表列出了域控制器使查找时间源和顺序进行查询的查询。  
  
**域控制器时间源查询**  
  
|查询数|域控制器|Location|时间源的可靠性|  
|----------------|---------------------|------------|------------------------------|  
|1|父域控制器|在站点|首选可靠时间源，但它可以与非可靠时间源，如果进行同步的所有可用。|  
|2|本地域控制器|在站点|只会与可靠时间源同步。|  
|3|本地 PDC 仿真器|在站点|不适用。<br /><br />域控制器不会尝试与其自身同步。|  
|4|父域控制器|站点扩展|首选可靠时间源，但它可以与非可靠时间源，如果进行同步的所有可用。|  
|5|本地域控制器|站点扩展|只会与可靠时间源同步。|  
|6|本地 PDC 仿真器|站点扩展|不适用。<br /><br />域控制器不会尝试与其自身同步。| 
  
**注意**  
  
-   一台计算机与本身永远不会同步。 如果尝试同步的计算机是本地的 PDC 模拟器，它不会尝试查询 3 或 6。  
  
每个查询返回的域控制器可以用作时间源的列表。 Windows 时间分配每个域控制器，该域控制器查询基于的可靠性和域控制器位置的分数。 下表列出了每种类型的域控制器到 Windows 时所分配的评分。  
  
**分数决定**  
  
|域控制器状态|分数|  
|----------------------------|---------|  
|位于同一站点中的域控制器|8|  
|标记为可靠时间源域控制器|4|  
|位于父域的域控制器|2|  
|是 PDC 模拟器的域控制器|1|  
  
当 Windows 时间服务确定它已与可能的最佳分数标识域控制器时，都没有更多的查询。 时间服务分配的评分是累积的这意味着位于同一站点中的 PDC 模拟器接收包含 9 个分数。  
  
如果未配置时间服务的根为与外部源同步，在计算机内部硬件时钟控制时间。  
  
### <a name="manually-specified-synchronization"></a>手动指定的同步  
手动指定的同步时，您可以指定单个对等或计算机从其获取时间的对等方的列表。 如果计算机不是域的成员，必须手动将它配置为与指定的时间源同步。 是默认同步从域层次结构配置为域的成员的计算机，手动指定同步是目录林根域的或未加入域的计算机最有用。 手动指定外部 NTP 服务器同步与你的域的权威计算机提供了可靠的时间。 但是，你将与硬件时钟同步的域的权威计算机配置是提供你的域的最准确、 更安全时间实际上更好的解决方案。  
  
除非特定的时间提供程序编写它们，并因此将容易受到攻击，手动指定的时间源未经过身份验证。 此外，如果一台计算机与手动指定的源而不是其身份验证的域控制器同步，两台计算机可能不同步，从而导致 Kerberos 身份验证失败。 这可能会导致需要网络身份验证失败，例如打印或文件共享的其他操作。 如果仅林根配置为与外部源同步，则林中的所有其他计算机保持同步，使重放攻击变得困难。  
  
### <a name="all-available-synchronization-mechanisms"></a>所有可用的同步机制  

"所有可用的同步机制"选项为网络上的用户的最有价值同步方法。 此方法允许与域层次结构的同步，还可能会提供备用域层次结构变得不可用，具体取决于配置的时间源。 如果客户端无法与域层次结构同步时间，时间源自动回退到指定的时间源**NtpServer**设置。 这种同步方法是最有可能向客户端提供准确的时间。  

### <a name="stopping-time-synchronization"></a>正在停止的时间同步  
有某些情况的下，在其中你将想要停止将其时间进行同步的计算机。 例如，如果在计算机尝试从 Internet 上的时间源或从另一个站点通过 WAN 同步通过拨号连接，它也会产生成本高昂的电话费用。 禁用该计算机上的同步后，可以防止在计算机尝试通过拨号连接访问的时间源。  
  
此外可以禁用同步，以防止事件日志中的错误生成。 每次计算机尝试与不可用，时间源同步它在事件日志中生成错误。 如果时间源执行从网络中的计划的维护，并且不打算重新配置客户端将从另一个源同步，则可以禁用上客户端，以防止它尝试时的时间服务器同步的同步将不可用。  
  
它可用于禁用指定为同步网络的根的计算机上的同步。 这表示根计算机信任它的本地时钟。 如果同步层次结构的根未设置为**NoSync** ，如果它不能与另一个的时间源同步，客户端不接受此计算机将发送出，因为它的时间不能为受信任的数据包。
  
唯一一次，即使它们不具有与另一个的时间源同步客户端信任的服务器是指那些由客户端标识为可靠时间服务器。  
  
### <a name="disabling-the-windows-time-service"></a>禁用 Windows 时间服务  
可以完全禁用 Windows 时间服务 (W32Time)。 如果您选择实现一个使用 NTP 的第三方的时间同步产品，则必须禁用 Windows 时间服务。 这是因为所有 NTP 服务器都需要访问用户数据报协议 (UDP) 端口 123，并且只要 Windows 时间服务 Windows Server 2003 操作系统上运行，端口 123 仍是保留的 Windows 时间。  
  
## <a name="network-ports-used-by-windows-time-service"></a>Windows 时间服务使用的网络端口  
Windows 时间服务以确定可靠时间源，获取时间的信息，并提供到其他计算机的时间信息的网络上进行通信。 NTP 和 SNTP Rfc 定义的它会执行此通信。  
  
**Windows 时间服务的端口分配**  
  
|服务名称|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|不可用|  
|SNTP|123|不可用|  
  
## <a name="see-also"></a>请参阅  
[Windows 时间服务技术参考](windows-time-service-tech-ref.md)
[Windows 时间服务工具和设置](Windows-Time-Service-Tools-and-Settings.md)
[Microsoft 知识库文章 902229](https://go.microsoft.com/fwlink/?LinkId=186066)