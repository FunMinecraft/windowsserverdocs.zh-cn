---
ms.assetid: ''
title: Windows 时间可跟踪性
description: 在多个扇区的法规要求系统可追溯到 UTC。  这意味着，可以相对于 UTC 证明系统的偏移量。
author: shortpatti
ms.author: dacuo
manager: dougkim
ms.date: 10/17/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: e25217feba45516cd0e9a3aa2bf1a2581d2087f5
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59838038"
---
# <a name="windows-time-for-traceability"></a>Windows 时间可跟踪性
>适用于：Windows Server 2016 版本 1709年或更高版本、 和 Windows 10 版本 1703年或更高版本


在多个扇区的法规要求系统可追溯到 UTC。  这意味着，可以相对于 UTC 证明系统的偏移量。  若要启用法规符合性方案，Windows 10 （版本 1703年或更高版本） 和 Windows Server 2016 （版本 1709年或更高版本） 提供了新的事件日志可提供从操作系统以形成了解上执行的操作的角度来看图系统时钟。  这些事件日志的 Windows 时间服务持续生成，可检查或存档以供日后分析。

通过这些新事件，必须回答以下问题：

* 系统时钟已被更改
* 已修改的时钟频率
* 已修改的 Windows 时间服务配置

## <a name="availability"></a>可用性

这些改进都包含在 Windows 10 版本 1703年或更高版本和 Windows Server 2016 版本 1709年或更高版本。

## <a name="configuration"></a>配置

实现此功能不需要任何配置。  这些事件日志默认情况下启用，可在事件查看器下的**应用程序和服务 Log\Microsoft\Windows\Time Service\Operational**通道。


## <a name="list-of-event-logs"></a>事件日志的列表

以下部分概述了用于可跟踪性方案中记录的事件。

<!-- use tabs like the group policies -->
# <a name="257tab257"></a>[257](#tab/257)
当 Windows 时间服务 (W32Time) 已启动并记录有关当前时间、 当前滴答计数、 运行时配置、 时间提供程序和当前时钟速率的信息时，将记录此事件。

|||
|---|---|
|事件描述 |服务启动 |
|详细信息 |在 W32time 启动时出现 |
|记录数据 |<ul><li>Utc 格式的当前时间</li><li>当前的计时周期计数</li><li>W32Time 配置</li><li>时间提供程序配置</li><li>时钟速率</li></ul> |
|阻止机制  |无。 每次启动该服务时，将引发此事件。 |

**示例：**
```
W32time service has started at 2018-02-27T04:25:17.156Z (UTC), System Tick Count 3132937.
```

**命令：**

此外可以使用以下命令查询此信息

*W32Time 和时间提供程序配置*
```
w32tm.exe /query /configuration
```

*时钟速率*
```
w32tm.exe /query /status /verbose
```


# <a name="258tab258"></a>[258](#tab/258)
当正在停止 Windows 时间服务 (W32Time)，并记录有关的当前时间和时钟周期计数信息时，将记录此事件。

|||
|---|---|
|事件描述 |服务停止 |
|详细信息 |发生在 W32time 关机 |
|记录数据 |<ul><li>Utc 格式的当前时间</li><li>当前的计时周期计数</li></ul> |
|阻止机制  |无。 每次服务停止时，将引发此事件。 |

**示例文本：**
`W32time service is stopping at 2018-03-01T05:42:13.944Z (UTC), System Tick Count 6370250.`

# <a name="259tab259"></a>[259](#tab/259)
此事件定期记录其当前时间源和其所选的时间源的列表。  此外，它会记录当前的计时周期计数。  此事件不会激发每次更改的时间源。  在本文档后面列出的其他事件提供此功能。

|||
|---|---|
|事件描述 |NTP 客户端提供程序定期状态 |
|详细信息 |使用 NTP 客户端的时间源 (s) 的列表 |
|记录数据 |<ul><li>可用的时间源</li><li>选择的引用时间服务器时的日志记录</li><li>当前的计时周期计数</li></ul>  |
|阻止机制  |记录每 8 小时一次。 |

**示例文本：** NTP 客户端提供程序定期状态：

Ntp 客户端正在接收时数据从以下的 NTP 服务器：

server1.fabrikam.com，0x8 (ntp.m|0x8|[::]:123-> [IPAddress]:123)server2.fabrikam.com,0x8 (ntp.m|0x8|[::]:123-> [IPAddress]: 123); 选择的引用时间服务器是 Server1.fabrikam.com,0x8 (ntp.m|0x8|[::]:123-> [IPAddress]: 123) (RefID:0x08d6648e63)。 系统的计时周期计数 13187937

**命令**还可以使用以下命令查询此信息

*标识对等方*
`w32tm.exe /query /peers`

# <a name="260tab260"></a>[260](#tab/260)

|||
|---|---|
|事件描述 |时间服务配置和状态 |
|详细信息 |W32time 周期性地记录其配置和状态。 这相当于调用：<br><br>`w32tm /query /configuration /verbose`<br>或者<br>`w32tm /query /status /verbose` |
|阻止机制  |记录每 8 小时一次。 |

# <a name="261tab261"></a>[261](#tab/261)
系统时间修改使用 SetSystemTime API 时，这会记录每个实例。

|||
|---|---|
|事件描述 |设置系统时间 |
|阻止机制  |无。<br><br>应发生此情况很少具有合理的时间同步的系统上，我们想要每次出现的时对其进行记录。 我们会忽略此事件记录日志，因为该设置旨在限制 Windows 系统事件日志中的事件时 TimeJumpAuditOffset 设置。 |

# <a name="262tab262"></a>[262](#tab/262)

|||
|---|---|
|事件描述 |系统时钟频率调整 |
|详细信息 |当时钟处于紧密同步时，W32time 不断修改系统时钟频率。 我们想要捕获的时钟频率对不无限大事件日志的情况下所做的"合理很长"调整。 |
|阻止机制  |所有时钟调整下面 TimeAdjustmentAuditThreshold (最小值 = 128 一部分每百万个，默认设置 = 800 一部分每 100 万条) 将不会记录。<br><br>具有当前粒度的时钟频率 2 PPM 更改产生 120 µsec 每秒更改时钟准确性。<br><br>在同步系统中的调整的大多数都低于此级别。 如果你想要更好地跟踪，可以向下调整此设置，或可以使用 PerfCounters，也可以完成上述两。 |

# <a name="263tab263"></a>[263](#tab/263)

|||
|---|---|
|事件描述 |更改时间服务的设置或加载的时间提供程序的列表中。 |
|详细信息 |重新读取 W32time 设置可能会导致某些关键设置为已修改的内存中，这可能会影响整体准确性的时间同步。<br><br>W32time 记录每个匹配项，当重新读取其设置这样的潜在影响时间同步。 |
|阻止机制  |无。<br><br>仅当管理员时发生此事件或 GP 更新更改的时间提供程序，然后触发 W32time。 我们想要记录的设置的更改的每个实例。 |


# <a name="264tab264"></a>[264](#tab/264)

|||
|---|---|
|事件描述 |更改在 NTP 客户端使用的时间源 |
|详细信息 |NTP 客户端记录与时间服务器/对等方的当前状态的事件，时间服务器/对等更改状态时 (**挂起的-> 同步**，**同步-> 无法访问**，或其他转换) |
|阻止机制  |最大频率 – 仅每隔 5 分钟一次以防止暂时性问题和错误的提供程序实现的日志。 |

# <a name="265tab265"></a>[265](#tab/265)

|||
|---|---|
|事件描述 |时间服务源或第的数字更改 |
|详细信息 |W32time 时间源和第数是重要因素时间可跟踪性，并且必须记录对它们的任何更改。 如果 W32time 具有时间没有源，并且你有未配置为可靠时间源，则它将停止公布自己为时间服务器，并按设计响应具有一些无效参数的请求。 此事件是关键来跟踪状态更改 NTP 拓扑中。 |
|阻止机制  |无。 |


# <a name="266tab266"></a>[266](#tab/266)

|||
|---|---|
|事件描述 |请求时间重新同步 |
|详细信息 |触发此操作：<ul><li>发生网络更改时</li><li>系统将返回从连接待机/休眠</li><li>当我们没有同步长时间</li><li>管理员发出重新同步命令</li></ul>此操作会导致立即丢失的细粒度的时间同步准确性，因为它会导致 NTP 客户端可以清除其筛选器。 |
|阻止机制  |最大频率-每隔 5 分钟一次。<br><br>它是网卡出现故障 （或可怜的脚本） 可以重复触发此操作，并且有可能导致日志获取而出现过载情况。 因此需限制此事件。<br><br>请注意，准确的时间同步长，远远超过 5 分钟，若要实现，并限制不会丢失造成的时间准确性丢失原始事件的相关信息。  |

---
