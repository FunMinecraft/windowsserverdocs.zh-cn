---
ms.assetid: ''
title: Windows 时间以实现可跟踪性
description: 许多扇区中的规章都需要将系统跟踪到 UTC。  这意味着系统相对于 UTC 的偏移量可能是证明的。
author: shortpatti
ms.author: dacuo
manager: dougkim
ms.date: 10/17/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 307739042426088fa92c50e6ea4dc5d2a744f15a
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405204"
---
# <a name="windows-time-for-traceability"></a>Windows 时间以实现可跟踪性
>适用于： Windows Server 2016 版本1709或更高版本，以及 Windows 10 版本1703或更高版本


许多扇区中的规章都需要将系统跟踪到 UTC。  这意味着系统相对于 UTC 的偏移量可能是证明的。  若要启用法规遵从性方案，Windows 10 （版本1703或更高版本）和 Windows Server 2016 （版本1709或更高版本）提供了新的事件日志，以便从操作系统的角度提供一张图片，以了解对系统时钟。  这些事件日志是针对 Windows 时间服务连续生成的，可以检查或存档以供以后分析。

这些新事件可帮助回答以下问题：

* 系统时钟是否发生了更改
* 时钟频率是否已修改
* Windows 时间服务配置是否已修改

## <a name="availability"></a>可用性

这些改进包括在 Windows 10 1703 版或更高版本中，以及 Windows Server 2016 版本1709或更高版本。

## <a name="configuration"></a>配置

若要实现此功能，无需进行任何配置。  这些事件日志默认情况下处于启用状态，可在事件查看器中的 "**应用程序和服务 Log\Microsoft\Windows\Time-Service\Operational** " 通道下找到。


## <a name="list-of-event-logs"></a>事件日志列表

以下部分概述了记录在跟踪性方案中使用的事件。

# <a name="257tab257"></a>[257](#tab/257)
Windows 时间服务（W32Time）启动时记录此事件，并记录当前时间、当前滴答计数、运行时配置、时间提供程序和当前时钟速率的相关信息。

|||
|---|---|
|事件描述 |服务启动 |
|详细信息 |在 W32time 启动时发生 |
|记录的数据 |<ul><li>当前时间（UTC）</li><li>当前滴答计数</li><li>W32Time 配置</li><li>时间提供程序配置</li><li>时钟速率</li></ul> |
|限制机制  |无。 每次启动服务时都会触发此事件。 |

**示例：**
```
W32time service has started at 2018-02-27T04:25:17.156Z (UTC), System Tick Count 3132937.
```

**命令：**

还可以使用以下命令查询此信息

*W32Time 和时间提供程序配置*
```
w32tm.exe /query /configuration
```

*时钟速率*
```
w32tm.exe /query /status /verbose
```


# <a name="258tab258"></a>[258](#tab/258)
当 Windows 时间服务（W32Time）停止并记录有关当前时间和滴答计数的信息时，将记录此事件。

|||
|---|---|
|事件描述 |服务停止 |
|详细信息 |在 W32time 关闭时发生 |
|记录的数据 |<ul><li>当前时间（UTC）</li><li>当前滴答计数</li></ul> |
|限制机制  |无。 此事件在服务每次停止时激发。 |

**示例文本：** 
`W32time service is stopping at 2018-03-01T05:42:13.944Z (UTC), System Tick Count 6370250.`

# <a name="259tab259"></a>[259](#tab/259)
此事件定期记录其当前时间源和所选时间源的列表。  此外，它还记录当前滴答计数。  此事件不会在每次发生更改时激发。  本文档后面列出的其他事件提供此功能。

|||
|---|---|
|事件描述 |NTP 客户端提供程序定期状态 |
|详细信息 |NTP 客户端使用的时间源的列表 |
|记录的数据 |<ul><li>可用时间源</li><li>日志记录时所选的引用时间服务器</li><li>当前滴答计数</li></ul>  |
|限制机制  |每8小时记录一次。 |

**示例文本：** NTP 客户端提供程序定期状态：

Ntp 客户端正在接收来自以下 NTP 服务器的时间数据：

server1 .com，0x8 （ntp. m | 0x8 | [：：]： 123-> [IPAddress]：123） server2 .com，0x8 （ntp | 0x8 | [：：]： 123-> [IPAddress]：123）; 所选引用时间服务器为 Server1，0x8 （ntp | 0x8 | [：：]： 123-> [IPAddress]：123）（RefID：0x08d6648e63）。 系统滴答计数13187937

**命令**还可以使用以下命令查询此信息

*标识对等方*
`w32tm.exe /query /peers`

# <a name="260tab260"></a>[260](#tab/260)

|||
|---|---|
|事件描述 |时间服务配置和状态 |
|详细信息 |W32time 定期记录其配置和状态。 这等效于调用：<br><br>`w32tm /query /configuration /verbose`<br>或者<br>`w32tm /query /status /verbose` |
|限制机制  |每8小时记录一次。 |

# <a name="261tab261"></a>[261](#tab/261)
这会在使用 SetSystemTime API 修改系统时间时记录每个实例。

|||
|---|---|
|事件描述 |已设置系统时间 |
|限制机制  |无。<br><br>这种情况很少发生在具有合理时间同步的系统上，并且我们希望在每次发生时进行记录。 记录此事件时将忽略 TimeJumpAuditOffset 设置，因为该设置旨在限制 Windows 系统事件日志中的事件。 |

# <a name="262tab262"></a>[262](#tab/262)

|||
|---|---|
|事件描述 |已调整系统时钟频率 |
|详细信息 |当时钟处于 close 同步时，W32time 会不断地修改系统时钟频率。 我们想要在不 overrunning 事件日志的情况下，捕获对时钟频率的 "合理的" 调整。 |
|限制机制  |不会记录每个 TimeAdjustmentAuditThreshold （最小 = 128 部分，默认为800部分，每百万）的所有时钟调整。<br><br>2 PPM 频率变化的当前粒度为120，时钟准确性为每秒微秒。<br><br>在同步系统上，大部分调整都低于此级别。 如果需要更精细的跟踪，则可以向下调整此设置，也可以使用 PerfCounters，也可以同时执行这两个操作。 |

# <a name="263tab263"></a>[263](#tab/263)

|||
|---|---|
|事件描述 |更改已加载时间提供程序的时间服务设置或列表。 |
|详细信息 |重新读取 W32time 设置会导致在内存中修改某些关键设置，这可能会影响时间同步的总体准确性。<br><br>W32time 在重新读取其设置时记录每个匹配项，这会给出对时间同步的潜在影响。 |
|限制机制  |无。<br><br>此事件仅在以下情况下发生：管理员或 GP 更新更改时间提供程序，然后触发 W32time。 我们想要记录每个更改的设置实例。 |


# <a name="264tab264"></a>[264](#tab/264)

|||
|---|---|
|事件描述 |NTP 客户端使用的时间源更改 |
|详细信息 |NTP 客户端在时间服务器/对等节点更改状态（**挂起 > 同步**、**同步 > 无法访问**或其他转换）时，记录与时间服务器/对等方的当前状态的事件。 |
|限制机制  |最大频率–每5分钟一次，以防止日志出现暂时性问题和错误的提供程序实现。 |

# <a name="265tab265"></a>[265](#tab/265)

|||
|---|---|
|事件描述 |时间服务源或层次号码更改 |
|详细信息 |W32time 时间源和层次号码是时间跟踪的重要因素，必须记录对这些项所做的任何更改。 如果 W32time 没有时间源，并且你未配置为可靠时间源，则它将停止作为时间服务器进行播发，并按设计方式使用一些无效参数来响应请求。 此事件对于跟踪 NTP 拓扑中的状态更改至关重要。 |
|限制机制  |无。 |


# <a name="266tab266"></a>[266](#tab/266)

|||
|---|---|
|事件描述 |请求重新同步时间 |
|详细信息 |触发此操作：<ul><li>发生网络更改时</li><li>系统从连接的待机/休眠返回</li><li>如果我们时间未同步</li><li>管理员发出重新同步命令</li></ul>此操作导致立即失去细化的时间同步准确性，因为这会导致 NTP 客户端清除其筛选器。 |
|限制机制  |最大频率-每5分钟一次。<br><br>坏网卡（或较差的脚本）可能会重复触发此操作并导致日志被淹没。 因此需要限制此事件。<br><br>请注意，准确的时间同步需要5分钟以上的时间才能完成，并且限制不会丢失导致时间损失的原始事件的相关信息。  |

---
