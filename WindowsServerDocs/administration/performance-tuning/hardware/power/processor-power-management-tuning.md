---
title: 处理器电源管理 (PPM) 优化 Windows Server 平衡的电源计划
description: 处理器电源管理 (PPM) 优化 Windows Server 平衡的电源计划
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Qizha;TristanB
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 8a2ef4fd39554446aaac686e142ad24f53b4efaa
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59863048"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>处理器电源管理 (PPM) 优化 Windows Server 平衡的电源计划

从 Windows Server 2008 开始，Windows Server 提供了三个电源计划：**平衡**，**高性能**，和**Power 保护程序**。 **平衡**电源计划是默认的选项，旨在为一组典型的服务器工作负荷提供最高的能效。 本主题介绍已用于确定的默认设置的工作负荷**平衡**过去的几个版本的 Windows 的方案。

如果您运行具有明显不同的工作负荷特征或性能和电源要求比这些工作负载的服务器系统，您可能需要考虑优化默认电源设置 （即，创建自定义电源计划）。 优化的有用信息的一个原因是[服务器的硬件功能的注意事项](../power.md)。 或者，您可以决定**高性能**电源计划是正确的选择为您的环境，认识到，您很有可能会以某种程度的提高响应能力换取命中大量能源。

>[!Important]
> 应利用电源策略是包含在 Windows Server，除非有特定需求创建一个自定义并具有很好的理解结果会有所不同具体取决于你的工作负荷的特征。

## <a name="windows-processor-power-tuning-methodology"></a>Windows 处理器电源优化方法


### <a name="tested-workloads"></a>已测试工作负荷

选择工作负荷包含一最大程度的"典型？ Windows Server 工作负荷。 显然此集被不能代表实际的服务器环境的整个范围。

每个电源策略中优化是由以下五个工作负荷的数据：

-   **IIS Web 服务器工作负荷**

    调用 Web 基础知识的 Microsoft 内部基准用于优化运行 IIS Web 服务器平台能源效率。 安装程序包含 web 服务器和模拟 web 访问通信的多个客户端。 （在内存中），动态、 静态热分发和静态冷 （所需的磁盘访问权限） 网页基于在统计研究的生产服务器上。 若要将服务器的 CPU 核心数推送到完全利用 （一个经过测试的极端情况下结束），安装程序需要足够快的速度的网络和磁盘资源。

-   **SQL Server 数据库工作负荷**

    [TPC-E](http://www.tpc.org/tpce/default.asp)基准测试非常受欢迎的基准测试以进行数据库性能分析。 它用于生成 PPM 优化优化的 OLTP 工作负荷。 此工作负荷具有大量磁盘 I/O，因此具有高性能要求的存储系统和内存大小。

-   **文件服务器工作负荷**

    名为 Microsoft 开发的基准[FSCT](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf)用于生成的 SMB 文件服务器工作负荷。 它创建在服务器上设置一个大型文件，并使用很多客户端系统 （实际或虚拟化） 来生成文件打开、 关闭、 读取和写入操作。 操作组合基于统计研究的生产服务器。 它强调 CPU、 磁盘和网络资源。

-   **SPECpower – JAVA 工作负荷**

    [SPECpower\_ssj2008](http://spec.org/power_ssj2008/)是第一个符合行业标准规范基准检验，共同提供计算能力和性能特征。 它是具有不同 CPU 负载级别的服务器端 Java 工作负载。 它不需要很多的磁盘或网络资源，但它有某些要求的内存带宽。 在用户模式下; 执行的几乎所有的 CPU 活动内核模式活动没有太多对基准的强大功能和性能特征，除电源管理决策的影响。

-   **应用程序服务器工作负荷**

    [SAP SD](http://global.sap.com/campaigns/benchmark/index.epx)基准用于生成应用程序服务器工作负荷。 与数据库和应用程序服务器相同的服务器主机上，使用两个层设置。 此工作负荷还利用作为一个性能度量值，这不同于其他经过测试的工作负荷的响应时间。 因此，它用于验证的响应能力的 PPM 参数影响。 不过，它不是为所有易受延迟影响生产工作负荷的代表。

所有除 SPECpower 基准最初设计为性能分析，并因此创建在峰值负载级别运行。 但是，负载较轻的中等级别是实际的生产服务器更容易且更感兴趣**平衡**计划优化。 我们有意基准不同负载级别从 100%到 10%（在 10%的步骤） 通过运行各种限制方法 （例如，通过减少活动用户/客户端的数量）。

### <a name="hardware-configurations"></a>硬件配置

对于每个版本的 Windows，最新的生产服务器电源计划分析和优化过程中使用。 在某些情况下，在其发布计划匹配的下一个 Windows 版本的预生产系统上执行了测试。

假设大多数服务器使用 1 到 4 处理器套接字，包装中销售和向上扩展服务器不太可能有一个主要考虑因素的能源效率，因为电源计划优化测试主要双套接字和 4 插槽系统上运行。 RAM、 磁盘和网络资源的每个测试量经过挑选，用于允许每个系统运行一直到最大容量时，在考虑到通常会为实际的服务器环境，例如保留的成本限制合理的配置。

>[!Important]
> 即使系统可以运行在其峰值负载，我们通常优化为较低的负载级别，因为一致地在其峰值负载级别运行的服务器都是明确建议用于**高性能**电源计划除非能源效率是高优先级。

### <a name="metrics"></a>指标

所有经过测试的基准性能指标作为使用吞吐量。 响应时间被视为 （除 SAP，其所在的主要指标) 这些工作负荷的 SLA 要求。 例如，基准运行被视为"有效？ 如果平均值或最大响应时间小于某个值。

因此，还优化分析 PPM 使用吞吐量为其性能指标。  在最高的负载级别 （100%的 CPU 使用率） 中，我们的目标是吞吐量应不能减少由于电源管理优化多个几个百分点。 但主要考虑因素是效率最大化的电源 （如定义如下） 中和低负载级别。

![电源效率公式](../../media/serverperf-ppm-formula.jpg)

以低的频率运行的 CPU 内核数减少能源消耗。 但是，较低的频率通常会降低吞吐量并提高响应时间。 有关**平衡**电源计划，没有响应能力和电源效率有意权衡。 SAP 工作负荷测试，以及其他工作负载上的响应时间 Sla 确保响应时间增加，不会针对这些特定工作负荷超过特定阈值 （作为示例的 5%)。

>[!Note]
> 如果工作负荷的性能指标中使用响应时间，系统应转到**高性能**电源计划或更改**平衡**电源计划中的建议[建议用于快速响应时间的平衡的电源计划参数](recommended-balanced-plan-parameters.md)。

### <a name="tuning-results"></a>优化结果

从 Windows Server 2008 开始，Microsoft 与 Intel 和 AMD 来优化每个 Windows 版本的最新服务器处理器的 PPM 参数合作。 每个之前讨论过的工作负荷以查找在不同的负载级别的最佳电源效率上测试了大量 PPM 参数组合。 作为软件算法是经过优化，作为硬件 power 体系结构改进，每个新的 Windows Server 始终有更好地或经过测试的工作负荷的范围等于电源效率比其早期版本。

下图提供了运行 Windows Server 2008 R2 的 4 插槽生产服务器上的不同 TPC-E 负载级别下，将电源效率的示例。 它显示了在中等负载级别与 Windows Server 2008 相比的 8%改进。

![电源效率比较](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>自定义优化建议

如果主工作负荷特征显著不同于用于默认的五个工作负荷**平衡**电源计划 PPM 优化，您可以通过进行试验更改一个或多个 PPM 参数，以确定最适合你环境。

由于的数量和复杂性的参数，这可能是具挑战性的任务，但如果您正在寻找特定环境的能源消耗和工作负荷效力之间的最佳权衡，则可能是值得这样做。

 完整的可优化 PPM 参数集可在[处理器电源管理优化](https://msdn.microsoft.com/windows/hardware/gg566941.aspx)。 最简单的 power 参数的一些开始可能是：

-   **处理器性能增加阈值和处理器性能增加时间**– 更大的值降低的性能提高活动响应

-   **处理器性能降低阈值**– 较大值 quicken power 响应空闲期

-   **处理器性能降低时间**– 更大的值在空闲时段，更逐渐降低性能

-   **处理器性能增加策略**–"单？ 策略会降低性能响应增加和持续的活动;"火箭？ 策略做出快速响应增加的活动

-   **处理器性能降低策略**–"单？ 策略更推移而逐渐减少性能再空闲时间段"火箭？ 策略删除 power 非常快速地进入空闲一段时

>[!Important]
> 在开始之前任何试验，应首先了解您的工作负载，它将帮助你做出正确的 PPM 参数选择并减少优化工作。

### <a name="understand-high-level-performance-and-power-requirements"></a>了解高级性能和电源要求

如果工作负荷"实时？ （例如，容易受到干扰或其他可见的最终用户影响） 或已非常紧凑的响应能力要求 （例如，证券经纪），并且如果能源消耗不是您的环境的主要条件，则应可能只需切换到**高性能**电源计划。 否则为应了解工作负荷的响应时间要求，然后调整仍满足这些要求的最佳可能的电源效率的 PPM 参数。

### <a name="understand-underlying-workload-characteristics"></a>了解基础工作负荷特征

您应该了解您的工作负载和设计的优化实验参数集。 例如，如果 CPU 核心数的频率需要非常熟悉如何快速 （也许你有具有有效空闲周期的突发工作负荷，但需要可非常快速的响应性新事务时），则处理器性能提高策略可能需要将设置为"火箭？ （其中，顾名思义，投篮到其最大值，而不是开发出一段时间内的 CPU 核心频率）。

如果非常突发工作负荷，可以减少 PPM 检查间隔，以使开始单步执行更快地迸发到达后的 CPU 频率。 如果你的工作负荷没有高的线程的并发程度，则可以启用核心停车以强制能够在较小数目的核心，也可能无法提高上执行的工作负荷处理器缓存命中比率。

如果只是想要提高 CPU 利用率级别 （即，不轻型工作负荷级别） 的频率，则可以调整处理器性能相应增大/减少阈值以响应直到观察到某些级别的活动。

### <a name="understand-periodic-behaviors"></a>了解定期行为

白天和夜间或周末，可能是不同的性能要求或者可能在不同时间运行的不同工作负荷。 在这种情况下，一组 PPM 参数可能不是最佳所有时间段内。 由于可以想出了多个自定义电源计划，则可能甚至不同的时间段内优化，并通过脚本或其他方法动态系统配置的电源计划之间进行切换。

同样，这将添加到这可能需要在有大量的硬件升级或负载变化时，重复的优化过程，因此，将从这种优化，获得多少价值的问题的复杂性。

这就是 Windows 提供了原因**平衡**电源计划的初衷，因为在许多情况下它可能不是值得的手动优化的特定服务器上的特定工作负荷。

## <a name="see-also"></a>请参阅
- [服务器硬件的性能注意事项](../index.md)
- [服务器硬件功能的注意事项](../power.md)
- [电源和性能优化](power-performance-tuning.md)
- [处理器电源管理优化](processor-power-management-tuning.md)
- [建议平衡的计划参数](recommended-balanced-plan-parameters.md)
