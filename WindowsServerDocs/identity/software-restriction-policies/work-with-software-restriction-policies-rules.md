---
title: 使用软件限制策略规则
description: Windows Server 安全
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-software-restriction-policies
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 4a8047d5-9bb9-4bed-bc8f-583a237731e2
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 2dd1810b50f4f02be99eb2e2c0893501f99d1e93
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59844948"
---
# <a name="work-with-software-restriction-policies-rules"></a>使用软件限制策略规则

>适用于：Windows Server 2016 中，Windows Server 2012 R2、 Windows Server 2012

本主题介绍了使用证书、 路径、 internet 区域和哈希规则使用软件限制策略的过程。

## <a name="introduction"></a>简介
使用软件限制策略，可以从不受信任软件保护计算环境，通过识别和指定允许运行哪些软件。 可以定义的默认安全级别**Unrestricted**或**不允许**组策略对象 (GPO)，以便软件或者允许或不允许对默认情况下运行。 可以通过创建软件限制策略规则的特定软件来使此默认安全级别的例外情况。 例如，默认安全级别设置为“不允许”时，你可以创建允许运行特定软件的规则。 类型的规则如下所示：

-   **证书规则**

    有关过程，请参阅[使用证书规则](#BKMK_Cert_Rules)。

-   **哈希规则**

    有关过程，请参阅[使用哈希规则](#BKMK_Hash_Rules)。

-   **Internet 区域规则**

    有关过程，请参阅[使用的 Internet 区域规则](#BKMK_Internet_Zone_Rules)。

-   **路径规则**

    有关过程，请参阅[使用路径规则](#BKMK_Path_Rules)。

有关其他任务来管理软件限制策略的信息，请参阅[管理软件限制策略](administer-software-restriction-policies.md)。

## <a name="BKMK_Cert_Rules"></a>使用证书规则
软件限制策略还可以标识软件的签名证书。 你可以创建一个证书规则来识别软件，然后根据安全级别允许或不允许运行该软件。 例如，可以使用证书规则自动信任来自域中受信任源的软件，且不提示用户。 还可以使用证书规则来运行操作系统的不受允许区域中的文件。 默认情况下，不会启用证书规则。

当使用组策略的域创建规则时，必须有权创建或修改组策略对象。 如果要为本地计算机创建规则，则你必须拥有该计算机上的管理凭据。

#### <a name="to-create-a-certificate-rule"></a>创建证书规则的步骤

1.  打开“软件限制策略”。

2.  在控制台树或详细信息窗格中，右键单击**其他规则**，然后单击**新建证书规则**。

3.  单击“浏览”，然后选择证书或签名的文件。

4.  在中**安全级别**，单击**不允许**或**Unrestricted**。

5.  在“描述”中键入此规则的描述，然后单击“确定”。

> [!NOTE]
> -   可能需要为组策略对象 (GPO) 创建新的软件限制策略设置（如果尚未这样做）。
> -   默认情况下，不会启用证书规则。
> -   证书规则影响的文件类型只有软件限制策略详细信息窗格中“指定的文件类型”所列出的那些文件类型。 有一个指定文件类型列表由所有规则共享。
> -   软件限制策略生效，用户必须注销然后登录到他们的计算机的更新策略设置。
> -   当多个软件限制策略规则应用于策略设置时，没有用于处理冲突的规则的优先权。

### <a name="enabling-certificate-rules"></a>启用证书规则
根据环境的不同，启用证书规则的过程将有所不同：

-   [为本地计算机](#BKMK_1)

-   [对于组策略对象，并且您位于加入到域的服务器](#BKMK_2)

-   [组策略对象，和你的域控制器或安装了远程服务器管理工具在工作站上](#BKMK_3)

-   [仅对于域控制器，和你是域控制器上或工作站上的已安装了远程服务器管理工具包](#BKMK_4)

#### <a name="BKMK_1"></a>若要启用本地计算机的证书规则

1.  打开“本地安全设置”。

2.  在控制台树中，单击**安全选项**下安全设置/本地策略。

3.  在详细信息窗格中，双击**系统设置：软件限制策略在 Windows 可执行文件上使用证书规则**。

4.  执行下列操作之一，然后单击“确定”：

    -   若要启用证书规则，请单击“启用”。

    -   若要禁用证书规则，请单击“禁用”。

#### <a name="BKMK_2"></a>若要启用证书规则的组策略对象，并且您位于加入到域的服务器

1.  打开 Microsoft 管理控制台 (MMC)。

2.  在“文件”菜单中，单击“添加/删除管理单元”，然后单击“添加”。

3.  单击“本地组策略对象编辑器”，然后单击“添加”。

4.  在“选择组策略对象”中单击“浏览”。

5.  在中**浏览组策略对象**，选择相应的域、 站点或组织单位中的组策略对象 (GPO)-或创建一个新，然后单击**完成**。

6.  单击“关闭”，然后单击“确定”。

7.  在控制台树中，单击**安全选项**位于*GroupPolicyObject* [*ComputerName*] 策略/计算机配置/Windows 设置/安全设置/本地策略 /。

8.  在详细信息窗格中，双击**系统设置：软件限制策略在 Windows 可执行文件上使用证书规则**。

9. 如果尚未定义此策略设置，请选中“定义这些策略设置”复选框。

10. 执行下列操作之一，然后单击“确定”：

    -   若要启用证书规则，请单击“启用”。

    -   若要禁用证书规则，请单击“禁用”。

#### <a name="BKMK_3"></a>若要启用证书规则的组策略对象，并位于域控制器或安装了远程服务器管理工具在工作站上

1.  打开“Active Directory 用户和计算机”。

2.  在控制台树中，右键单击你要为其启用证书规则的组策略对象 (GPO)。

3.  单击“属性”，然后单击“组策略”选项卡。

4.  单击“编辑”打开要编辑的 GPO。 也可以单击“新建”以创建一个新的 GPO，然后单击“编辑”。

5.  在控制台树中，单击**安全选项**位于*GroupPolicyObject*[*ComputerName*] 策略/计算机配置/Windows 设置/安全设置/本地策略。

6.  在详细信息窗格中，双击**系统设置：软件限制策略在 Windows 可执行文件上使用证书规则**。

7.  如果尚未定义此策略设置，请选中“定义这些策略设置”复选框。

8.  执行下列操作之一，然后单击“确定”：

    -   若要启用证书规则，请单击“启用”。

    -   若要禁用证书规则，请单击“禁用”。

#### <a name="BKMK_4"></a>若要启用仅域控制器，和你的证书规则是在域控制器上或安装了远程服务器管理工具在工作站上

1.  打开“域控制器安全设置”。

2.  在控制台树中，单击“**GroupPolicyObject** [*ComputerName*] 策略/计算机配置/Windows 设置/安全设置/本地策略/”下的“安全选项”。

3.  在详细信息窗格中，双击**系统设置：软件限制策略在 Windows 可执行文件上使用证书规则**。

4.  如果尚未定义此策略设置，请选中“定义这些策略设置”复选框。

5.  执行下列操作之一，然后单击“确定”：

    -   若要启用证书规则，请单击“启用”。

    -   若要禁用证书规则，请单击“禁用”。

> [!NOTE]
> 只有在执行此过程后，证书规则才会生效。

### <a name="set-trusted-publisher-options"></a>设置受信任的发行者选项
越来越多的软件发行商和应用程序开发人员使用软件签名来证实其应用程序来自受信任的源。 但是，许多用户并不了解或没有注意他们所安装的应用程序关联的签名证书。

管理员使用证书路径验证策略的“受信任的发布者”选项卡中的策略设置，可以控制哪些证书可以作为来自受信任的发布者而被接受。

##### <a name="to-configure-the-trusted-publishers-policy-settings-for-a-local-computer"></a>配置本地计算机的受信任的发布者策略设置的步骤

1.  上**启动**屏幕上，键入**gpedit.msc** ，然后按 ENTER。

2.  在控制台树中的“本地计算机策略\计算机配置\Windows 设置\安全设置”下，单击“公钥策略”。

3.  双击“证书路径验证设置”，然后单击“受信任的发布者”选项卡。

4.  选中“定义这些策略设置”复选框，选择要应用的策略设置，然后单击“确定”应用新设置。

##### <a name="to-configure-the-trusted-publishers-policy-settings-for-a-domain"></a>配置域的受信任的发布者策略设置的步骤

1.  打开**组策略管理**。

2.  在控制台树中，双击**组策略对象**中的林和域包含**默认域策略**组策略对象 (GPO)，你想要编辑。

3.  右键单击“默认域策略”GPO，然后单击“编辑”。

4.  在控制台树中的“计算机配置\Windows 设置\安全设置”下，单击“公钥策略”。

5.  双击“证书路径验证设置”，然后单击“受信任的发布者”选项卡。

6.  选中“定义这些策略设置”复选框，选择要应用的策略设置，然后单击“确定”应用新设置。

##### <a name="to-allow-only-administrators-to-manage-certificates-used-for-code-signing-for-a-local-computer"></a>仅允许管理员管理用于本地计算机代码签名的证书的步骤

1.  上**启动**屏幕中，键入， **gpedit.msc**中**搜索程序和文件**或在 Windows 8 中，在桌面，然后按 ENTER 键。

2.  在控制台树中下**默认域策略**或**本地计算机策略**，双击**计算机配置**， **Windows 设置**，并**安全设置**，然后单击**公钥策略**。

3.  双击“证书路径验证设置”，然后单击“受信任的发布者”选项卡。

4.  选中“定义这些策略设置”复选框。

5.  在“受信任的发布者管理”下，单击“仅允许所有管理员管理受信任的发布者”，然后单击“确定”应用新设置。

##### <a name="to-allow-only-administrators-to-manage-certificates-used-for-code-signing-for-a-domain"></a>仅允许管理员管理用于域代码签名的证书的步骤

1.  打开**组策略管理**。

2.  在控制台树中，双击**组策略对象**中的林和域包含**默认域策略**你想要编辑的 GPO。

3.  右键单击“默认域策略”GPO，然后单击“编辑”。

4.  在控制台树中的“计算机配置\Windows 设置\安全设置”下，单击“公钥策略”。

5.  双击“证书路径验证设置”，然后单击“受信任的发布者”选项卡。

6.  选中“定义这些策略设置”复选框，实施所需的更改，然后单击“确定”以应用新设置。

## <a name="BKMK_Hash_Rules"></a>使用哈希规则
哈希是具有固定长度的一系列字节，用于唯一标识某个软件程序或文件。 哈希由哈希算法计算。 为软件程序创建哈希规则后，软件限制策略将计算该程序的哈希。 当用户尝试打开某个软件程序时，会将该程序的哈希与软件限制策略的现有哈希规则进行比较。 不管软件程序位于计算机上的哪个位置，该程序的哈希都始终相同。 但是，如果以任何方式对软件程序做了更改，则其哈希也会更改，不再与软件限制策略的哈希规则中的哈希匹配。

例如，可以创建一个哈希规则并将安全级别设置为“不允许”，以防止用户运行特定的文件。 可以重命名某个文件或将其移到另一个文件夹，而哈希仍保持相同。 但是，如果对该文件进行了任何更改，则也会更改它的哈希值，并允许它绕过限制。

#### <a name="to-create-a-hash-rule"></a>创建哈希规则的步骤

1.  打开“软件限制策略”。

2.  在控制台树或详细信息窗格中，右键单击**其他规则**，然后单击**新哈希规则**。

3.  单击**浏览**查找的文件。

    > [!NOTE]
    > 在 Windows XP 中就可以粘贴中预先计算的哈希**文件哈希**。 在 Windows Server 2008 R2、 Windows 7 和更高版本中，此选项不可用。

4.  在中**安全级别**，单击**不允许**或**Unrestricted**。

5.  在“描述”中键入此规则的描述，然后单击“确定”。

> [!NOTE]
> -   可能需要为组策略对象 (GPO) 创建新的软件限制策略设置（如果尚未这样做）。
> -   可以针对病毒或特洛伊木马程序创建一个哈希规则以防止它们运行。
> -   如果您希望其他人使用哈希规则，以便防止运行某个病毒，使用软件限制策略计算的哈希的病毒和电子邮件发送给其他人的哈希值。 永远不会发送电子邮件病毒本身。
> -   如果已通过电子邮件发送了病毒，还可以创建路径规则，以防止电子邮件附件的执行。
> -   重命名某个文件或将其移到另一个文件夹后，哈希将保持相同。 对文件本身的任何更改会导致不同的哈希。
> -   哈希规则影响的文件类型只有软件限制策略详细信息窗格中“指定的文件类型”所列出的那些文件类型。 有一个指定文件类型列表由所有规则共享。
> -   软件限制策略生效，用户必须注销然后登录到他们的计算机的更新策略设置。
> -   当多个软件限制策略规则应用于策略设置时，没有用于处理冲突的规则的优先权。

## <a name="BKMK_Internet_Zone_Rules"></a>使用 Internet 区域规则
Internet 区域规则只适用于 Windows Installer 程序包。 区域规则可以识别通过 Internet Explorer 指定的区域中的软件。 这些区域为“Internet”、“本地 Intranet”、“受限制的站点”、“受信任的站点”和“我的电脑”。 Internet 区域规则旨在防止用户下载和安装软件。

#### <a name="to-create-an-internet-zone-rule"></a>创建 Internet 区域规则的步骤

1.  打开“软件限制策略”。

2.  在控制台树或详细信息窗格中，右键单击**其他规则**，然后单击**新建 Internet 区域规则**。

3.  在“Internet 区域”中单击一个 Internet 区域。

4.  在中**安全级别**，单击**不允许**或**Unrestricted**，然后单击**确定**。

> [!NOTE]
> -   可能需要为组策略对象 (GPO) 创建新的软件限制策略设置（如果尚未这样做）。
> -   区域规则只适用于文件类型为 .msi 的文件（即 Windows Installer 程序包）。
> -   软件限制策略生效，用户必须注销然后登录到他们的计算机的更新策略设置。
> -   当多个软件限制策略规则应用于策略设置时，没有用于处理冲突的规则的优先权。

## <a name="BKMK_Path_Rules"></a>使用路径规则
路径规则根据软件的文件路径来识别软件。 例如，如果计算机的默认安全级别为“不允许”，则你仍可为每个用户授予对特定文件夹的无限制访问权限。 你可以创建一个路径规则，方法是使用文件路径，并将路径规则的安全级别设置为“不受限”。 这种类型的规则的某些常见路径为 %userprofile%、%windir%、%appdata%、%programfiles% 和 %temp%。 还可以创建注册表路径规则，这些规则使用软件的注册表项作为其路径。

由于这些规则是按路径指定的，因此，如果移动了软件程序，路径规则将不再适用。

#### <a name="to-create-a-path-rule"></a>创建路径规则的步骤

1.  打开“软件限制策略”。

2.  在控制台树或详细信息窗格中，右键单击**其他规则**，然后单击**新建路径规则**。

3.  在“路径”中键入一个路径，或者单击“浏览”查找文件或文件夹。

4.  在中**安全级别**，单击**不允许**或**Unrestricted**。

5.  在“描述”中键入此规则的描述，然后单击“确定”。

> [!CAUTION]
> -   对于某些文件夹，例如 Windows 文件夹中，将安全级别设置为**不允许**产生负面影响您的操作系统的操作。 请确保不要禁止运行操作系统的某个关键组件或某个依赖程序。

> [!NOTE]
> -   可能需要为组策略对象 (GPO) 创建新的软件限制策略（如果尚未这样做）。
> -   如果为安全级别为“不允许”的软件创建了路径规则，用户仍可以通过将该软件复制到其他位置来运行该软件。
> -   路径规则支持的通配符为 * 和 ?。
> -   可以在路径规则中使用环境变量，例如 %programfiles% 或 %systemroot%。
> -   在不知道软件存储在计算机中的哪个位置，但知道它的注册表项的情况下，如果要为该软件创建路径规则，你可以创建注册表路径规则。
> -   若要防止用户执行电子邮件附件，可以创建阻止用户运行电子邮件附件的电子邮件程序的附件目录的路径规则。
> -   路径规则影响的文件类型只有软件限制策略详细信息窗格中“指定的文件类型”所列出的那些文件类型。 有一个指定文件类型列表由所有规则共享。
> -   软件限制策略生效，用户必须注销然后登录到他们的计算机的更新策略设置。
> -   当多个软件限制策略规则应用于策略设置时，没有用于处理冲突的规则的优先权。

#### <a name="to-create-a-registry-path-rule"></a>创建注册表路径规则的步骤

1.  上**启动**屏幕上，键入 regedit。

2.  在控制台树中，右键单击要为其创建规则的注册表项，然后单击“复制项名称”。 记下详细信息窗格中的值名称。

3.  打开“软件限制策略”。

4.  在控制台树或详细信息窗格中，右键单击**其他规则**，然后单击**新建路径规则**。

5.  在中**路径**，粘贴注册表项名称后, 接值名称。

6.  将注册表路径括在百分号 （%），例如，%hkey_local_machine\software\microsoft\platformsdk\directories\installdir%。

7.  在中**安全级别**，单击**不允许**或**Unrestricted**。

8.  在“描述”中键入此规则的描述，然后单击“确定”。


