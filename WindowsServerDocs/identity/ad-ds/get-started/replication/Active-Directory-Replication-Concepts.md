---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Active Directory 复制概念
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 087dee7c914b81d97c6cf3a2ea985d809cb57fe6
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59812348"
---
# <a name="active-directory-replication-concepts"></a>Active Directory 复制概念

>适用于：Windows Server 2016 中，Windows Server 2012 R2、 Windows Server 2012

设计站点拓扑之前, 熟悉一些 Active Directory 复制概念。  
  
-   [连接对象](#BKMK_1)  
  
-   [KCC](#BKMK_2)  
  
-   [故障转移功能](#BKMK_3)  
  
-   [Subnet](#BKMK_4)  
  
-   [站点](#BKMK_5)  
  
-   [站点链接](#BKMK_6)  
  
-   [站点链接桥](#BKMK_7)  
  
-   [站点链接可传递性](#BKMK_8)  
  
-   [全局编录服务器](#BKMK_9)  
  
-   [通用组成员身份缓存](#BKMK_10)  
  
## <a name="BKMK_1"></a>连接对象  
连接对象是一个 Active Directory 对象，表示从源域控制器到目标域控制器的复制连接。 是单个站点的成员和由 Active Directory 域服务 (AD DS) 中的服务器对象表示站点中的域控制器。 每个服务器对象具有的子 NTDS 设置对象，表示站点中复制的域控制器。  
  
连接对象是目标服务器上的 NTDS 设置对象的子级。 对于两个域控制器之间的复制，其中一个的服务器对象必须具有表示从其他入站的复制连接对象。 域控制器的所有复制连接下的 NTDS 设置对象的连接对象作为都存储。 连接对象标识复制源服务器、 包含一个复制计划，并指定复制传输。  
  
知识一致性检查器 (KCC) 自动创建连接对象，但也可以手动创建。 连接由 KCC 创建的对象出现在 Active Directory 站点和服务管理单元作为**<automatically generated>** 并被视为足够在正常操作情况下。 由管理员创建的连接对象手动创建连接对象。 手动创建的连接对象由其创建时由管理员分配的名称标识。 当修改**<automatically generated>** 连接对象，则将其转换为以管理方式修改后的连接对象和对象将出现在窗体的 GUID。 KCC 不会为手动或已修改的连接对象进行更改。  
  
## <a name="BKMK_2"></a>KCC  
KCC 是一个内置的过程，将所有域控制器上运行并生成复制拓扑的 Active Directory 林。 KCC 创建不同的复制拓扑，具体取决于复制以站点 （站点内） 中还是站点 （站点间） 之间发生。 KCC 还能动态调整以容纳新的域控制器、 删除了现有的域控制器、 域控制器与更改成本和计划的站点和域控制器的移动新增的拓扑暂时不可用或处于错误状态。  
  
在网站中，可写域控制器之间的连接始终排列在双向环，与其他快捷方式连接以减少大型站点中的延迟。 但是，站点间拓扑是分层的跨越树，这意味着一个站点间连接为每个目录分区的任何两个站点之间存在，并且通常不包含快捷方式连接。 有关跨越树和 Active Directory 复制拓扑的详细信息，请参阅 Active Directory 复制拓扑技术参考 ([https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578))。  
  
每个域控制器上，KCC 创建复制路由，通过创建定义来自其他域控制器的连接的单向入站的连接对象。 对于在同一站点中的域控制器，KCC 创建自动而无需管理干预的连接对象。 当有多个站点时，请配置站点间的站点链接和每个站点中的单个 KCC 自动创建以及站点之间的连接。  
  
### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Windows Server 2008 Rodc 的 KCC 改进  

有了大量 KCC 改进，以适应 Windows Server 2008 中的最新可用的只读域控制器 (RODC)。 典型的部署方案，rodc 是分支机构。 在此方案中最常部署的 Active Directory 复制拓扑基于中心辐射型设计，其中多个站点中的分支域控制器复制较少的中心站点中桥头服务器。  
  
在此方案中部署 RODC 的优势之一是单向复制。 桥头服务器不需要复制从 RODC，从而减少了管理和网络使用情况。  
  
但是，由以前版本的 Windows Server 操作系统上的中心辐射型拓扑突出显示的管理难题之一是，在中心中添加新的桥头域控制器后, 没有任何自动机制以重新分配分支域控制器和集线器域控制器，才能利用新的中心域控制器之间的复制连接。  
  
对于 Windows Server 2003 域控制器，你可以通过重新平衡工作负荷使用从 Windows Server 2003 分支 Office 部署指南 Adlb.exe 之类的工具 ([https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523))。  
  
对于 Windows Server 2008 Rodc，KCC 的正常功能提供了一些重新平衡，这消除了需要使用另一种工具如 Adlb.exe。 默认情况下启用的新功能。 可以通过添加在 RODC 上设置以下注册表项来禁用它：  
  
**HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters**  
  
**"允许的随机 BH 负载平衡"**  
**1 = 已启用 （默认值），0 = 已禁用**  
  
有关这些 KCC 改进的工作原理的详细信息，请参阅规划和部署分支机构的 Active Directory 域服务 ([https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114))。  
  
## <a name="BKMK_3"></a>故障转移功能  
站点可确保复制路由周围出现网络故障以及脱机域控制器。 KCC 会在指定的时间间隔来调整在 AD DS 中发生的更改的复制拓扑，如添加新的域控制器时，新创建的站点。 KCC 查看复制状态的现有连接，以确定任何连接都无效。 如果连接不使用由于故障的域控制器，KCC 自动生成临时连接到其他复制伙伴 （如果可用） 以确保能进行复制。 如果站点中的所有域控制器都都不可用，KCC 自动创建另一个站点中的域控制器之间的复制连接。  
  
## <a name="BKMK_4"></a>子网  
子网是一组逻辑 IP 地址分配到 TCP/IP 网络的段。 子网组标识网络上的实际距离一种方法中的计算机。 在 AD DS 中的子网对象标识用于将计算机映射到站点的网络地址。  
  
## <a name="BKMK_5"></a>站点  
站点是 Active Directory 对象，表示一个或多个 TCP/IP 子网具有高度可靠、 快速网络连接。 站点信息允许管理员配置 Active Directory 访问和复制，以优化的物理网络使用情况。 站点对象都与一组子网，并且在林中每个域控制器与 Active Directory 站点根据其 IP 地址相关联。 站点可以托管多个域中域控制器和域可以表示多个站点中。  
  
## <a name="BKMK_6"></a>站点链接  
站点链接是 Active Directory 对象，表示 KCC 使用建立 Active Directory 复制的连接的逻辑路径。 站点链接对象表示的一组可以通过指定的站点间传输的统一费用进行通信的站点。  
  
站点链接中包含的所有站点被都视为连接通过相同的网络类型。 站点必须手动链接到其他站点使用站点链接，以便在一个站点的域控制器可以从另一个站点内域控制器复制目录更改。 站点链接不对应于物理网络上的网络数据包在复制期间执行的实际路径，因为您不需要创建冗余的站点链接，以提高 Active Directory 复制效率。  
  
当两个站点连接的站点链接时，复制系统自动创建每个站点中均称为桥头服务器的特定域控制器之间的连接。 在 Windows Server 2008 中，站点中托管的相同目录分区的所有域控制器用于选择作为桥头服务器都是候选项。 复制连接由 KCC 创建随机分布共享复制工作负荷的站点中的所有候选桥头服务器。 默认情况下，随机的选择过程都将进行仅一次，当连接对象首次添加到该站点。  
  
## <a name="BKMK_7"></a>站点链接桥  
其站点的所有站点链接桥是一个 Active Directory 对象，表示一组站点链接，通过一种常见传输可以通信。 站点链接桥，允许通过将其相互复制的通信链接没有直接连接的域控制器。 通常情况下，站点链接桥对应于路由器 （或一系列路由器） IP 网络上。  
  
默认情况下，KCC 可以形成一个可传递路由通过具有共同的某些站点的所有站点链接。 如果禁用此行为，则每个站点链接代表其自身独特的隔离的网络。 可将其视为单个路由的站点链接集表示通过站点链接桥。 每个桥表示网络流量隔离的通信环境。  
  
站点链接桥是一种机制以逻辑方式表示可传递站点之间的物理连接。 站点链接桥允许 KCC 使用包含的站点链接的任意组合来确定开销最少的路由来相互连接保存在这些站点中的目录分区。 站点链接桥不提供实际连接到域控制器。 如果删除站点链接桥，则在组合的站点链接上的复制将继续，直到 KCC 删除链接。  
  
站点链接桥只能有必要，如果站点包含托管目录分区，也不是相邻站点中的域控制器上托管的域控制器，但在一个或多个其他站点中找到域控制器托管的目录分区林。 相邻站点被定义为包含在单个站点链接中任何两个或多个站点。  
  
站点链接桥将创建两个站点链接，提供两个断开连接站点通过使用临时站点之间的可传递路径之间的逻辑连接。 对于站点间拓扑生成器 (ISTG) 而言，桥使用临时站点意味着物理连接。 桥并不表示临时站点中的域控制器将提供的复制路径。 但是，这会出现这种情况，如果临时站点包含托管要复制的目录分区的域控制器，在这种情况下的站点链接桥不需要。  
  
添加的每个站点链接成本，创建生成的路径的总和的开销。 如果临时站点不包含域控制器托管的目录分区和较低的成本链接不存在，则将使用站点链接桥。 如果临时站点包含托管目录分区的域控制器，断开连接的两个站点将设置复制到临时域控制器的连接和不使用桥接。  
  
## <a name="BKMK_8"></a>站点链接可传递性  
默认情况下所有站点链接都都可传递的或"桥接"。 当站点链接被桥接，计划重叠，KCC 创建确定的站点，其中站点通过站点链接不直接连接但间接通过连接之间的域控制器复制伙伴的复制连接一组常见的站点。 这意味着，你可以连接到任何其他站点通过站点链接的任何站点。  
  
一般情况下，对于完全路由的网络，你不需要创建任何站点链接桥，除非你想要控制复制更改的流。 如果你的网络没有完全路由，则应创建站点链接桥以避免不可能的复制尝试的。 为特定传输的所有站点链接隐式都属于该传输的单个站点链接桥。 默认针对的桥接站点链接自动发生，并没有 Active Directory 对象表示该桥。 **桥接所有站点链接**设置，IP 和简单邮件传输协议 (SMTP) 站点间传输容器的属性中找到实现自动站点链接桥接。  
  
> [!NOTE]  
> SMTP 复制将不支持在将来版本的 AD DS;因此，不建议在 SMTP 容器中创建站点链接对象。  
  
## <a name="BKMK_9"></a>全局编录服务器  
全局编录服务器是将所有对象的信息存储在林中的域控制器，以便应用程序可以参考存储请求的数据的特定域控制器的情况下搜索 AD DS。 所有域控制器，如全局编录服务器存储的架构和配置目录分区的完整、 可写副本和它所托管的域的域目录分区的完整、 可写副本。 此外，全局编录服务器存储了林中每个其他域的部分、 只读副本。 部分、 只读的域的副本包含域，但只有一部分的属性 （这些属性通常用于搜索对象） 中的每个对象。  
  
## <a name="BKMK_10"></a>通用组成员身份缓存  
通用组成员身份缓存可以缓存通用组成员资格信息的用户的域控制器。 你可以启用使用正在运行 Windows Server 2008 缓存通用组成员身份的 Active Directory 站点和服务管理单元中的域控制器。  
  
启用通用组成员身份缓存不需要在域中，这样就会减少网络带宽使用情况，因为域控制器不需要复制的所有对象在林中每个站点上的全局编录服务器。 它还降低了登录时间，因为身份验证的域控制器不始终需要访问全局编录，以获取通用组成员身份信息。 有关何时使用通用组成员身份缓存的详细信息，请参阅[规划全局编录服务器放置](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md)。  
  


