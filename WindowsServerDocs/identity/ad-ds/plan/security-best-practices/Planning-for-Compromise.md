---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: 规划泄露
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 0f6a30c91590667a0894b52ec7c188a43bd5e351
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59835568"
---
# <a name="planning-for-compromise"></a>规划泄露

>适用于：Windows Server 2016 中，Windows Server 2012 R2、 Windows Server 2012

*定律第一部分：没有人认为不好可能发生，直到它。* - [十个永恒定律的安全管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
在许多组织中的灾难恢复计划重点介绍从区域灾难影响或导致丢失的计算服务的故障中恢复。 但是，在使用遭到入侵的客户，我们经常会发现从有意泄露中恢复不存在于其灾难恢复计划。 这种损害导致被盗的知识产权或有意为之而不是物理边界 （如利用逻辑边界 （如析构的所有 Active Directory 域或所有服务器） 的析构时更是如此析构的数据中心）。 尽管组织可能具有定义初始当发现泄漏时要执行的活动的事件响应计划，但这些计划通常省略步骤来恢复不会影响整个计算基础结构会遭破坏。  
  
因为 Active Directory 为用户、 服务器、 工作站和应用程序提供丰富的标识和访问管理功能，它总是攻击者的目标。 如果攻击者高特权的访问 Active Directory 域或域控制器，可以利用该访问权限来访问、 控制或甚至会破坏整个 Active Directory 林。  
  
本文档还介绍了一些最常见的攻击针对 Windows 和 Active Directory 和对策可以实现以减少攻击面，但一旦完成遭到破坏的 Active Directory 恢复的唯一确定方法的发生之前对其为这种损害做好准备。 此部分主要介绍减少对技术实现比的本文档前面部分的详细信息和更高级的建议，可用于创建上一种全面、 更全面的方法进行保护和管理你的组织的关键业务和 IT 资产。  
  
是否永远不会受到攻击你的基础结构，具有抵制尝试违规时，或 succumbed 受到攻击，并且被完全泄露，您应该计划不可避免的现实次又一次你受到攻击。 不能防止攻击，但它确实可能可以防止重大漏洞或批发泄露。 每个组织应密切评估其现有的风险管理程序，并进行必要的调整，以帮助预防、 检测、 包容和恢复，从而平衡的投资减少其整体安全漏洞的等级。  
  
若要创建有效防御措施，同时仍然为用户和依赖于基础结构和应用程序的企业提供服务，你可能需要考虑新颖的方法，以防止，检测和在环境中，包含泄漏和，则从恢复这种损害。 方法和本文档中的建议可能无法帮助你修复被破坏的 Active Directory 安装，但可以帮助你保护你的下一个。  
  
有关恢复 Active Directory 林的建议显示在[Windows Server 2012:规划 Active Directory 林恢复](https://www.microsoft.com/download/details.aspx?id=16506)。 您可能无法阻止新的环境完全受到威胁，但即使不能您将拥有工具来恢复并重新获得对环境的控制。  
  
## <a name="rethinking-the-approach"></a>重新考虑方法  
*法律数字八个：保护网络难点是直接成正比其复杂性。* - [十个永恒定律的安全管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
它是通常广泛接受，如果攻击者已获取系统、 管理员、 root 或等效访问的计算机，无论使用什么操作系统，该计算机可以不再视为值得信任的无论多少工作都将其"清除"系统。 Active Directory 是没有什么不同。 如果攻击者已获取对域控制器或高特权的帐户在 Active Directory 中，特许访问权限，除非你有一条记录的每次修改都会使攻击者或已知完好的备份，则可以永远不会还原到的目录完全可信状态。  
  
当成员服务器或工作站是破坏，攻击者更改时，计算机不再值得信任的但相邻遭入侵的服务器和工作站可以仍是受信任。 一台计算机受到安全威胁并不表示会损害所有计算机。  
  
但是，在 Active Directory 域中，所有域控制器都托管同一 AD DS 数据库的副本。 如果一个域控制器遭到破坏，并且攻击者修改 AD DS 数据库，这些修改将复制到每个其他域控制器的域中，具体取决于在其中进行了修改，在林中的分区。 即使您重新安装每个林中的域控制器，您只需重新安装 AD DS 数据库所驻留的主机。 对 Active Directory 的恶意修改会轻松它们将复制到已经运行多年的域控制器复制到刚才安装的域控制器。  
  
在评估受破坏的环境，我们通常发现，什么被认为是第一个违反"事件"实际触发周后，几个月，或甚至数年后攻击者最初有破坏环境。 攻击者通常获得长的高特权帐户的凭据之前检测到违规，并且他们利用这些帐户泄露 directory、 域控制器、 成员服务器、 工作站，并甚至连接非 Windows系统。  
  
这些结果是与多个结果在 Verizon 的 2012年数据违规调查报告，其中指出一致：  
  
-   98%的词干分析来自外部代理的数据泄露  
  
-   85%的数据泄露花费了数周或了解更多信息  
  
-   第三方，发现 92%的事件和  
  
-   97%的漏洞能够避免，尽管简单或者控件的中间。  
  
到前面所述的程度危害是无法有效地修复，并"平展并重新生成"的标准建议每个受攻击的系统如果，则只需不可行或甚至可能泄露 Active Directory 或将其销毁。 即使还原到已知的良好状态不会消除允许环境遭到入侵第一个位置中的缺陷。  
  
尽管必须保护您的基础结构的每个方面，攻击者只需在您的防御措施，以访问其所需的目标中找到足够的缺陷。 如果你的环境是相对简单和原始，和从历史上看妥善管理，然后实现本文档中前面提供的建议可能简单易懂。  
  
但是，我们发现，较旧、 更大、 更复杂环境，更有可能是，本文档中的建议将是不可行或甚至不可能实现。 它是很难在事后安全基础结构，比重新开始，并构造是抵御攻击和损坏的环境。 但如上文所述，任何小型工作，若要重新生成整个 Active Directory 林。 出于这些原因，我们建议更有针对性的、 针对性的方法来保护 Active Directory 林。  
  
而不是将重点放在并尝试修复所有的事情"中断"的应用程序，请考虑在其中您排定优先级的方法的内容为对你的业务和基础结构中最重要基础。 而不是尝试修正填入过时了，配置错误的系统和应用程序的环境，请考虑创建新的小型的安全环境，将在其中您可以安全地移植用户、 系统和信息是最关键的应用业务。  
  
在本部分中，我们将介绍一种方法可以按其创建用作"生命船"或"安全单元格"核心业务基础结构的原始 AD DS 林。 原始林是只需将新安装 Active Directory 林，通常受限制的大小和作用域，并且旨在通过使用当前操作系统、 应用程序，以及通过中所述的原则[减少活动目录受攻击面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。  
  
通过在新生成的林中实现建议的配置设置，可以创建 AD DS 安装的从零开始使用安全设置和实践，构建并可以减少伴随支持旧系统的挑战和应用程序。 虽然本文档的讨论范围内的详细的说明的设计和实现原始的 AD DS 安装，应遵循某些一般原则和指南，可创建在其中可容纳最关键的"安全单元"资产。 这些准则如下所示：  
  
1.  标识用于分离和保护关键资产的原则。  
  
2.  定义一个有限的、 基于风险的迁移计划。  
  
3.  如有必要，请利用"nonmigratory"迁移。  
  
4.  实现"creative 析构。"  
  
5.  隔离旧系统和应用程序。  
  
6.  为最终用户简化安全设置。  
  
### <a name="identifying-principles-for-segregating-and-securing-critical-assets"></a>为分离和保护关键资产标识原则  

创建房子的关键资产到在原始环境的特征可能会千差万别。 例如，你可以选择创建原始林从其中迁移仅 VIP 用户和仅这些用户可以访问的敏感数据。 可以创建在其中未迁移的原始林仅 VIP 用户，但其实现为管理林中，实现原则中所述[减少 Active Directory 攻击面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)可以创建安全管理帐户和可以用于从原始林管理旧林的主机。 您可能会实现存储 VIP 帐户、 特权的帐户和唯一的目标是将它们从安全级别较低的隔离开需要额外的安全，如运行 Active Directory 证书服务 (AD CS) 服务器系统的"专用"林林。 最后，您可以实现将成为所有新用户，系统、 应用程序和数据的实际位置的原始林可以最终停止使用旧版林通过客户流失。  
  
无论是否在原始林中包含少量的用户，系统或其构成加强对迁移的基础，应在规划过程中遵循这些原则：  
  
1.  假定旧林已破坏。  
  
2.  尽管可以配置较旧的环境以信任原始林，则不要配置信任的旧的林中，原始环境。  
  
3.  不会迁移用户帐户或组从旧的林到的原始环境，如果该帐户的组成员身份、 SID 历史记录或其他属性可能已被恶意修改的情况。 相反，使用"nonmigratory"方法来填充原始林。 （nonmigratory 方法描述了更高版本在本部分中。）  
  
4.  不会迁移计算机从旧的林到原始的林。 在原始林中实现新安装的服务器、 在新安装的服务器上安装应用程序和将应用程序数据迁移到新安装的系统。 对于文件服务器，将数据复制到刚才安装的服务器、 使用中新建林，用户和组设置 Acl，然后创建以类似的方式的打印服务器。  
  
5.  不允许旧版操作系统或应用程序在原始林中的安装。 如果应用程序不能更新和全新安装，将其保留在旧的林，并考虑 creative 破坏来替换应用程序的功能。  
  
### <a name="defining-a-limited-risk-based-migration-plan"></a>定义一个有限的、 基于风险的迁移计划  
创建有限，基于风险的迁移计划只是意味着，当决定哪些用户、 应用程序和数据，可以将迁移到原始林中，您应该确定迁移目标，如果一个向其公开你的组织的风险的程度上基于的用户或系统遭到入侵。 其帐户是最有可能攻击者的目标的 VIP 用户应当放在原始的林。 提供重要的业务函数应安装在全新构建原始林中的服务器上并且高度敏感的数据应移动到的应用程序保护原始林中的服务器。  
  
如果没有在 Active Directory 环境中清楚地了解大多数关键业务用户、 系统、 应用程序和数据，请与业务部门，以便于识别这些。 应确定所需的业务操作的任何应用程序，也应在其运行关键应用程序或存储关键数据的任何服务器。 通过标识的用户和资源所需的组织可以继续工作，您创建自然会按优先级排列要专注于你的资产的集合。  
  
### <a name="leveraging-nonmigratory-migrations"></a>利用"Nonmigratory"迁移  
是否知道您的环境已遭到破坏，怀疑它已泄露，或者只是暂时不想将旧数据和对象从旧的 Active Directory 安装迁移到一个新，请考虑技术上不执行操作的迁移方法"迁移"的对象。  
  
### <a name="user-accounts"></a>用户帐户  
在传统 Active Directory 迁移从林到另一个用户对象上的 sid 历史记录 （SID 历史记录） 属性用于存储用户的 SID，并且用户已在旧的林中的成员的组的 Sid。 如果用户帐户迁移到新林，并且它们访问传统林中的资源，SID 历史记录中的 Sid 用于创建可访问到它们具有访问权之前已迁移帐户的资源的用户的访问令牌。  
  
维护 SID 历史记录，但是，已被证明有问题，在某些环境中因为填充当前和历史 sid 的用户的访问令牌可能会导致令牌膨胀。 令牌的膨胀问题中使用的必须存储在用户的访问令牌中的 Sid 数或超出的令牌中的可用空间量。  
  
令牌大小可以增加一定范围内，尽管令牌膨胀的最终解决方案是减少通过合理组织组成员身份，消除了 SID 历史记录或这两者的组合的用户帐户相关联的 Sid。 有关令牌膨胀的详细信息，请参阅[MaxTokenSize 和 Kerberos 令牌膨胀](http://blogs.technet.com/b/shanecothran/archive/2010/07/16/maxtokensize-and-kerberos-token-bloat.aspx)。  
  
而不是从旧环境的迁移用户 （特别是在哪些组成员身份和 SID 历史记录可能会受到一个） 通过使用 SID 历史记录，请考虑利用"迁移"的用户，无需在 SID 历史记录的元目录应用程序到新的林。 用户帐户创建时在新林，你可以使用元目录的应用程序将帐户映射到其相应林中旧帐户。  
  
若要提供新用户帐户访问旧林中的资源，可以使用元目录工具来确定用户的旧帐户已在其中授予访问权限，资源组，并将用户的新帐户添加到这些组。 具体取决于您在旧的林中的组策略，您可能需要创建域本地组访问资源或将现有的组转换为域本地组，以允许新用户帐户添加到资源组。 通过将重点放在最关键的应用程序和数据的第一次，并将其迁移到新环境 （有或没有 SID 历史记录），可以限制的旧环境中所花费的工作量。  
  

  
### <a name="servers-and-workstations"></a>服务器和工作站  
在从一个 Active Directory 为传统的迁移到另一个，迁移计算机林通常是相对简单相比迁移用户、 组和应用程序。 具体取决于计算机角色，将迁移到新的林可以是简单，只会取消旧域加入一个新。 但是，迁移计算机帐户保持不变到原始林中失败创建全新的环境的目的。 而不是迁移 （可能已泄露、 配置错误，或已过时） 的计算机帐户添加到新林，则应全新安装服务器和工作站在新环境中。 可以从系统到原始林中的系统旧的林中，但不是系统用于容装数据迁移数据。  
  
### <a name="applications"></a>应用程序  

应用程序可以在一个林中的任何迁移到另一个，提供最大的难题，但对于"nonmigratory"迁移时，应该应用的最基本原则之一是在原始林中的应用程序应为最新的支持，以及全新安装。 在可能的情况，可以从旧的林中的应用程序实例迁移数据。 在其中应用程序不能"重新创建"原始林中的情况下，应考虑方法，例如 creative 析构或旧版应用程序隔离下, 一节中所述。  
  
### <a name="implementing-creative-destruction"></a>实现创意析构  
Creative 析构是订单的经济术语，用于描述经济开发创建的以前的析构。 近年来，术语已应用于信息技术。 它通常指机制通过消除的旧的基础结构，不通过升级，但通过将它替换为完全新事物。 2011年[Gartner 研讨会 ITXPO](http://www.gartner.com/technology/symposium/orlando/)的首席信息官和高级 IT 管理人员的效率提供 creative 析构作为一种降低成本并使其关键主题。 作为自然而然的进程可能会出现安全性方面的改进。  

例如，组织可能使用执行类似的功能，具有不同程度的时尚和供应商支持的不同应用程序的多个业务单位的组成。 从历史上看，IT 可能负责维护每个业务单位的应用程序分开，并整合工作，将包含尝试找出哪些应用程序提供的最佳功能，然后将数据迁移到的从其他应用程序。  
  
在 creative 销毁，而不是维护过时或多余的应用程序，将实现全新的应用程序若要替换旧，将数据迁移到新的应用程序，并解除旧的应用程序和其运行的系统的授权。 在某些情况下，可以通过部署自己的基础结构中的新应用程序来实现创意析构的旧版应用程序，但只要有可能，应考虑改用移植到基于云的解决方案的应用程序。  
  
通过部署基于云的应用程序来替换旧的内部应用程序，您不仅能减少维护工作量和成本，但旧系统和应用程序的存在漏洞，从而降低组织的受攻击面攻击者利用。 这种方法提供了更快的方法，组织同时消除传统基础结构中的目标时获取所需的功能。 尽管 creative 析构的原则不适用于所有 IT 资产，它提供通常可行同时部署可靠、 安全、 基于云的应用程序时消除旧系统和应用程序。  
  
### <a name="isolating-legacy-systems-and-applications"></a>隔离旧系统和应用程序  
自然而然迁移到一个全新、 安全的环境的关键业务用户和系统的是不太有价值的信息和系统，将包含旧林。 尽管的旧系统和应用程序保留在较不安全的环境中可能存在泄漏的风险，但它们也表示遭到破坏的低的严重性。 通过将重新定位并更新你的关键业务资产，您可以集中精力部署有效的管理和监视时不需要以适应旧设置和协议。  
  
时已重新连接到原始林中关键数据，你可以评估到选项进一步隔离旧系统和应用程序中"主"AD DS 林。 尽管您可能会实现创意析构替换一个应用程序和其运行所在的服务器，可以在其他情况下考虑最不安全的系统和应用程序的其他隔离。 例如，一个应用程序由少量的用户，又需要旧式凭据，例如 LAN Manager 哈希可以迁移到较小的域创建以支持的系统对其具有任何替换选项。  
  
通过从域则可以强制转换的旧设置实现删除这些系统，可以随后增加域的安全，它们配置为仅支持当前操作系统和应用程序。 虽然最好解除旧系统和应用程序应尽可能的授权。 如果解除授权，只是不可行的旧填充的一小部分分离到单独域 （或林），可将旧安装其余部分中执行增量改进。  
  
### <a name="simplifying-security-for-end-users"></a>为最终用户简化安全性  
在大多数组织中，通常在组织中有权访问其角色由于的特性的最敏感信息的用户具有最少的时间投入到复杂的访问限制和控件的学习。 虽然应组织中有一个全面的安全性教育计划，为所有用户，您应集中精力使安全性作为简单尽可能使用通过实现透明和简化原则的用户控件遵循。  
  
例如，可以定义在其中高级管理人员和其他 Vip 需要使用安全工作站来访问敏感数据和系统，允许其使用其他设备来访问敏感程度较低的数据的策略。 这是用户需要记住，一个简单的原则，但可以实现多个后端控件，以帮助强制实施的方法。  

可以使用[身份验证机制保证](https://technet.microsoft.com/library/dd391847(v=WS.10).aspx)可允许用户访问敏感数据，仅当它们已登录到使用其智能卡，其安全系统，并且可以使用 IPsec 和用户权限限制到控件从中他们可以连接到的敏感数据存储库的系统。 可以使用[Microsoft 数据分类工具包](https://www.microsoft.com/download/details.aspx?id=27123)若要构建可靠的文件分类基础结构，并且您可以实现[动态访问控制](http://blogs.technet.com/b/windowsserver/archive/2012/05/22/introduction-to-windows-server-2012-dynamic-access-control.aspx)来限制对基于数据访问将业务规则转换为的技术控制的访问尝试的特征。  
  
从用户的角度来看，访问受保护系统"正常工作，"中的敏感数据并尝试从一个不安全系统中执行操作"就不会。" 但是，从监视和管理你的环境的角度来看，您将有助于在用户访问的方式的敏感数据和系统，使你能够检测异常的访问尝试更轻松地创建可识别的模式。  
  
在用户抵制长而复杂的密码导致没有足够的密码策略，特别是对于 VIP 用户的环境中考虑的替代方法向身份验证，是否通过智能卡 (其中有大量外形规格和并提供其他功能来增强身份验证），生物识别控件，如手指轻扫读取器或甚至身份验证数据保护的受信任的平台模块 (TPM) 芯片中用户的计算机为基础。 尽管多重身份验证不会阻止凭据被盗攻击，如果计算机已泄露，请通过为用户提供易于使用的身份验证控制，您可以更可靠向分配密码的用户帐户为其传统用户名称和密码的控件是难以处理。  
