---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: 规划危害
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 7cb87e6b9d1ace15050dcbff8b3c6d864c2a18f0
ms.sourcegitcommit: f2e98f8b7828730b83a3cc8f0e33d4e4db1b16e1
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/02/2018
---
# 规划危害

>适用于：Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

*法律数字 1： 没有人认为任何坏可以发生变化它们，直到它。* - [10 永恒的法律的安全管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
在许多组织灾难恢复计划中心恢复从区域灾难或失败导致丢失的计算服务。 然而，如果使用受损客户，我们通常查找从有意危害恢复不存在于其灾难恢复计划。 这是如此危害导致窃取知识产权或故意破坏 （如而不是实际边界利用逻辑边界 （如破坏所有 Active Directory 域或所有服务器）破坏的数据中心）。 尽管组织可能有应变计划来定义初始发现危害时要执行的活动，这些计划通常省略恢复从危害影响整个计算基础结构的步骤。  
  
Active Directory 为用户、 服务器、 工作站和应用程序提供了丰富的身份和访问管理功能，因为总是目标的攻击。 如果攻击获得特权的访问 Active Directory 域或域控制器，可以利用 access 来访问、 控制，或者甚至破坏整个 Active Directory 林。  
  
本文讨论了一些最常见攻击 Windows 和 Active Directory 并减少攻击面，但在 Active Directory 完成泄露发生时恢复仅确保方法可以实现的对策将是发生之前准备危害。 本节重点介绍小于上技术实现比此文档，以上各节的详细信息和更高级别可用于创建的建议的整体、 全面的方法来保护和管理您的组织的关键业务和 IT 资产。  
  
是否具有永远不会被攻击您基础结构，具有 resisted 传递违规，或具有 succumbed 攻击和已完全泄露，您应为计划反复您被攻击不可避免现实情况。 不能阻止攻击，但确实能可以阻止重大违规或大规模泄露。 每个组织密切应计算其现有的风险管理计划，并进行必要的调整，以帮助减少通过防护、 检测、 控制和恢复中使平衡的投资漏洞其总体级别。  
  
若要创建有效防护，但仍然为用户和取决于您的基础结构和应用程序的企业提供服务，您可能需要考虑新颖的方式，以防止，检测，包含您的环境中的危害，然后恢复从威胁。 方法和本文档中的建议可能没有帮助修复损坏的 Active Directory 安装，但可以帮助您保护您的下一个。  
  
恢复 Active Directory 林建议均以[Windows Server 2012： 规划 Active Directory 林恢复](https://www.microsoft.com/download/details.aspx?id=16506)。 您或许能够以防止不会受到完全，新环境，但是即使您不能则必须工具恢复并重新控制您的环境。  
  
## 构思方法  
*法律数字 8： 防御网络困难是直接与其复杂性成比例。* - [10 永恒的法律的安全管理](https://technet.microsoft.com/library/cc722488.aspx)  
  
它是通常广泛接受，如果攻击具有获取系统、 管理员、 根中或等效的访问权限的计算机的操作系统，无论该计算机可以不再被视为可信，无论多少努力"清理"系统。 Active Directory 并无不同。 如果攻击具有获得特权的访问域控制器或 Active Directory 中的某个特权的帐户，除非您有一条记录的攻击使每个修改或已知良好的备份，您可以永远不会恢复为目录完全可信状态。  
  
当成员服务器或工作站泄露且攻击被更改时，计算机不再可信，但相邻不折不扣的服务器和工作站 arecompromise 的一台计算机并不意味着所有计算机被都泄露。  
  
但是，在 Active Directory 域中，所有域控制器都驻留同一 AD DS 数据库的副本。 如果单个域控制器被泄露，攻击修改 AD DS 数据库，这些修改复制到每个其他域控制器的域中，根据在其中进行修改，林的分区。 即使您重新安装林中的每个域控制器，只需将重新安装 AD DS 数据库所处的主机。 对 Active Directory 恶意修改将轻松可以他们将复制到已运行年的域控制器复制到新安装的域控制器。  
  
在评估受损的环境，常用找到，哪些被认为是第一个违反"事件"实际触发后周、 月数或甚至数年攻击了最初破坏环境后。 攻击之前检测到存在的漏洞，和他们利用这些帐户危害目录、 域控制器、 成员服务器、 工作站，通常获取长特权帐户的凭据，并且即使连接非 Windows系统。  
  
这些发现符合 Verizon 的 2012年数据违反调查报表中，这表明的多个结果：  
  
-   98%的数据泄露是源自是从外部的代理  
  
-   85%的数据泄露最初周或更发现  
  
-   第三方，发现 92%的事件和  
  
-   虽然简单避免 97%的违规或中级控件。  
  
上文所述的角度危害是有效地不能修复，以及标准的建议，"平整和重建"每个受损的系统只是不是可行的情况下甚至可能如果泄露 Active Directory 或将其破坏。 即使还原到已知良好状态不会消除允许首先泄露环境缺陷。  
  
虽然必须保护您的基础结构的各个方面，攻击只需在您防御访问他们所需的目标中查找足够缺陷。 如果您的环境相对简单和原始，和过去易于管理，然后实施此文档的早期版本中提供的建议可能易懂。  
  
但是，我们发现的较旧、 较大，并更复杂环境中，很可能是不可行或甚至无法实现将此文档中的建议。 它是很难事后安全基础结构，大于其重新开始，并构造可防止攻击，损害环境。 但是，如上文所述，非常没有小型开展，来重建整个 Active Directory 林。 由于下列原因，我们建议更集中，针对目标的方式来保护 Active Directory 林。  
  
而不是将重点放在并尝试修复所有"断开"的内容，请考虑对您业务和基础结构中最重要的基于一种方法在其中您确定其优先顺序。 而不是尝试修正环境填入过时、 配置不正确的系统和应用程序，请考虑创建新的小型、 安全环境，将在其中您可以在安全端口用户、 系统和是最重要的信息您业务。  
  
在此部分中，我们将介绍依据的您可以创建充当"生活船"或"安全单元格"您的核心业务基础结构全新 AD DS 林方法。 全新林是只需新安装 Active Directory 林，通常有限的大小和范围，以及其生成通过使用当前的操作系统、 应用程序，并使用[中所述的原则减少 Active Directory 攻击曲面图](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)。  
  
通过在新生成林实施的推荐的配置设置，您可以创建从头开始构建向上实践、 安全设置与 AD DS 安装，并且可以减少伴随支持旧版系统的挑战和应用程序。 虽然设计和实施工作结束后的全新的 AD DS 安装的详细的说明此文档的范围之外，您应按照一些常规原则和创建"安全单元格"在其中可以容纳您最重要的准则资产。 这些准则如下所示：  
  
1.  确定用于分离和保护关键资产的原则。  
  
2.  定义有限、 基于风险的迁移计划。  
  
3.  如有必要，可以利用"nonmigratory"迁移。  
  
4.  实施"创意破坏"。  
  
5.  隔离旧系统和应用程序。  
  
6.  简化的最终用户的安全。  
  
### 分离和保护关键资产识别原则  

创建到房屋关键资产的原始环境的特征可以广泛有所不同。 例如，您可以选择创建全新林到其中迁移仅 VIP 用户和仅这些用户可以访问的敏感数据。 您可能会创建全新林将迁移不仅 VIP 用户，但您实现管理林，为实现[减小 Active Directory 攻击面](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)创建安全管理帐户中所述的原则并可用于从原始林管理您的旧林的托管。 您可能会实现托管 VIP 帐户、 特权的帐户和唯一的目标是从不太安全分离它们需要额外的安全，如服务器都运行 Active Directory 证书服务 （AD 客户服务） 的系统"专门"林林。 最后，您可能会实现成为所有新用户，系统、 应用程序和数据，事实上位置全新林允许您最终取消旧林通过人员取消了该域。  
  
无论是否全新林包含少量用户，并且系统或它所基于更严格的迁移，您应按照以下原则您规划中：  
  
1.  假设您的旧林有受损。  
  
2.  虽然您可以配置较旧的环境以信任全新林未配置信任旧版林，原始环境。  
  
3.  不会迁移用户帐户或组从旧林到原始环境时可能的帐户的组成员身份、 SID 历史记录或其他属性可能已被恶意修改。 相反，使用"nonmigratory"方法来填充全新林。 （nonmigratory 介绍了方法以后本部分中。）  
  
4.  不会迁移计算机从旧林到原始林。 在原始林实施刚安装的服务器、 刚安装服务器上安装应用程序和应用程序数据迁移到新安装系统。 对于文件服务器，将数据复制到新安装服务器，设置 Acl 使用新的林中用户和组，然后创建以类似的方式的打印服务器。  
  
5.  不允许安装旧的操作系统或应用程序中的原始林。 如果应用程序不能更新，并且新安装，将其保留在旧版林和考虑创意破坏来替换该应用程序的功能。  
  
### 定义有限、 基于风险的迁移计划  
创建受限，基于风险的迁移计划只需意味着当确定哪些用户、 应用程序和数据迁移到全新林，您应识别迁移目标基于如果一个向其公开您的组织的风险程度的用户或系统被泄露。 VIP 用户帐户的最有可能攻击应当放置在原始林。 应用程序提供重要业务职能应全新林中的新生成服务器上安装和高度敏感数据应移到受保护全新林的服务器。  
  
如果没有 Active Directory 环境中清除图片最为关键业务用户、 系统、 应用程序和数据，处理业务部门来标识它们。 应标识业务操作所需的任何应用程序，也应在其运行关键应用程序或关键数据存储任何服务器。 通过确定用户和资源所需的您的组织可以继续工作，您可以创建自然优先关注您的工作所依据的资产的集合。  
  
### 利用"Nonmigratory"迁移  
您是否知道，您的环境被泄露，怀疑它被泄露，或只需不希望旧数据和对象从旧 Active Directory 安装迁移到新帐户，请考虑技术上不执行的迁移方法"迁移"对象。  
  
### “用户帐户”  
在传统 Active Directory 迁移个林为另一种，在用户对象上的 SIDHistory （SID 历史） 属性用于存储用户的 SID 和用户是在旧版林的成员的组的 Sid。 如果用户帐户迁移到新的林，并且他们访问旧版林的资源，SID 历史记录中的 Sid 用于创建访问令牌，使用户可以访问的之前所具有的访问帐户已迁移的资源。  
  
维护 SID 历史记录，但是，证明某些环境中有问题因为填充与当前的和以往 Sid 的用户的访问令牌会导致令牌膨胀。 令牌膨胀 Sid，必须将存储在用户的访问令牌数使用哪个问题或超过令牌中可用空间量。  
  
虽然可以一定程度增加令牌大小，令牌膨胀的最终解决方案是减少通过合理化组成员身份，从而消除了 SID 历史记录或两者的组合的 Sid 与用户帐户相关联。 有关令牌膨胀的详细信息，请参阅[MaxTokenSize 和 Kerberos 令牌膨胀](http://blogs.technet.com/b/shanecothran/archive/2010/07/16/maxtokensize-and-kerberos-token-bloat.aspx)。  
  
而不是从旧环境迁移用户 （特别是其中的组成员身份和 SID 历史记录可能受到一个） 使用 SID 历史记录，请考虑利用元目录的应用程序"迁移"的用户，而不执行 SID 历史记录插入新林。 当在新林创建用户帐户时，您可以使用元目录的应用程序映射到旧林其相应帐户的帐户。  
  
提供新用户帐户访问旧版林的资源，您可以使用元目录工具来标识资源组用户的旧帐户已为其授予访问权限，并将用户的新帐户添加到这些组。 根据您在旧版林的组策略，您可能需要创建域访问资源的本地组或将现有组转换为域本地组，若要允许新帐户添加到资源组。 通过将重点放在最重要的应用程序和数据的第一次，并将它们迁移到新环境 （带或不 SID 历史记录），可以限制旧式环境中的工作量。  
  

  
### 服务器和工作站  
在从一个 Active Directory 传统迁移到另一个、 迁移计算机林通常是相对简单相比迁移用户、 组和应用程序。 根据计算机角色，迁移到新的林可以像脱离旧的域并加入一个新简单。 但是，迁移计算机帐户不变到原始林破坏了创建全新的环境的目的。 而不是迁移 （潜在受损、 配置不正确，或过期） 计算机帐户添加到新的林，则应刚刚安装服务器和工作站在新环境中。 该房屋数据从旧林以全新的林，系统中的系统，但不是系统迁移数据。  
  
### 应用程序  

应用程序可以显示最大的难题个林任何迁移到另一个，但对于"nonmigratory"迁移，您应该应用的最基本原则之一是支持全新林中的应用程序，应是最新，支持，以及新安装。 尽可能地，可以从应用程序实例中旧林迁移数据。 在其中一个应用程序不能"重新创建"中的原始林的情况下，应考虑如创意破坏或旧应用程序隔离的方法下, 一节中所述。  
  
### 实施创意破坏  
创造性破坏是描述由先前订单的破坏经济开发经济术语。 最近几年，该术语已应用了信息技术。 这通常是指机制通过消除了哪些旧基础结构，不能通过升级，但是替换完全新内容。 首席信息官和高级 IT 经理 2011 [Gartner 研讨会 ITXPO](http://www.gartner.com/technology/symposium/orlando/)呈现效率创意破坏作为降低成本和增加其关键主题之一。 为过程自然产物可能会出现在安全的改进。  

例如，组织可能组成多个业务部门使用不同的应用程序执行类似的功能，具有不同的 modernity 和供应商支持。 过去，IT 可能负责单独，维护每个业务部门应用程序和试图找出哪些应用程序提供的最佳功能，然后将数据迁移到的包含整合工作从其他应用程序。  
  
创造性破坏，而不是维护过时或多余的应用程序，您实施全新的应用程序，以替换旧，将数据迁移到新的应用程序，并取消旧应用程序和系统运行它们。 在某些情况下，您可以通过部署新的应用程序中您自己的基础结构，实现创意破坏旧应用程序，但尽可能，应考虑改为迁移到基于云的解决方案的应用程序。  
  
通过部署基于云的应用程序，以替换旧内部应用程序，那么不仅减少维护工作和成本，但减少消除旧式系统和应用程序演示漏洞您所在组织的攻击面利用的攻击。 此方法提供组织以同时同时消除旧版目标基础结构中的获取所需的功能更快的方法。 虽然创意破坏原则不适用于所有 IT 资产，它提供了与同时部署强大、 安全、 基于云的应用程序时清除旧系统和应用程序通常可行选项。  
  
### 隔离旧版系统和应用程序  
将您的关键业务用户和系统迁移到全新、 安全环境的自然产物是将包含旧版林，价值的信息和系统。 尽管旧系统和仍将保留在不太安全环境的应用程序可能存在提升的风险，他们也代表危害缩减的严重性。 通过将重新定位和 modernizing 关键业务资产，您可以专注于部署有效地管理和监视时不需要适应传统设置和协议。  
  
当已重新连接到原始林关键数据时，您可以计算值选项进一步隔离旧式系统和您的"主"AD DS 林中的应用程序。 虽然您可能会实现创意破坏来替换一个应用程序和运行它的服务器，可能会在其他情况下考虑附加隔离最不安全系统和应用程序。 例如，应用程序使用少量用户，但这需要可以将旧的凭据，如 LAN Manager 哈希迁移到较小的域创建支持的系统您有任何替换选项。  
  
通过这些系统删除它们强制实施工作结束后的旧设置的位置的域，随后可以通过将其配置为支持仅当前操作系统和应用程序中增加的域的安全性。 虽然最好停止使用旧系统和应用程序尽可能。 如果退役不只是为您的旧总体小型段可行的情况下，它分离到单独的域 （或林） 允许您执行传统安装的其余部分中的增量改进。  
  
### 简化的最终用户的安全  
在大多数组织，通常组织中有权访问其角色性质最重要的信息的用户具有最少的到用于学习复杂的访问限制和控件的时间量。 虽然您应在您的组织中有一个全面的安全教育计划，为所有用户，您应集中在制作为通过实施透明和简化原则向哪些用户的控制尽可能使用简单的安全遵循。  
  
例如，您可以定义的策略在其中管理人员和其他 Vip 使用所需安全工作站访问敏感数据和系统，从而使他们可以使用其其他设备访问敏感程度较低的数据。 这是一个简单的原则的用户，请记住，但您可以实现多个后端控件以帮助以实施方法。  

您可以使用[身份验证机制保证](https://technet.microsoft.com/library/dd391847(v=WS.10).aspx)允许用户访问敏感数据，只有当他们已登录到其安全系统使用智能卡，并且可以使用 IPsec 和用户权限限制来控制他们可以从中的系统连接到敏感数据存储库。 您可以使用[Microsoft 数据分类工具包](https://www.microsoft.com/download/details.aspx?id=27123)构建强大文件分类基础结构，并且可以实现对基于特征试图 access 数据访问限制的[动态访问控制](http://blogs.technet.com/b/windowsserver/archive/2012/05/22/introduction-to-windows-server-2012-dynamic-access-control.aspx)翻译技术控件中的业务规则。  
  
从用户的角度来看，访问安全系统"正常工作，"中的敏感数据，并尝试执行此操作不安全系统"只需不。" 但是，从监视和管理您的环境的角度来看，您正在帮助在用户如何访问敏感数据和系统，使您更轻松地检测异常访问尝试创建可识别的模式。  
  
在环境中的用户不易长、 复杂的密码导致不足密码策略，特别是对于 VIP 用户考虑替代方法向身份验证，是否通过智能卡 (其中有多个窗体因素和与其他功能来增强身份验证），生物控件，例如手指轻扫读者或受保护的一直身份验证数据受信任的平台模块 (TPM) 条中用户的计算机。 虽然多重身份验证不会阻止凭据盗用攻击如果计算机已泄露，即为您的用户可以轻松使用身份验证的控件，您可以分配更强大的密码的用户帐户为其传统用户控件名称和密码是不实用。  
