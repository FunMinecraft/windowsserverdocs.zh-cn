---
ms.assetid: 77aa61bf-9c04-4889-a5d2-6f45bc1b8bd2
title: "何时使用转换索赔规则"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c7b7ea2c8d9a08a4cbf6c89c2de2482043efe25b
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/12/2017
---
>适用于：Windows Server 2016，Windows Server 2012 R2、Windows Server 2012

# <a name="when-to-use-a-transform-claim-rule"></a>何时使用转换索赔规则
在你需要将映射到传出的索赔类型传入的索赔类型，然后应用将确定哪些输出应该会根据来源传入声明中的值操作时，你可以使用 Active Directory 联合身份验证服务 \(AD FS\) 中此规则。 当你使用此规则时，你将通过或转换匹配以下规则逻辑，根据你在规则中，将配置选项之一下, 表中所述的索赔。  
  
|规则选项|规则逻辑|  
|---------------|--------------|  
|通过传入的所有声明|如果传入索赔类型等于*指定索赔类型*和值等*任意值*，然后将通过与传出索赔类型等索赔传递*指定索赔类型*|  
|使用不同的传出声明值替换传入的索赔值|如果接收的索赔类型等于*指定索赔类型*和重视等*指定声明值*，然后转换与传出新的声明值索赔*指定声明值*与传出声称类型和*指定索赔类型*|  
|使用新的 e\ 邮件职务替换传入 e\ 邮件职务声明|如果接收的索赔类型等于*指定索赔类型*和重视等*任何后缀值*，然后转换与传出新的声明值索赔*指定职务值*与传出声称类型和*指定索赔类型*|  
  
以下部分提供了基本的介绍声称规则，并提供有关何时可以使用此规则的更多详细信息。  
  
## <a name="about-claim-rules"></a>有关索赔规则  
索赔规则表示企业逻辑，将需要传入的索赔，到该应用条件实例 \（如果然后 y\ x）和产生传出声明条件参数而异。 以下列表轮廓重要阅读进一步之前，你应该提前了解的提示声称规则本主题中：  
  
-   在 snap\ 中广告 FS 管理索赔规则只能创建使用索赔规则模板  
  
-   索赔规则进程传入索赔直接从索赔提供商 \（如 Active Directory 或其他联盟 Service\）或的输出中验收转换上索赔提供商信任规则。  
  
-   索赔规则处理给定的规则组内的时间顺序索赔颁发引擎。 通过在规则设置优先级，可以进一步优化或筛选将生成一给定的规则组中的以前规则的索赔。  
  
-   索赔规则模板将始终需要你指定传入的索赔类型。 但是，你可以使用相同的索赔类型使用单个规则处理多个索赔值。  
  
有关详细信息索赔规则和索赔规则集，请参阅[声称规则的角色](The-Role-of-Claim-Rules.md)。 有关如何处理规则的详细信息，请参阅[的索赔引擎角色](The-Role-of-the-Claims-Engine.md)。 如何处理声明规则集的详细信息，请参阅[的索赔管道角色](The-Role-of-the-Claims-Pipeline.md)。  
  
## <a name="pass-through-all-claim-values"></a>通过所有索赔值  
使用此操作时，会根据指定传入的索赔类型的所有传入的索赔值映射到指定传出索赔类型发送作为传出索赔成令牌签名联合身份验证服务通过之前。  
  
例如，规则设置与**传递所有声明值**选项逻辑和传入声称组的键入和指定传出索赔类型的角色是，从发行商流中的所有传入的索赔值复制到新的角色索赔类型的传出索赔单独。  
  
## <a name="transforming-a-claim"></a>转换索赔  
广告 FS，术语*索赔转换*意味着替换一个传入声称有不同的传出索赔值。 它是转换使此函数传入声明规则。 在此规则的属性，你可以设置情况，若要将根据指定传入的索赔类型不同传出索赔值传入值。  
  
例如中, 所示下图中，规则设置的条件，若要使用不同的传出声明值替换传入的值时，所有传入的索赔类型的组映射到新的角色传出的索赔类型。 在此情况下，将传入的索赔值的购买者将替换为新传出索赔值的管理员。  
  
![何时使用转换](media/adfs2_transform.gif)  
  
你还可以使用此规则应用条件，将使用新值指定的 e\ 邮件职务值替换传入的所有声明。 例如，你无法在此规则若要更改对 fabrikam.com 的所有声明值与的 sales.corp.fabrikam.com 职务设置一个条件。  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>配置上的索赔提供商信任此规则  
当你使用的索赔提供商信任时，可配置此规则转换可靠等效传入索赔提供商的索赔。 声称类型或声称值在比在索赔提供商组织你的组织有不同的含义。 你可以使用此规则标准化的索赔类型和来自索赔提供商，以便它们传出索赔等效可以依赖方理解的值。  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>在信赖的方信任配置此规则  
当你使用信赖的方信任时，可配置此规则转换特定依赖方提起的索赔。 声称类型或声称值可能会有不同的含义特定依赖方，并且此规则就可以让你更改单个信赖方传出索赔类型和值。  
  
## <a name="how-to-create-this-rule"></a>如何创建此规则  
创建使用索赔规则语言或使用此规则**转换传入声称**规则 snap\ 中广告 FS 管理模板。 此规则模板提供以下配置选项：  
  
-   指定声明规则名称  
  
-   转换为指定传出索赔类型特定传入索赔类型  
  
-   通过所有索赔值  
  
-   使用不同的传出声明值替换传入的索赔值  
  
-   使用新的 e\ 邮件职务替换传入 e\ 邮件职务声明  
  
有关如何创建此模板相关说明进行操作，请参阅[创建规则转换传入声明](https://technet.microsoft.com/library/dd807068.aspx)广告 FS 部署指南中。  
  
## <a name="using-the-claim-rule-language"></a>使用索赔规则语言  
如果传出声明必须构造从多个传入的声明的内容，你必须改为使用自定义规则。 如果传出声明的索赔值必须基于传入声明的值，但其他内容，您还必须使用自定义规则该上下文中。 有关详细信息，请参阅[何时使用自定义索赔规则](When-to-Use-a-Custom-Claim-Rule.md)。  
  
### <a name="examples-of-how-to-construct-a-transform-rule-syntax"></a>有关如何构建转换规则语法的示例  
当使用索赔规则语言语法转换索赔，你可以设置为新的文本值转换声明的属性。 例如，以下规则的值的角色索赔从变为"管理员""根"时，保持同一索赔类型：  
  
```  
c:[type == “https://schemas.microsoft.com/ws/2008/06/identity/claims/role”, value == “Administrators”]  => issue(type = c.type, value = “root”);  
```  
  
常规表情还可以用于索赔转换。 例如，以下规则将设置的域，windows 用户名称索赔域 \\ 格式 FABRIKAM 到中：  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => issue(type = c.type, value = regexreplace(c.value, "(?<domain>[^\\]+)\\(?<user>.+)", "FABRIKAM\${user}"));  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>创建自定义规则的最佳实践  
可以选择使用基本筛选功能的索赔均选择性应用索赔转换。 每个用于筛选索赔属性可以分配值，使用以下几点注意事项：  
  
|声称属性|描述|  
|------------------|---------------|  
|类型，值，值|将最常使用这些属性的分配。 在至少类型和值必须指定的结果转换后的索赔。|  
|发行商|虽然索赔规则语言允许设置发行商，这通常是索赔的不建议。 令牌中并非序列的索赔发行商。 当收到一个标记的所有声明的发行商属性设置为登录令牌联盟服务器的标识符。 因此，规则中设置的索赔发行商不会影响令牌内容和设置都将丢失后索赔打包在一个标记。 位置设置发行商的话有意义的唯一方案是索赔的如果其设置为在索赔提供商规则集和集编写参考此特定值的规则信赖方规则特定值。 如果发行商属性不显式设置为在索赔规则索赔颁发引擎将其设置为"本地机构"的值。|  
|OriginalIssuer|同样到发行商，OriginalIssuer 通常不应将明确分配值。 与不同的发行商，OriginalIssuer 属性序列中令牌，但令牌客户期望是，如果设置，它将包含在最初发布索赔联盟服务器的标识符。|  
|属性|如上文所述，属性包的索赔不是保留在令牌，以便分配到属性才应如果后续本地策略打算参考属性中存储的信息。|  
  
有关如何使用索赔规则语言的详细信息，请参阅[声称规则语言的角色](The-Role-of-the-Claim-Rule-Language.md)。  
  

