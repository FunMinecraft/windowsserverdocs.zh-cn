---
ms.assetid: 8b15d44e-e4e6-4510-aa91-cc7ec7161b0a
title: "角色的索赔引擎"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 930b6f8034f17d8902104419042f944b82e90b4f
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/03/2017
---
>适用于：Windows Server 2016，Windows Server 2012 R2、Windows Server 2012

# <a name="the-role-of-the-claims-engine"></a>角色的索赔引擎
在其最高级别中的 Active Directory 联合身份验证服务 \(AD FS\) 的索赔引擎是基于 rule\ 引擎，致力于提供服务和联合身份验证服务用于处理索赔请求。 索赔引擎是负责执行每个规则集中运行的所有联合的信任与您的关系你已经将配置并的输出结果交给索赔管道联合身份验证服务内的自行实体。  
  
更多的逻辑概念索赔管道时金绿色的叶 to\ end\ 端过程索赔，索赔规则是你可以使用索赔规则执行过程自定义的索赔流实际管理元素。 有关管道进程的详细信息，请参阅[的索赔管道角色](The-Role-of-the-Claims-Pipeline.md)。  
  
下图中，接受传入索赔 \(acceptance rules\) 的操作所示授权索赔申请者 \(authorization rules\) 并发出传出通过跨所有中你的组织的联合的信任关系索赔规则 \(issuance rules\) 由索赔引擎的索赔。  
  
![广告 FS 角色](media/adfs2_enginepipeline.gif)  
  
## <a name="claim-rules-execution-process"></a>声称规则执行过程  
配置时的索赔提供商信任或依赖方信任在你的组织索赔规则，该信任法案索赔规则 set\(s\) 作为为传入的索赔网关守卫通过调用的索赔引擎应用中的索赔规则，以确定是否处理任何索赔，并处理的索赔必要的逻辑。  
  
以下部分中列出了每个由引擎时发生的索赔完成索赔规则执行过程流程的步骤。 每个步骤如下所述发生的索赔管道过程中所述的每个阶段。 这些步骤：  
  
-   第 1 步-初始化  
  
-   第 2 步 – 执行  
  
-   第 3 步-执行结果  
  
有关管道进程的详细信息，请参阅[的索赔管道角色](The-Role-of-the-Claims-Pipeline.md)。  
  
### <a name="step-1--initialization"></a>第 1 步-初始化  
在索赔规则执行过程的第一步，索赔引擎传入的索赔接受首添加到*输入声称组*。 输入的声明设置是用于只要所需的过程需要该数据以供检索暂时存储数据的内存中的缓存类似。 输入的声明集规则执行完成后，会丢失数据。  
  
#### <a name="adding-a-claim-to-the-input-claim-set-for-a-rule-set"></a>添加到输入设置为规则集声明索赔  
在需要时，该进程与索赔规则集关联的逻辑临时内存中存储索赔数据时，声明引擎被创建输入的声明设置。 索赔引擎复制到其中他们可以通过第一个规则规则集中检索输入的声明集中传入的索赔的所有。  
  
例如，在下图索赔引擎读取 A 的索赔来自传入 B 索赔，并将其复制到输入的声明设置。 它们位于输入的声明设置后，索赔引擎检索并处理作为第一个规则索赔规则集中中的逻辑的输入一个和 B 索赔。  
  
![广告 FS 角色](media/adfs2_context1.gif)  
  
索赔规则组中的所有规则都共享相同输入的声明组。 每个规则，该组中的可以共享输入的声明组中，从而影响的设置中的所有后续规则添加。  
  
### <a name="step-2--execution"></a>第 2 步 – 执行  
在这一步索赔规则过程中，当索赔引擎时间顺序逐步所有集中特定规则一个规则一次处理索赔规则。 仅规则组内的每个规则运行一次，并在其中它们显示在从上到下广告 FS 管理 snap\ 中的编辑索赔规则对话框中显示的顺序执行。 首先处理规则顶部设置索赔规则，并且之前已运行的所有规则然后处理后续规则。  
  
索赔规则定义索赔规则语言，包括两个部分，条件和颁发的隐私声明。 输入中使用的数据的条件部分声称设置，以确定是否规则中指定的条件适用于索赔输入中包含的索赔引擎第一个进程声称组 \（匹配规则条件索赔称为匹配 claims\）。 如果发现任何匹配的索赔，索赔引擎执行发行的每个套匹配的索赔规则的声明。 规则颁发语句可以执行以下任务与匹配的索赔之一：  
  
1.  将匹配的索赔复制到输出索赔设置  
  
2.  转换索赔字段中输入的声明集创建新的天空或评估和输出中声称集。  
  
3.  使用一个键作为匹配 claim\(s\) 查找从特性官方商城，只需输入的声明组中创建新 claim\(s\) 或在输入并输出声称设置的详细信息。  
  
#### <a name="adding-a-claim-to-the-output-claim-set-for-a-rule-set"></a>添加到输出声明设置为规则集索赔  
*输出声明组*是初始为空和很重要，因为索赔引擎将仅返回位于输出索赔，执行过程完成后，设置的索赔的内存中的位置。 这意味着，仅位于输入声明任何索赔设置，并不在输出索赔集时，将忽略涉及计算传出声明的最终设置的时间。  
  
#### <a name="adding-a-claim-to-both-claim-sets-for-a-rule-set"></a>添加到这两个声明集索赔规则集  
处理规则，索赔是任何输入中添加了一个声称设置或在这两个输入声称集和输出声明的使用规则颁发声明中所基于的索赔集。 索赔规则语言指为这些明细表*添加*或*问题*。  
  
如果*添加*用于声明，索赔将添加到输入的声明集和索赔将仅用于执行的目的存在和存在执行完毕后将停止。 如果*问题*用于声明，索赔将被添加到输入的声明集和输出索赔集并中输出索赔设置执行完毕后，返回索赔。 有关这些声明的详细信息，请参阅[索赔规则语言的角色](The-Role-of-the-Claim-Rule-Language.md)。  
  
如果规则规则组中的条件部分不符输入的声明集中任何索赔，规则的颁发声明一部分将忽略，并没有索赔因此添加输出索赔集还是向输入的声明组。 下图和相应步骤显示索赔引擎执行转换规则会发生什么情况：  
  
![广告 FS 角色](media/adfs2_context2.gif)  
  
1.  传入声明将添加到输入设置索赔引擎的索赔。  
  
2.  在执行第一个规则时，它将看到一个和 B 索赔，将输入中唯一的索赔声称设置的时间在此时，，并处理规则逻辑规则 1 中的条件的一部分。  
  
3.  由于存在输入的声明集中 A 索赔，则确定规则的条件为 true \（匹配索赔 A\），并将新的 C 天空添加到这两个输入声称集和输出声称设置。  
  
4.  现在，一个、B 和 C 索赔可以使用规则 2 \（输入中的所有声明都声称 set\）作为用于处理其逻辑输入。  
  
有关索赔转换的详细信息，请参阅[何时使用转换索赔规则](When-to-Use-a-Transform-Claim-Rule.md)。  
  
### <a name="step-3--execution-result"></a>第 3 步-执行结果  
执行索赔规则集最后阶段开始后给定的规则集中已运行的所有规则，并且最终的索赔集输出索赔集中。 此时，索赔引擎返回输出声明设置为执行规则集输出的上下文。 从该点前进是索赔管道接管并移动到下一个阶段其进程此最终输出。  
  
## <a name="sending-the-execution-output-to-the-claims-pipeline"></a>发送到索赔管道执行输出  
当索赔引擎进程规则将设置，规则集都有它自己的其输入的内存中的专用的位置，以及输出声称集。 这意味着输入和输出声称集使用规则一集分开输入，输出声明的使用规则的另一组中的设置。  
  
为使规则集运行整个过程后 \（步骤 1、2 和 3\）新颁发传出索赔 \（输出索赔 set\ 的内容）将用作到下一步规则集索赔管道中输入。 这样排从设置另一规则组中，输入一个规则的输出中，在下图所示的索赔。  
  
![广告 FS 角色](media/adfs2_enginecontexts.gif)  
  
> [!NOTE]  
> 虽然颁发规则集也是关键管道中的阶段上, 图中不显示它仅供简化图。 图中显示颁发规则设置以及如何适应索赔管道的请参阅[的索赔管道角色](The-Role-of-the-Claims-Pipeline.md)。  
  
在此情况下，管道使用验收规则的输出以 flow 索赔产生验收规则到第二个阶段管道，是处理授权规则中的最后一组。 此时，整个声称规则执行过程 \ (步骤 1、2、3 above\) 就会为授权规则集再次运行。 此周期将一直颁发规则设置 \ 完成后（pipeline\ 最后阶段）。  
  
后最终的传出索赔从颁发规则集引擎，它们将打包到一个 SAML 标记，并联合身份验证服务将发送给客户的标记。  
  
## <a name="processing-authorization-rules"></a>处理授权规则  
如果正在执行的索赔规则执行过程第 2 步索赔规则集包含授权规则 \（其中有不同的输入和输出声称比验收或颁发 rules\ 集），然后将执行这些授权规则，以确定令牌申请者是否有权获取安全标记，从联合身份验证服务给定信赖方根据申请者的索赔。  
  
授权规则的目标是发出许可证或拒绝根据用户是否有权获取令牌给定依赖方或不的索赔。 下图所示的授权执行输出用于管道确定颁发规则集或不执行后，基于是否存在允许和之间 / 或拒绝索赔，但授权执行输出本身不用作索赔规则集输入。  
  
![广告 FS 角色](media/adfs2_authorization.gif)  
  
有关索赔授权的详细信息，请参阅[何时使用授权索赔规则](When-to-Use-an-Authorization-Claim-Rule.md)。  
  

