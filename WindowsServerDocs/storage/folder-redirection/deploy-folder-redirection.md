---
title: 部署使用脱机文件的文件夹重定向
description: 如何使用 Windows Server 部署使用脱机文件的文件夹重定向到 Windows 客户端计算机。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 33942db34314e0ff60b24d4b9c8e5e33b4ca92fd
ms.sourcegitcommit: 5549ac178f8f3d116e88761a95223063a636ac94
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/04/2018
ms.locfileid: "4376617"
---
# 部署使用脱机文件的文件夹重定向

>适用于： Windows 10，Windows 7，Windows 8、 Windows 8.1、 Windows Server 2008 R2、 Windows Server 2012、 Windows Server 2012 R2，Windows Server 2016 中，Windows Vista

本主题介绍了如何使用 Windows Server 部署使用脱机文件的文件夹重定向到 Windows 客户端计算机。

本主题的最新更改的列表，请参阅[更改历史记录](#change-history)。

>[!IMPORTANT]
>由于[MS16 072](https://support.microsoft.com/en-us/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)中所做的安全更改，我们已更新[步骤 3： 为文件夹重定向创建一个 GPO](#step-3:-create-a-gpo-for-folder-redirection)本主题以便 Windows 可以正确应用文件夹重定向策略 （并且不恢复受影响的电脑上重定向的文件夹）。

## 必备条件

### 硬件要求

文件夹重定向需要基于 x86 或基于 x64 的计算机，则不受 Windows® 直角

### 软件要求

文件夹重定向具有以下软件要求：

- 管理文件夹重定向，你必须为域管理员安全组，企业管理员安全组或组策略创建者所有者安全组的成员身份登录。
- 客户端计算机必须运行 Windows 10、 Windows 8.1、 8、 Windows 7、 Windows Server 2012 R2、 Windows Server 2012、 Windows Server 2008 R2 或 Windows Server 2008。
- 必须将客户端计算机加入到 Active Directory 域服务 (AD DS) 所管理。
- 计算机必须是适用于组策略管理和安装 Active Directory 管理中心。
- 文件服务器必须可用于托管重定向的文件夹。
    - 如果文件共享使用 DFS 命名空间，DFS 文件夹 （链接） 必须具有单个目标以阻止用户在不同服务器上进行冲突编辑。
    - 如果文件共享使用 DFS 复制复制与另一台服务器内容，用户必须能够访问仅在源服务器以阻止用户在不同服务器上进行冲突编辑。
    - 当使用群集的文件共享，请禁用要避免文件夹重定向和脱机文件的性能问题的文件共享上的连续可用性。 此外，脱机文件可能不会转换到脱机模式 3 到 6 分钟后用户失去对持续可用文件共享，这可能失望尚不使用脱机文件始终脱机模式的用户的访问。

>[!NOTE]
>在文件夹重定向某些较新功能有其他客户端计算机和 Active Directory 架构要求。 有关详细信息，请参阅[部署主计算机](deploy-primary-computers.md)、[脱机禁用对文件夹的文件](disable-offline-files-on-folders.md)、[启用始终脱机模式](enable-always-offline.md)，并[启用优化的文件夹移动](enable-optimized-moving.md)。

## 步骤 1： 创建文件夹重定向安全组

如果你的环境不已设置有文件夹重定向，第一步是创建一个包含你想要将文件夹重定向策略设置应用的所有用户的安全组。

下面介绍了如何为文件夹重定向创建安全组：

1. 打开服务器管理器的计算机上使用 Active Directory 管理中心安装。
2. 在**工具**菜单中，选择**Active Directory 管理中心**。 此时将出现 Active Directory 管理中心。
3. 右键单击相应的域或 OU 中，选择**新建**，然后选择**组**。
4. 在**创建组**窗口的**组**部分，指定以下设置：
    - 在**组名称**，例如键入安全组的名称：**文件夹重定向用户**。
    - 在**组作用域**中，选择**安全**，，然后选择**全局**。
5. 在**成员**部分中，选择**添加**。 此时将出现“选择用户、联系人、计算机、服务帐户或组”对话框。
6. 键入用户或你想要部署文件夹重定向、 选择**确定**，然后再次选择**确定**的组的名称。

## 步骤 2： 创建重定向的文件夹的文件共享

如果你还没有重定向的文件夹的文件共享，使用以下过程在运行 Windows Server 2012 的服务器上创建的文件共享。

>[!NOTE]
>某些功能可能有何不同，或如果你运行另一版本的 Windows Server 的服务器上创建文件共享不可用。

下面介绍了如何在 Windows Server 2012 和 Windows Server 2016 上创建的文件共享：

1. 在服务器管理器导航窗格中，选择**文件和存储服务**，然后选择**共享**，以显示共享页面。
2. **共享**磁贴中，选择**任务**，然后选择**新共享**。 此时将出现新的共享向导。
3. 在**选择配置文件**页上，选择**SMB 共享 – 快速**。 如果你安装的文件服务器资源管理器，并将使用文件夹管理属性，改为选择**SMB 共享的高级**。
4. 在**共享位置**页上，选择你要在其上创建共享的服务器和卷。
5. **共享名称**在页面上，在**共享名称**框中键入共享 （例如，**用户 $**） 的名称。
    >[!TIP]
    >创建共享时，通过将隐藏共享```$```共享名称后。 这将隐藏普通浏览器中的共享。
6. 在**其他设置**页面上清除启用连续可用性复选框时，如果存在，并 （可选） 选中**启用基于访问的枚举**和**加密数据的访问权限**复选框。
7. 在**权限**页上选择**自定义权限...**。 显示高级安全设置对话框。
8. 选择**禁用继承**，，然后选择**转换继承的权限到此对象上显式权限**。
9. 根据所述的表 1 和显示在图 1 中，删除权限未列出的组和帐户，并将特殊权限添加到你在步骤 1 中创建的文件夹重定向用户组设置权限。
    
    ![设置的重定向的文件夹共享的权限](media/deploy-folder-redirection/setting-the-permissions-for-the-redirected-folders-share.png)
    
    **图 1**设置的重定向的文件夹共享的权限
10. 如果你选择的**SMB 共享的高级**配置文件中，在**管理属性**页面中，选择**用户文件**文件夹的使用值。
11. 如果你选择的**SMB 共享的高级**配置文件，在**配额**页上，或者也可以选择要应用于在共享的用户的配额。
12. 在**确认**页面上选择**创建。**

### 所需的权限的文件共享托管重定向的文件夹

<table>
<tbody>
<tr class="odd">
<td>用户帐户</td>
<td>Access</td>
<td>适用范围</td>
</tr>
<tr class="even">
<td>系统</td>
<td>完全控制</td>
<td>此文件夹、 子文件夹和文件</td>
</tr>
<tr class="odd">
<td>管理员</td>
<td>完全控制</td>
<td>仅此文件夹</td>
</tr>
<tr class="even">
<td>创建者/所有者</td>
<td>完全控制</td>
<td>子文件夹和文件仅</td>
</tr>
<tr class="odd">
<td>无需将数据放在共享 （文件夹重定向用户） 的用户的安全组</td>
<td>列出文件夹 / 读取数据<sup>1</sup><br />
<br />
创建文件夹 / 附加数据<sup>1</sup><br />
<br />
读取属性<sup>1</sup><br />
<br />
读取扩展属性<sup>1</sup><br />
<br />
读取权限<sup>1</sup></td>
<td>仅此文件夹</td>
</tr>
<tr class="even">
<td>其他组和帐户</td>
<td>无 （删除）</td>
<td></td>
</tr>
</tbody>
</table>

1 高级的权限

## 步骤 3： 为文件夹重定向创建 GPO

如果你还没有为文件夹重定向设置创建 GPO，使用以下过程中创建一个。

下面介绍了如何创建的文件夹重定向的 GPO:

1. 打开服务器管理器的计算机上使用组策略管理安装。
2. 从**工具**菜单中，选择**组策略管理**。
3. 右键单击域或 OU 你想要设置文件夹重定向，然后选择**创建在这个域中的 GPO 并在此处链接**。
4. 在**新建 GPO**对话框中，键入 （例如，**文件夹重定向设置**），将 GPO 的名称，然后选择**确定**。
5. 右键单击新创建的 GPO，然后清除**启用链接**复选框。 这可以防止 GPO 应用直到你完成对其进行配置。
6. 选择的 GPO。 在**范围**选项卡的**安全筛选**部分中，选择**已验证用户**，然后选择**删除**以防止 GPO 向所有人提供应用。
7. 在**安全筛选**部分中，选择**添加**。
8. 在**选择用户、 计算机或组**对话框中，键入你在步骤 1 （例如，**文件夹重定向用户**） 中创建安全组的名称，然后选择**确定**。
9. 选择**委派**选项卡，选择**添加**、 键入**已验证用户**、 选择**确定**，然后依次选择**确定**再次以接受默认读取权限。
    
    此步骤是必需由于安全在[MS16 072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)所做的更改。

>[!IMPORTANT]
>由于[MS16 072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)，你现在中所做的更改必须为提供的安全经过身份验证用户组委派到文件夹重定向 GPO 的读取权限-GPO 否则不会获取应用到用户，或如果已应用，将 GPO 被删除，重定向返回到本地电脑的文件夹。 有关详细信息，请参阅[部署组策略安全更新 MS16-072](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/)。

## 步骤 4： 配置与脱机文件的文件夹重定向

创建后文件夹重定向设置的 GPO，编辑组策略设置以启用和配置文件夹重定向，如以下过程中所述。

>[!NOTE]
>脱机文件是重定向的文件夹，Windows 客户端计算机上的默认启用和禁用运行 Windows Server 的计算机上，除非用户更改。 若要使用组策略控制是否启用了脱机文件，请使用**允许或禁止使用脱机文件功能**策略设置。
> 有关一些其他的脱机文件组策略设置的信息，请参阅[启用高级脱机文件功能](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn270369(v%3dws.11)>)，并[将组策略配置为脱机文件](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc759721(v%3dws.10)>)。

下面介绍了如何配置组策略中的文件夹重定向：

1. 在组策略管理中，右键单击你创建 （例如**文件夹重定向设置**），将 GPO，然后选择**编辑**。
2. 在组策略管理编辑器窗口中，导航到**用户配置**，则**策略**，然后**Windows 设置**，然后**文件夹重定向**。
3. 右键单击你想要重定向 （例如**文档**），然后选择**属性**的文件夹。
4. 在**属性**对话框中，从**设置**框中，选择**基本-将重定向到同一个位置的每个人的文件夹**。

    > [!NOTE]
    > 若要应用到运行 Windows XP 或 Windows Server 2003 的客户端计算机的文件夹重定向，选择**设置**选项卡，选择**还应用重定向策略对 Windows 2000、 Windows 2000 Server、 Windows XP 和 Windows Server 2003 操作系统系统**复选框。
5. 在**目标文件夹位置**部分中，选择**为每个用户的根路径下创建一个文件夹**，然后在**根路径**框中，键入存储重定向的文件夹，例如文件共享路径： **\\\fs1.corp.contoso.com\\用户 $**
6. 选择**设置**选项卡，然后在**策略删除**部分中，（可选） 选择**重定向回本地用户配置文件位置时该策略被删除的文件夹**（此设置可帮助文件夹重定向行为的详细信息如预期大幅适用于 adminisitrators 和用户）。
7. 选择**确定**，然后在警告对话框中选择**是**。

## 步骤 5： 启用文件夹重定向 GPO

完成配置的文件夹重定向组策略设置后下, 一步是启用 GPO，允许它应用到受影响的用户。

>[!TIP]
>如果你计划实现主计算机支持或其他策略设置，这样做现在，然后再启用 GPO。 这可以防止用户数据复制到非主计算机前主计算机支持处于启用状态。

下面介绍了如何启用文件夹重定向 GPO:

1. 打开组策略管理。
2. 右键单击你创建的 GPO，然后选择**启用链接**。 菜单项旁都将显示一个复选框。

## 步骤 6： 测试文件夹重定向

若要测试文件夹重定向，登录到计算机的文件夹重定向配置一个用户帐户。 然后确认重定向的文件夹和配置文件。

下面介绍了如何测试文件夹重定向：

1. 登录到主计算机 （如果你启用主计算机支持），你已为其启用文件夹重定向一个用户帐户。
2. 如果用户已之前登录到计算机，打开一个提升的命令提示符，然后键入以下命令以确保最新的组策略设置应用到客户端计算机：
    
    ```PowerShell
    gpupdate /force
    ```
3. 打开文件资源管理器。
4. 右键单击重定向的文件夹 （例如，我文档文件夹的文档库中），然后选择**属性**。
5. 选择**位置**选项卡，并确认路径显示而不是本地路径指定的文件共享。

## 附录 a： 用于将部署文件夹重定向的清单

|状态|操作|
|:---:|---|
|☐<br>☐<br>☐|1.准备域<br>-将计算机加入到域<br>-创建用户帐户|
|☐<br><br><br>|2.创建安全组的文件夹重定向<br>组名称：<br>-成员：|
|☐<br><br>|3.创建重定向的文件夹的文件共享<br>-文件共享名称：|
|☐<br><br>|4.为文件夹重定向创建 GPO<br>-GPO 名称：|
|☐<br><br>☐<br>☐<br>☐<br>☐<br>☐|5.配置文件夹重定向和脱机文件策略设置<br>-重定向的文件夹：<br>Windows 2000、 Windows XP 和 Windows Server 2003 支持启用？<br>启用脱机文件？ （默认情况下，Windows 客户端计算机上启用）<br>-已启用始终脱机模式？<br>启用后台文件同步？<br>优化移动的重定向的文件夹启用？|
|☐<br><br>☐<br><br>☐<br>☐|6.（可选） 启用主计算机支持<br>基于用户或计算机基于的？<br>-指定用户的主的计算机<br>-位置的用户和主计算机映射：<br>-（可选） 启用文件夹重定向的主计算机支持<br>-为漫游用户配置文件 （可选） 的启用主计算机支持|
|☐|7.启用文件夹重定向 GPO|
|☐|8.测试文件夹重定向|

## 更改历史记录

下表总结了一些与本主题最重要的更改。

|日期|描述|原因|
|---|---|---|
|2017 年 1 月 18日，|添加到步骤[步骤 3： 为文件夹重定向创建一个 GPO](#step-3:-create-a-gpo-for-folder-redirection)将读取权限委派给已经过身份验证的用户，它现在是由于组策略安全更新所需。|客户反馈。|

## 详细信息

* [文件夹重定向、脱机文件和漫游用户配置文件](folder-redirection-rup-overview.md)
* [部署主计算机的文件夹重定向和漫游用户配置文件](deploy-primary-computers.md)
* [启用高级脱机文件功能](enable-always-offline.md)
* [解决复制的用户配置文件数据的 Microsoft 的支持声明](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
* [使用 DISM 旁加载应用](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
* [疑难解答打包、 部署和基于 Windows 运行时应用的查询](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)