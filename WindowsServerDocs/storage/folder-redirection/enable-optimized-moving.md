---
title: 启用优化的移动的重定向的文件夹
description: 如何执行重定向的文件夹优化的移动到新的文件共享。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 09/10/2018
ms.localizationpriority: medium
ms.openlocfilehash: 98fd5d50645ad454204dcf9dabf58e97c246ab1a
ms.sourcegitcommit: 505505b7ec99506e7ff50eddbdd6aa94a602abe6
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/11/2018
ms.locfileid: "3831377"
---
# 启用优化的移动的重定向的文件夹

>适用于： Windows 10，Windows 8、 Windows 8.1、 Windows Server 2012、 Windows Server 2012 R2，Windows Server 2016

本主题介绍了如何执行重定向的文件夹 （文件夹重定向） 优化的移动到新的文件共享。 如果启用此策略设置，当管理员将移动托管重定向的文件夹的文件共享并更新组策略中重定向的文件夹的目标路径，而无需任何延迟本地的脱机文件缓存中将只缓存的内容被重命名或用户的潜在数据丢失。

以前，管理员可以更改组策略和让客户端计算机将受影响的用户下次登录时，文件复制中重定向的文件夹的目标路径导致延迟的登录。 或者，管理员可以移动的文件共享和更新的组策略中重定向的文件夹的目标路径。 但是，任何所做的更改本地之间移动的开始菜单和第一个同步客户端计算机上移动之后将会丢失。

## 必备条件

优化的移动具有以下要求：

- 文件夹重定向，必须先设置。 有关详细信息，请参阅[部署脱机文件的文件夹重定向](deploy-folder-redirection.md)。
- 客户端计算机必须运行 Windows 10、 Windows 8.1、 8、 Windows Server 2016、 Windows Server 2012 R2 或 Windows Server 2012。

## 步骤 1： 启用优化组策略中的移动

若要优化的文件夹重定向数据重新定位，使用组策略启用**启用优化移动在文件夹重定向服务器路径更改的脱机文件缓存中的内容的**策略设置为相应的组策略对象 (GPO)。 配置为**已禁用**或**未配置**此策略设置，则会导致客户端将文件夹重定向的所有内容都复制到新位置，然后将内容从旧位置删除，如果服务器路径更改。

下面介绍了如何启用优化移动重定向的文件夹：

1. 在组策略管理，右键单击你为文件夹重定向设置 （例如，**文件夹重定向和漫游用户配置文件设置**），创建，然后选择**编辑**GPO。
2. 在**用户配置**中，导航到**策略**，然后**管理模板**，然后**系统**，然后**文件夹重定向**。
3. **启用优化在文件夹重定向服务器路径更改的脱机文件缓存中的内容的移动**，右键单击，然后选择**编辑**。
4. 选择**已启用**，，然后选择**确定**。

## 步骤 2： 重新定位重定向的文件夹的文件共享

如果移动包含用户的文件共享重定向文件夹，则导入采取措施来确保文件夹会正确重定位。

>[!IMPORTANT]
>如果用户的文件中使用或通过网络，生成的脱机文件或甚至数据丢失的同步冲突复制文件的完整文件状态不会保留在移动，如果用户可能会遇到性能不佳。

1. 提前通知用户，承载它们重定向的文件夹的服务器将更改和建议它们执行以下操作：

      - 同步其脱机文件缓存的内容，并解决任何冲突。
      - 打开提升的命令提示符、 输入**GpUpdate /Target:User /Force**，然后注销并重新登录以确保最新的组策略设置应用于客户端计算机

        >[!NOTE]
        >默认情况下，客户端计算机更新组策略每隔 90 分钟，因此如果你允许足够的时间为客户端计算机接收更新的策略，你不需要让用户使用**GpUpdate**。
2. 删除服务器，以确保文件共享中的任何文件正在使用的文件共享。 要执行此操作在服务器管理器中，在文件和存储服务的**共享**页上，右键单击相应的文件共享，然后选择**删除**。

    用户将处理脱机使用脱机文件，直到完成移动操作，并从组策略接收更新的文件夹重定向设置。

3. 使用具有备份权限的帐户，将文件共享的内容移动到新位置使用方法的保留文件时间戳，如备份和还原实用程序。 若要使用**Robocopy**命令，打开一个提升的命令提示符，然后键入以下命令，其中```<Source>```是当前的文件共享位置和```<Destination>```是新的位置：

    ```PowerShell
    Robocopy /B <Source> <Destination> /Copyall /MIR /EFSRAW
    ```

    >[!NOTE]
    >**Xcopy**命令不会保留所有文件状态。
4. 编辑文件夹重定向策略设置，更新你想要重新定位每个重定向文件夹的目标文件夹位置。 有关详细信息，请参阅步骤 4 中[部署脱机文件的文件夹重定向](deploy-folder-redirection.md)。
5. 托管其重定向的文件夹的服务器已发生更改，和，它们应使用**GpUpdate /Target:User /Force**命令，然后注销并重新登录以获取更新的配置和恢复正确的文件同步，请通知用户。

    用户应登录到所有计算机至少一次以确保数据在每个脱机文件缓存中获取正确的定位。

## 详细信息

* [部署使用脱机文件的文件夹重定向](deploy-folder-redirection.md)
* [部署漫游用户配置文件](deploy-roaming-user-profiles.md)
* [文件夹重定向、 脱机文件和漫游用户配置文件概述](folder-redirection-rup-overview.md)