---
title: 与事件的用户配置文件疑难解答
description: 如何对加载的问题进行故障排除，以及通过使用事件和跟踪日志的卸载用户配置文件。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: 6099dac7d77e37b761785b4f58b6106472e5ba1e
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59827948"
---
# <a name="troubleshoot-user-profiles-with-events"></a>与事件的用户配置文件疑难解答

>适用于：Windows 10、 Windows 8、 Windows 8.1、 Windows Server 2012、 Windows Server 2012 R2 和 Windows Server 2016。

本主题讨论如何排查问题加载和卸载用户配置文件通过使用事件和跟踪日志。 以下部分介绍如何使用三个记录用户配置文件信息的事件日志。

## <a name="step-1-checking-events-in-the-application-log"></a>第 1 步：检查应用程序日志中的事件

解决问题的加载和卸载的用户配置文件 （包括漫游用户配置文件） 是使用事件查看器来检查日志中的记录用户配置文件服务应用程序中任何警告和错误事件中的第一个步骤。

下面介绍了如何在应用程序日志中查看用户配置文件服务事件：

1. 启动事件查看器。 若要执行此操作，打开**Control Panel**，选择**系统和安全**，然后在**管理工具**部分中，选择**查看事件日志**. 事件查看器窗口随即打开。
2. 在控制台树中，首先导航到**Windows 日志**，然后**应用程序**。
3. 在操作窗格中选择**筛选当前日志**。 此时将打开筛选当前日志对话框。
4. 在中**事件源**框中，选择**用户配置文件服务**复选框，然后选择**确定**。
5. 查看事件，特别要注意的错误事件的列表。
6. 当发现值得注意的事件时，选择事件日志联机帮助链接以显示其他信息和故障排除过程。
7. 若要执行进一步的疑难解答，请注意日期和时间的值得注意的事件，然后检查操作日志 （如在步骤 2 中所述） 以查看错误或警告事件时间附近，用户配置文件服务正在做什么的详细信息。

>[!NOTE]
>你可以放心地忽略用户配置文件服务事件 1530年"Windows 检测到您的注册文件仍处于其他应用程序或服务的使用。"

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>步骤 2：查看操作日志中的用户配置文件服务

如果您不能解决此问题，使用单独的应用程序日志，使用以下过程来查看操作日志中的用户配置文件服务事件。 此日志显示了一些该服务的内部工作机制，可帮助找出位置配置文件加载或卸载发生此问题的过程。

默认情况下，所有 Windows 安装中启用 Windows 应用程序日志和用户配置文件服务操作的日志。

下面介绍了如何查看操作日志中的用户配置文件服务：

1. 在事件查看器控制台树中，导航到**应用程序和服务日志**，然后**Microsoft**，然后**Windows**，然后**用户配置文件服务**，然后**操作**。
2. 检查应用程序日志中记录的错误或警告事件时间附近发生的事件。

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>步骤 3:启用和查看分析和调试日志

如果需要比操作的日志提供更多详细信息，可以启用分析和调试在受影响的计算机上的日志。 此级别的日志记录更为详细，应该禁用除时尝试解决问题。

下面介绍了如何启用和查看分析和调试日志：

1. 在中**操作**窗格中的事件查看器中，选择**视图**，然后选择**显示分析和调试日志**。
2. 导航到**应用程序和服务日志**，然后**Microsoft**，然后**Windows**，然后**用户配置文件服务**，，然后**诊断**。
3. 选择**启用日志**，然后选择**是**。 这样将启动日志记录的诊断日志。
4. 如果需要更多详细信息，请参阅[步骤 4:创建和解码跟踪](#step-4:-creating-and-decoding-a-trace)有关如何创建跟踪日志的详细信息。
5. 在完成解决此问题，请导航到**诊断**日志中，选择**禁用日志**，选择**视图**，然后清除**显示分析和调试日志**复选框以隐藏分析日志和调试日志记录。

## <a name="step-4-creating-and-decoding-a-trace"></a>步骤 4：创建和解码跟踪

如果您不能解决此问题，使用事件，可以创建跟踪日志 （ETL 文件） 时重现此问题，并对其使用从 Microsoft 符号服务器的公共符号进行解码。 跟踪日志提供有关用户配置文件服务执行操作，以及可帮助查明出现故障非常具体的信息。

使用 ETL 跟踪时的最佳策略是第一次捕获可能的最小日志。 一旦日志进行解码，搜索失败的日志。

下面介绍了如何创建和解码为用户配置文件服务的跟踪：

1. 登录到计算机的用户所遇到的问题，使用该帐户是本地 Administrators 组的成员。
2. 从提升的命令提示符输入以下命令，其中*\<路径\>* 是到本地文件夹，你之前已创建，例如 c： 路径\\日志：
        
    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. 从开始屏幕中，选择其用户名，然后选择**切换帐户**，注意不要注销管理员。 如果使用远程桌面，关闭管理员会话建立用户会话。
4. 再现该问题。 若要再现该问题的过程通常是登录遇到问题，将用户登录，用户和 / 或作为。
5. 重现此问题后, 以本地管理员身份再次登录。
6. 从提升的命令提示符运行以下命令以将日志保存到 ETL 文件：
  
    ```PowerShell
    logman stop -n RUP -ets
    ```
7. 键入以下命令以将 ETL 文件导出到当前目录中的用户可读文件 (可能是主文件夹或 %WINDIR%\\System32 文件夹):
    
    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. 打开**Summary.txt**文件并**Dumpfile.xml**文件 （您可以打开它们在 Microsoft Excel，若要更轻松地查看日志的完整详细信息中）。 查找事件，其中包括**失败**或**失败**; 您可以放心地忽略包括行**未知**事件名称。

## <a name="more-information"></a>详细信息

* [部署漫游用户配置文件](deploy-roaming-user-profiles.md)