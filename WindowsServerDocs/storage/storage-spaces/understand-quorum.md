---
title: 了解群集和池仲裁
description: 了解群集和池仲裁的特定示例超出复杂性。
keywords: 存储空间直通，仲裁，见证服务器，S2D，群集仲裁，池仲裁群集，池
ms.prod: windows-server-threshold
ms.author: adagashe
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: adagashe
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 24890b191db8bc6934132857e830d4f77c394b02
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59879968"
---
# <a name="understanding-cluster-and-pool-quorum"></a>了解群集和池仲裁

>适用于：Windows Server 2019、Windows Server 2016

[Windows Server 故障转移群集](../../failover-clustering/failover-clustering-overview.md)为工作负荷提供高可用性。 这些资源视为高度可用的托管资源的节点已启动; 如果但是，群集通常需要半个多节点正在运行，这被称为无*仲裁*。

仲裁旨在防止*裂脑*方案出现这种情况在网络中没有分区并且不能相互通信的节点。 这会导致这两个子集的节点以尝试拥有工作负荷并写入到的同一磁盘，可能会导致许多问题。 但是，这被无法与故障转移群集的仲裁，这会强制这些组可以继续运行，因此只有一个这些组将保持联机的节点之一的概念。

仲裁确定群集可以承受仍保持在线时的故障数。 仲裁旨在处理方案的群集节点之间的通信问题时，以便多个服务器不尝试同时托管资源组并将同时写入同一磁盘。 通过采用这一概念的仲裁，群集将强制群集服务停止的节点以确保只有一个真正的特定资源组所有者子集之一。 一旦已停止的节点可以再一次与主组的节点进行通信，它们将自动重新加入群集并启动其群集服务。

在 Windows Server 2016 中，有两个系统的组件具有其自己的仲裁机制：

- <strong>群集仲裁</strong>:此操作的过程在群集级别 （即您可以丢失节点并具有仍然能正常运行的群集）
- <strong>池仲裁</strong>:此操作的过程在池级别上启用存储空间直通 （即可以丢失节点和驱动器并将仍然能正常运行的池）。 存储池是专门设计用来在聚集和非群集方案中，正因如此，它们具有不同的仲裁机制。

## <a name="cluster-quorum-overview"></a>群集仲裁概述

下表概述了每个方案的群集仲裁结果：

| 服务器节点 | 可以在一个服务器节点故障后仍然存在 | 一台服务器节点故障，则另一个可以经受得住 | 可以从两个同时进行的服务器节点故障中恢复 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 50/50                               | 否                                                | 否                                                 |
| 2 + 见证服务器  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 50/50                                             | 否                                                 |
| 3 + 见证服务器  | 是                                 | 是                                               | 否                                                 |
| 4            | 是                                 | 是                                               | 50/50                                              |
| 4 + 见证服务器  | 是                                 | 是                                               | 是                                                |
| 5 及更高版本  | 是                                 | 是                                               | 是                                                |

### <a name="cluster-quorum-recommendations"></a>群集仲裁的建议

- 如果你有两个节点，见证服务器是<strong>需</strong>。
- 有三个或四个节点，见证服务器是否<strong>强烈建议</strong>。
- 如果您能够访问 Internet，则使用<strong>[云见证服务器](../../failover-clustering/deploy-cloud-witness.md)</strong>
- 如果您在 IT 环境与其他计算机和文件共享，请使用文件共享见证

## <a name="how-cluster-quorum-works"></a>群集仲裁的工作原理

当节点发生故障时，或节点的一些子集失去与另一小部分联系时，仍有效的节点需要验证它们构成*大多数*的群集仍保持联机状态。 如果它们无法验证的它们将会脱机。

但这一概念*多数*仅在当群集中节点的总数为奇数 （例如，三个节点中的五节点群集） 完全适用于。 因此，有偶数个节点 （例如，四个节点群集） 的群集中呢？

有两种方法可以使群集*总投票数*奇数：

1. 首先，它可以转*向上*通过添加一个*见证*使用额外的投票。 这要求用户设置。
2.  或者，可以转*向下*一个由零填充一个也节点的投票 （根据需要自动发生）。

只要仍然运行的节点已成功验证它们是否*多数*的定义*大多数*更新为之间只是时更新。 这允许群集失去一个节点，然后另一个，则另一个，等等。 这一概念*总投票数*连续失败后调整称为<strong>*动态仲裁*</strong>。  

### <a name="dynamic-witness"></a>动态见证服务器

动态见证服务器切换的见证服务器，确保投票*总投票数*为奇数。 如果有奇数数目的投票，见证服务器不具有一票。 如果偶数个投票，见证有一票。 动态见证显著降低群集将由于见证服务器故障而停机的风险。 群集决定是否使用基于群集中可用的投票节点数的见证投票。

动态仲裁适用于如下所述的方法中的动态见证服务器。

### <a name="dynamic-quorum-behavior"></a>动态仲裁行为

- 如果有<strong>甚至</strong>节点，并没有见证服务器，数字*一个节点获取归零其投票*。 例如，只有这三个四个节点获取投票，因此*总投票数*是三种模型，并使用投票的两个幸存者被视为大多数。
- 如果有<strong>奇数</strong>节点和没有见证服务器的数目*它们都获取投票*。
- 如果有<strong>甚至</strong>的节点以及见证服务器，数字*见证投票*，因此总共为奇数。
- 如果有<strong>奇数</strong>的节点以及见证服务器，数字*见证服务器不会进行投票*。

动态仲裁，可以将投票分配给节点动态以避免丢失多数票并允许群集使用一个节点 （称为上次 man 现有） 运行。 例如，让我们看一个四节点群集。 假定该仲裁需要 3 个投票。 

在这种情况下，群集将具有产量下降如果失去两个节点。

![关系图显示四个群集节点，其中每个获取投票](media/understand-quorum/dynamic-quorum-base.png)

但是，动态仲裁将防止这种情况发生。 *总投票数*所需的仲裁现在根据可用节点数来确定。 因此，与动态仲裁，群集将保持，即使在丢失三个节点。

![显示具有四个群集节点，节点发生故障时间和所需调整每个发生故障后的投票数在关系图。](media/understand-quorum/dynamic-quorum-step-through.png)

上面的方案适用于不具有存储空间直通启用的常规群集。 但是，启用存储空间直通后，群集只能支持两个节点故障。 对此进行更[池仲裁部分](#poolQuorum)。

### <a name="examples"></a>示例

#### <a name="two-nodes-without-a-witness"></a>不使用见证服务器的两个节点。 
一个节点的投票信息为零，因此*多数*投票决定共<strong>1 投票</strong>。 如果非投票节点意外出现故障，存活的 1/1 和群集仍然有效。 如果投票节点意外出现故障，存活具有 0/1 和群集出现故障。 如果投票节点正常关机，投票传输到另一个节点，群集可以幸存，但。 *<strong>这是很重要配置见证服务器的原因。</strong>*

![不使用见证服务器的两个节点与用例中所述的仲裁](media/understand-quorum/2-node-no-witness.png)

- 可以保留一个服务器故障：<strong>各有 50%机会</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>否</strong>。
- 可以两个服务器从故障中恢复次：<strong>否</strong>。 

#### <a name="two-nodes-with-a-witness"></a>具有见证服务器的两个节点。 
这两个节点进行投票，加上投票见证服务器，因此*多数*确定共<strong>3 投票</strong>。 如果其中一个节点出现故障，存活有 2/3，群集可以幸存，但。

![具有见证服务器仲裁带有两个节点的用例中所述](media/understand-quorum/2-node-witness.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>否</strong>。
- 可以两个服务器从故障中恢复次：<strong>否</strong>。 

#### <a name="three-nodes-without-a-witness"></a>不使用见证服务器的三个节点。
所有节点进行都投票，因此*多数*确定共<strong>3 投票</strong>。 如果任何节点出现故障，时更新是 2/3 和群集仍然有效。 群集变得不使用见证服务器的两个节点 – 此时，您在第一种情况。

![不使用见证服务器的三个节点与用例中所述的仲裁](media/understand-quorum/3-node-no-witness.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>各有 50%机会</strong>。
- 可以两个服务器从故障中恢复次：<strong>否</strong>。 

#### <a name="three-nodes-with-a-witness"></a>具有见证服务器的三个节点。
所有节点进行都投票，因此见证服务器最初不会进行都投票。 *多数*确定共<strong>3 投票</strong>。 后一次失败，群集具有两个节点具有见证服务器-这是返回到第二种情况。 因此，现在两个节点和见证投票。

![具有见证服务器仲裁带有三个节点的用例中所述](media/understand-quorum/3-node-witness.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>是</strong>。
- 可以两个服务器从故障中恢复次：<strong>否</strong>。 

#### <a name="four-nodes-without-a-witness"></a>不使用见证服务器的四个节点
一个节点的投票信息为零，因此*多数*确定共<strong>3 投票</strong>。 一次失败后群集变得三个节点，并且您在方案 3。

![不使用见证服务器的四个节点与用例中所述的仲裁](media/understand-quorum/4-node-no-witness.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>是</strong>。
- 可以两个服务器从故障中恢复次：<strong>各有 50%机会</strong>。 

#### <a name="four-nodes-with-a-witness"></a>具有见证服务器的四个节点。
所有节点投票和见证服务器才能正常运行，因此*多数*确定共<strong>5 个投票</strong>。 一次失败后在方案 4。 后两个同时发生故障，则跳过第二种情况下。

![具有见证服务器仲裁带有四个节点的用例中所述](media/understand-quorum/4-node-witness.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>是</strong>。
- 可以两个服务器从故障中恢复次：<strong>是</strong>。 

#### <a name="five-nodes-and-beyond"></a>五个节点及更高版本。
所有节点进行都投票，或一个都投票，无论使奇数合计。 存储空间直通不能处理两个以上节点关闭，因此此时，没有见证服务器是所需或最有用。

![这种情况，包含五个节点和更高版本中所述的仲裁](media/understand-quorum/5-nodes.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>是</strong>。
- 可以两个服务器从故障中恢复次：<strong>是</strong>。 

现在，我们已了解仲裁的工作原理，让我们看一下仲裁见证服务器的类型。

### <a name="quorum-witness-types"></a>仲裁见证类型

故障转移群集支持三种类型的仲裁见证服务器：

- <strong>[云见证](../../failover-clustering\deploy-cloud-witness.md)</strong> -中的 Blob 存储可访问 Azure 的所有节点的群集。 它会维护维护 witness.log 文件中的聚类分析信息，但不存储群集数据库的副本。
- <strong>文件共享见证</strong>– 运行 Windows Server 的文件服务器配置的 SMB 文件共享。 它会维护维护 witness.log 文件中的聚类分析信息，但不存储群集数据库的副本。
- <strong>磁盘见证</strong>-一个小的群集的磁盘是群集可用存储组中。 该磁盘是高度可用，可以在节点之间故障转移。 它包含群集数据库的副本。  <strong>*磁盘见证服务器不支持使用存储空间直通*</strong>。

## <a id="poolQuorum"></a>池仲裁概述

我们只讨论了群集仲裁，在群集级别进行操作。 现在，我们来深入讨论池仲裁，对池级别 （即您可能会丢失节点和驱动器并具有仍然能正常运行的池） 进行操作。 存储池是专门设计用来在聚集和非群集方案中，正因如此，它们具有不同的仲裁机制。

下表概述了每个方案的池仲裁结果：

| 服务器节点 | 可以在一个服务器节点故障后仍然存在 | 一台服务器节点故障，则另一个可以经受得住 | 可以从两个同时进行的服务器节点故障中恢复 |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 否                                  | 否                                                | 否                                                 |
| 2 + 见证服务器  | 是                                 | 否                                                | 否                                                 |
| 3            | 是                                 | 否                                                | 否                                                 |
| 3 + 见证服务器  | 是                                 | 否                                                | 否                                                 |
| 4            | 是                                 | 否                                                | 否                                                 |
| 4 + 见证服务器  | 是                                 | 是                                               | 是                                                |
| 5 及更高版本  | 是                                 | 是                                               | 是                                                |

## <a name="how-pool-quorum-works"></a>池仲裁的工作方式

未发生故障的驱动器时驱动器发生故障，或驱动器的一些子集失去与另一小部分联系时，需要验证它们构成*多数*仍保持联机状态的池。 如果它们无法验证的它们将会脱机。 池是处于脱机状态或会保持联机状态上是否有足够的磁盘的仲裁基于的实体 （50%+ 1）。 池资源所有者 （活动群集节点） 可以是 + 1。

但池仲裁工作方式，从群集仲裁在以下方面：

- 池使用一个节点在群集中作为见证服务器作为补救措施可以经受住一半驱动器消失 （此节点的池资源所有者）
- 池没有动态仲裁
- 池不实现其自己的版本中删除投票的

### <a name="examples"></a>示例

#### <a name="four-nodes-with-a-symmetrical-layout"></a>具有对称布局的四个节点。 
每个 16 个驱动器都有一票和两个节点还具有一票 （因为它是池资源所有者）。 *多数*确定共<strong>16 投票</strong>。 如果三个和四个节点出现故障，则存活的子集具有 8 个驱动器和池资源所有者，这是 9/16 投票。 因此，在池中仍然有效。

![池仲裁 1](media/understand-quorum/pool-1.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>是</strong>。
- 可以两个服务器从故障中恢复次：<strong>是</strong>。 

#### <a name="four-nodes-with-a-symmetrical-layout-and-drive-failure"></a>使用对称的布局和驱动器故障的四个节点。 
每个 16 个驱动器都有一票和节点 2 （因为它是池资源所有者） 还具有一票。 *多数*确定共<strong>16 投票</strong>。 首先，驱动器 7 出现故障。 如果三个和四个节点出现故障，则存活的子集具有 7 驱动器和池资源所有者，即 8/16 投票。 因此，该池没有大多数和出现故障。

![池仲裁 2](media/understand-quorum/pool-2.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>否</strong>。
- 可以两个服务器从故障中恢复次：<strong>否</strong>。 

#### <a name="four-nodes-with-a-non-symmetrical-layout"></a>使用非对称布局的四个节点。 
每 24 个驱动器都有一票并两个节点还具有一票 （因为它是池资源所有者）。 *多数*确定共<strong>24 投票</strong>。 如果三个和四个节点出现故障，则存活的子集具有 8 个驱动器和池资源所有者，这是 9/24 投票。 因此，该池没有大多数和出现故障。

![池仲裁 3](media/understand-quorum/pool-3.png)

- 可以保留一个服务器故障：<strong>是</strong>。
- 一台服务器出现故障，则另一个可以经受得住：<strong>取决于</strong>（不能经受如果三个和四个两个节点出现故障，但可以经受得住所有其他情况。
- 可以两个服务器从故障中恢复次：<strong>取决于</strong>（不能经受如果三个和四个两个节点出现故障，但可以经受得住所有其他情况。

### <a name="pool-quorum-recommendations"></a>池仲裁建议

- 确保在群集中的每个节点具有对称 （每个节点具有相同的驱动器数）
- 启用三向镜像或双重奇偶校验，以便可以承受节点故障，并保留虚拟磁盘。 请参阅我们[卷指南页](plan-volumes.md)的更多详细信息。
- 如果以上两个节点都已关闭，或两个节点和磁盘上的另一个节点关闭，系统可能无权访问其数据，所有三个副本卷，因此使其脱机并且将不可用。 建议恢复服务器或替换快速地确保大多数复原能力的卷中的所有数据磁盘。

## <a name="more-information"></a>详细信息

- [配置和管理仲裁](../../failover-clustering/manage-cluster-quorum.md)
- [部署云见证](../../failover-clustering/deploy-cloud-witness.md)
